<!doctype html><html lang=ru class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://denisxab.github.io/fastapi-accelerator/ rel=canonical><link href=info_files/ rel=next><link rel=icon href=assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.38"><title>Fastapi Accelerator</title><link rel=stylesheet href=assets/stylesheets/main.8c3ca2c6.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=assets/_mkdocstrings.css><script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#home class=md-skip> Перейти к содержанию </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул"> <a href=. title="Fastapi Accelerator" class="md-header__button md-logo" aria-label="Fastapi Accelerator" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Fastapi Accelerator </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Home </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label="Выберите язык"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/fastapi-accelerator/ hreflang=ru class=md-select__link> Русский </a> </li> <li class=md-select__item> <a href=/fastapi-accelerator/en/ hreflang=en class=md-select__link> English </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Поиск placeholder=Поиск autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Поиск> <button type=reset class="md-search__icon md-icon" title=Очистить aria-label=Очистить tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Инициализация поиска </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Навигация data-md-level=0> <label class=md-nav__title for=__drawer> <a href=. title="Fastapi Accelerator" class="md-nav__button md-logo" aria-label="Fastapi Accelerator" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Fastapi Accelerator </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <a href=. class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Home </span> </a> <nav class="md-nav md-nav--secondary" aria-label=Содержание> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Содержание </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fastapi-api class=md-nav__link> <span class=md-ellipsis> Ускоряем разработку на FastAPI: Мощный инструментарий для создания и тестирования API </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> Для кого это будет полезно? </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> Зачем нужен этот инструментарий? </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> Структура инструмента </span> </a> </li> <li class=md-nav__item> <a href=#fastapi class=md-nav__link> <span class=md-ellipsis> Подключение к FastAPI </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> Основные компоненты </span> </a> <nav class=md-nav aria-label="Основные компоненты"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#base-pattern class=md-nav__link> <span class=md-ellipsis> Base Pattern </span> </a> </li> <li class=md-nav__item> <a href=#databasemanager class=md-nav__link> <span class=md-ellipsis> DatabaseManager </span> </a> </li> <li class=md-nav__item> <a href=#ormasync class=md-nav__link> <span class=md-ellipsis> OrmAsync </span> </a> </li> <li class=md-nav__item> <a href=#viewset class=md-nav__link> <span class=md-ellipsis> ViewSet </span> </a> </li> <li class=md-nav__item> <a href=#jwt class=md-nav__link> <span class=md-ellipsis> Аутентификация по JWT </span> </a> </li> <li class=md-nav__item> <a href=#api class=md-nav__link> <span class=md-ellipsis> Интеграций с внешними API </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> Тестирование </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> Сравнение с существующими решениями </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> Заключение </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=info_files/ class=md-nav__link> <span class=md-ellipsis> File descriptions </span> </a> </li> <li class=md-nav__item> <a href=business_logic/ class=md-nav__link> <span class=md-ellipsis> Business logic </span> </a> </li> <li class=md-nav__item> <a href=test_logic/ class=md-nav__link> <span class=md-ellipsis> Testing logic </span> </a> </li> <li class=md-nav__item> <a href=code_docs/ class=md-nav__link> <span class=md-ellipsis> Code Docs </span> </a> </li> <li class=md-nav__item> <a href=plan/ class=md-nav__link> <span class=md-ellipsis> Plan </span> </a> </li> <li class=md-nav__item> <a href=about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=Содержание> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Содержание </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fastapi-api class=md-nav__link> <span class=md-ellipsis> Ускоряем разработку на FastAPI: Мощный инструментарий для создания и тестирования API </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> Для кого это будет полезно? </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> Зачем нужен этот инструментарий? </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> Структура инструмента </span> </a> </li> <li class=md-nav__item> <a href=#fastapi class=md-nav__link> <span class=md-ellipsis> Подключение к FastAPI </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> Основные компоненты </span> </a> <nav class=md-nav aria-label="Основные компоненты"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#base-pattern class=md-nav__link> <span class=md-ellipsis> Base Pattern </span> </a> </li> <li class=md-nav__item> <a href=#databasemanager class=md-nav__link> <span class=md-ellipsis> DatabaseManager </span> </a> </li> <li class=md-nav__item> <a href=#ormasync class=md-nav__link> <span class=md-ellipsis> OrmAsync </span> </a> </li> <li class=md-nav__item> <a href=#viewset class=md-nav__link> <span class=md-ellipsis> ViewSet </span> </a> </li> <li class=md-nav__item> <a href=#jwt class=md-nav__link> <span class=md-ellipsis> Аутентификация по JWT </span> </a> </li> <li class=md-nav__item> <a href=#api class=md-nav__link> <span class=md-ellipsis> Интеграций с внешними API </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> Тестирование </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> Сравнение с существующими решениями </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> Заключение </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=home>Home</h1> <p><img alt=log src=images/logo.png></p> <h2 id=fastapi-api>Ускоряем разработку на FastAPI: Мощный инструментарий для создания и тестирования API</h2> <p>В мире современной веб-разработки FastAPI зарекомендовал себя как мощный и быстрый фреймворк для создания API. Однако, при работе над крупными проектами разработчики часто сталкиваются с необходимостью оптимизировать рутинные процессы, улучшить структуру кода и упростить тестирование. В этой статье мы рассмотрим набор инструментов, который поможет решить эти задачи и существенно ускорить разработку на FastAPI.</p> <p>Ходя по множеству собеседований, я заметил что многие компании, активно использующие FastAPI, разработали собственные библиотеки, но аналогичных инструментов с открытым доступом и свободной лицензией практически нет. Я, как опытный backend-разработчик на Python и Django, решил адаптировать и интегрировать наиболее полезные и востребованные решения для разработки REST API в FastAPI, основываясь на своем опыте работы с Django.</p> <p>Краткосрочная цель: собрать обратную связь от сообщества о данной идее.</p> <p>Долгосрочная цель: улучшить инструмент в open source, побуждая крупные компании отказаться от разработки и поддержки собственного проприетарного кода. Вместо этого мы стремимся создать экосистему, где компании не только используют общий инструментарий, но и активно участвуют в его совершенствовании, внося свой вклад в open-source проект.</p> <ul> <li><a href=https://github.com/denisxab/fastapi_accelerator>https://github.com/denisxab/fastapi_accelerator</a></li> <li><a href=https://pypi.org/project/fastapi_accelerator>https://pypi.org/project/fastapi_accelerator</a></li> </ul> <h2 id=_1>Для кого это будет полезно?</h2> <ul> <li>Backend-разработчикам на Python, использующим или планирующим использовать FastAPI</li> <li>Командам, работающим над средними и крупными проектами на FastAPI</li> <li>Разработчикам, которые хотят улучшить структуру своих FastAPI-проектов и ускорить процесс разработки</li> <li>Тем, кто ищет эффективные инструменты для тестирования FastAPI-приложений</li> </ul> <h2 id=_2>Зачем нужен этот инструментарий?</h2> <p>FastAPI Accelerator - это open-source инструментарий, созданный на основе лучших практик разработки REST API.</p> <p>Основная цель представленного инструментария - ускорить и упростить разработку проектов на FastAPI.</p> <p>Это достигается путем:</p> <ol> <li>Подробной и хорошей документацией.</li> <li>Предоставления переиспользуемого кода для типовых задач.</li> <li>Внедрения универсального менеджера для работы с РСУБД.</li> <li>Реализации ViewSet для быстрого создания представлений с базовой бизнес-логикой.</li> <li>Интеграции аутентификации по JWT.</li> <li>Упрощения написания и выполнения интеграционных тестов для API.</li> <li>Оптимизации работы с Alembic для управления миграциями в production и test окружениях.</li> <li>Стандартизация архитектуры для интеграций по HTTP.</li> </ol> <p>Все эти компоненты взаимосвязаны и дополняют друг друга, автоматизируя рутинные задачи.</p> <h2 id=_3>Структура инструмента</h2> <p>Давайте рассмотрим основные компоненты нашего инструментария:</p> <div class=highlight><pre><span></span><code>fastapi_accelerator/
├──<span class=w> </span>db/<span class=w>             </span><span class=c1># Логика взаимодействия с РСУБД</span>
├──<span class=w> </span>pattern/<span class=w>        </span><span class=c1># Шаблоны для проектов</span>
├──<span class=w> </span>testutils/<span class=w>      </span><span class=c1># Утилиты для тестирования FastAPI</span>
├──<span class=w> </span>integration/<span class=w>    </span><span class=c1># Утилиты интеграций с внешними системами</span>
├──<span class=w> </span>commands/<span class=w>       </span><span class=c1># CLI команды</span>
├──<span class=w> </span>cache.py<span class=w>        </span><span class=c1># Реализация кеширования</span>
├──<span class=w> </span>auth_jwt.py<span class=w>     </span><span class=c1># Аутентификация по JWT</span>
├──<span class=w> </span>exception.py<span class=w>    </span><span class=c1># Обработка исключений</span>
├──<span class=w> </span>middleware.py<span class=w>   </span><span class=c1># Middleware компоненты</span>
├──<span class=w> </span>paginator.py<span class=w>    </span><span class=c1># Реализация пагинации</span>
├──<span class=w> </span>timezone.py<span class=w>     </span><span class=c1># Работа с временными зонами</span>
├──<span class=w> </span>viewset.py<span class=w>      </span><span class=c1># Реализация ViewSet</span>
└──<span class=w> </span>utils.py<span class=w>        </span><span class=c1># Общие утилиты</span>
</code></pre></div> <h2 id=fastapi>Подключение к FastAPI</h2> <p>Файл <code>main.py</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.pattern.pattern_fastapi</span> <span class=kn>import</span> <span class=n>base_pattern</span>
<span class=kn>from</span> <span class=nn>app.core.config</span> <span class=kn>import</span> <span class=n>BASE_DIR_PROJECT</span><span class=p>,</span> <span class=n>DEBUG</span><span class=p>,</span> <span class=n>SECRET_KEY</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.timezone</span> <span class=kn>import</span> <span class=n>moscow_tz</span>
<span class=kn>from</span> <span class=nn>app.core.db</span> <span class=kn>import</span> <span class=n>DatabaseManager</span>
<span class=kn>from</span> <span class=nn>app.core.security</span> <span class=kn>import</span> <span class=n>AuthJWT</span>

<span class=kn>import</span> <span class=nn>app.api.v1.router</span> <span class=k>as</span> <span class=nn>RouterV1</span>

<span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>

<span class=c1># Паттерн для проекта</span>
<span class=n>base_pattern</span><span class=p>(</span>
    <span class=n>app</span><span class=p>,</span>
    <span class=n>routers</span><span class=o>=</span><span class=p>(</span><span class=n>RouterV1</span><span class=o>.</span><span class=n>router</span><span class=p>,),</span>
    <span class=n>timezone</span><span class=o>=</span><span class=n>moscow_tz</span><span class=p>,</span>
    <span class=n>cache_status</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>debug</span><span class=o>=</span><span class=n>DEBUG</span><span class=p>,</span>
    <span class=n>base_dir</span><span class=o>=</span><span class=n>BASE_DIR_PROJECT</span><span class=p>,</span>
    <span class=n>database_manager</span><span class=o>=</span><span class=n>DatabaseManager</span><span class=p>,</span>
    <span class=n>secret_key</span><span class=o>=</span><span class=n>SECRET_KEY</span><span class=p>,</span>
<span class=p>)</span>

<span class=c1># Подключить аутентификацию по JWT</span>
<span class=n>AuthJWT</span><span class=o>.</span><span class=n>mount_auth</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</code></pre></div> <h2 id=_4>Основные компоненты</h2> <h3 id=base-pattern>Base Pattern</h3> <p>Функция <code>base_pattern</code> добавляет множество полезных функций в <code>app</code>, включая:</p> <ul> <li>Заполнение <code>state</code> и другую информацию у <code>app</code>.</li> <li>Разрешение <code>CORS</code>.</li> <li>Подключение роутеров с поддержкой <code>ViewSet</code>.</li> <li>Добавление метода <code>healthcheck</code>.</li> <li><code>Middleware</code> для отладки времени выполнения API-запросов.</li> <li>Подробный вывод для <code>HTTP</code> исключений.</li> </ul> <h3 id=databasemanager>DatabaseManager</h3> <p><code>DatabaseManager</code> - это универсальный инструмент для работы с РСУБД, предоставляющий как синхронные, так и асинхронные(название начинается на <code>a</code>) методы. <code>DatabaseManager</code> использует патер одиночка, поэтому может быть легко подменен в тестах.</p> <p>Пример использования:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>app.core.config</span> <span class=kn>import</span> <span class=n>DATABASE_URL</span><span class=p>,</span> <span class=n>DEBUG</span><span class=p>,</span> <span class=n>DEV_STATUS</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.dbsession</span> <span class=kn>import</span> <span class=n>MainDatabaseManager</span>

<span class=n>DatabaseManager</span> <span class=o>=</span> <span class=n>MainDatabaseManager</span><span class=p>(</span><span class=n>DATABASE_URL</span><span class=p>,</span> <span class=n>echo</span><span class=o>=</span><span class=n>DEBUG</span><span class=p>,</span> <span class=n>DEV_STATUS</span><span class=o>=</span><span class=n>DEV_STATUS</span><span class=p>)</span>
</code></pre></div> <ul> <li> <p>Общие характеристики</p> <ul> <li><code>DEV_STATUS</code> - Индикатор режима разработки. При <code>DEV_STATUS=False</code> блокирует выполнение критических операций (<code>create_all</code>, <code>drop_all</code>, <code>clear_all</code>). Это мера безопасности для производственной среды.</li> </ul> </li> <li> <p>Синхронные компоненты</p> <ul> <li><code>database_url</code> - Адрес для подключения к синхронной базе данных.</li> <li><code>engine</code> - Механизм синхронного взаимодействия с БД.</li> <li><code>session</code> - Генератор синхронных сессий.</li> <li> <p><code>Base</code> - Базовый класс для моделей данных.</p> </li> <li> <p>Функциональность:</p> <ul> <li><code>get_session</code> - Инжектор сессии БД.</li> <li><code>get_session_transaction</code> - Инжектор сессии БД с поддержкой транзакций.</li> <li><code>create_all</code> - Инициализация всех таблиц в БД.</li> <li><code>drop_all</code> - Удаление всей структуры БД.</li> <li><code>clear_all</code> - Очистка содержимого таблиц. Параметр <code>exclude_tables_name</code> позволяет исключить определенные таблицы из процесса очистки.</li> </ul> </li> </ul> </li> <li> <p>Асинхронные компоненты</p> <ul> <li><code>adatabase_url</code> - Адрес для подключения к асинхронной БД.</li> <li><code>aengine</code> - Асинхронный механизм работы с БД, включая пул соединений.</li> <li> <p><code>asession</code> - Генератор асинхронных сессий.</p> </li> <li> <p>Функциональность:</p> <ul> <li><code>aget_session</code> - Асинхронный инжектор сессии БД.</li> <li><code>aget_session_transaction</code> - Асинхронный инжектор сессии БД с поддержкой транзакций.</li> </ul> </li> </ul> </li> </ul> <h3 id=ormasync>OrmAsync</h3> <p>Этот класс оптимизирует асинхронное взаимодействие с БД:</p> <ul> <li><code>get</code> - Извлечение объекта по заданным критериям.</li> <li><code>get_list</code> - Получение набора объектов по запросу. (С возможностью глубокой выборки)</li> <li><code>update</code> - Модификация объектов согласно запросу.</li> <li><code>delete</code> - Удаление объектов по заданным параметрам.</li> <li><code>get_item</code> - Извлечение объекта по первичному ключу. (С возможностью глубокой выборки)</li> <li><code>create_item</code> - Создание нового объекта. (С возможностью каскадного создания)</li> <li><code>update_item</code> - Обновление объекта по первичному ключу. (С возможностью каскадного обновления)</li> <li><code>delete_item</code> - Удаление объекта по первичному ключу. (С возможностью каскадного удаления)</li> </ul> <blockquote> <p>Глубокая выборка/каскадные операции - это возможность работы со связанными данными. Активируется параметром <code>deep=True</code></p> <p>Примеры:</p> <ul> <li>get_list, get_item - Возвращают объекты со всеми связанными данными, готовые для использования в Pydantic</li> <li>create_item - Создает записи в связанных таблицах</li> <li>update_item - Обновляет данные в связанных таблицах</li> <li>delete_item - Удаляет записи из связанных таблиц</li> </ul> </blockquote> <h3 id=viewset>ViewSet</h3> <p>ViewSet позволяет быстро создавать CRUD-операции для моделей. Вот пример использования:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>fastapi_accelerator.viewset</span> <span class=kn>import</span> <span class=n>AppOrm</span><span class=p>,</span> <span class=n>FullViewSet</span>
<span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>APIRouter</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>Query</span>

<span class=kn>from</span> <span class=nn>app.api.v1.schemas.timemeasurement</span> <span class=kn>import</span> <span class=n>TaskExecution</span>
<span class=kn>from</span> <span class=nn>app.models.timemeasurement</span> <span class=kn>import</span> <span class=n>TaskExecution</span> <span class=k>as</span> <span class=n>TaskExecutionDb</span>

<span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>(</span><span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;/api/v1&quot;</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>FileViewSet</span><span class=p>(</span><span class=n>FullViewSet</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Представление для работы с файлами</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Модель БД</span>
    <span class=n>db_model</span> <span class=o>=</span> <span class=n>TaskExecutionDb</span>
    <span class=c1># Модель Схемы</span>
    <span class=n>pydantic_model</span> <span class=o>=</span> <span class=n>TaskExecution</span>

<span class=w>    </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    # Кеширование</span>
<span class=sd>    cache_class = redis_client</span>
<span class=sd>    cache_ttl = timedelta(minutes=10)</span>

<span class=sd>    # Пагинация</span>
<span class=sd>    paginator_class = DefaultPaginator</span>

<span class=sd>    # Включить поддержку вложенных схем pydantic</span>
<span class=sd>    # это значит что будет происходить рекурсивное</span>
<span class=sd>    # создание, обновление, удаление связанных записей</span>
<span class=sd>    deep_schema = True</span>

<span class=sd>    # Включить защиту через JWT</span>
<span class=sd>    dependencies = [Depends(jwt_auth)]</span>

<span class=sd>    # Вы можете также переопределять методы:</span>

<span class=sd>    async def db_update(</span>
<span class=sd>        self, item_id: str | int | UUID, item: type[BaseModel], aorm: OrmAsync</span>
<span class=sd>    ) -&gt; object:</span>
<span class=sd>        &quot;&quot;&quot;Переопределение метода db_update&quot;&quot;&quot;</span>
<span class=sd>        return await super().db_update(item_id, item, aorm)</span>

<span class=sd>    def list(self):</span>
<span class=sd>        &quot;&quot;&quot;Переопределение метода list&quot;&quot;&quot;</span>

<span class=sd>        @self.router.get(f&quot;{self.prefix}&quot;, tags=self.tags)</span>
<span class=sd>        async def get_list_items(</span>
<span class=sd>            skip: int = Query(0),</span>
<span class=sd>            limit: int = Query(100),</span>
<span class=sd>            aorm: OrmAsync = Depends(AppOrm.aget_orm),</span>
<span class=sd>        ) -&gt; List[self.pydantic_model]:</span>
<span class=sd>            return await aorm.get_list(</span>
<span class=sd>                select(self.db_model).offset(skip).limit(limit),</span>
<span class=sd>                deep=self.deep_schema,</span>
<span class=sd>                db_model=self.db_model,</span>
<span class=sd>            )</span>
<span class=sd>        return get_list_items</span>
<span class=sd>    &#39;&#39;&#39;</span>

<span class=n>router</span><span class=o>.</span><span class=n>views</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>FileViewSet</span><span class=p>()</span><span class=o>.</span><span class=n>as_view</span><span class=p>(</span><span class=n>router</span><span class=p>,</span> <span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;/file&quot;</span><span class=p>),</span>
<span class=p>]</span>
</code></pre></div> <h3 id=jwt>Аутентификация по JWT</h3> <p>Для защиты API-эндпоинтов мы используем JWT-аутентификацию:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>fastapi_accelerator.auth_jwt</span> <span class=kn>import</span> <span class=n>BaseAuthJWT</span>

<span class=k>class</span> <span class=nc>AuthJWT</span><span class=p>(</span><span class=n>BaseAuthJWT</span><span class=p>):</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>username</span> <span class=o>==</span> <span class=s2>&quot;admin&quot;</span> <span class=ow>and</span> <span class=n>password</span> <span class=o>==</span> <span class=s2>&quot;admin&quot;</span>

<span class=n>AuthJWT</span><span class=o>.</span><span class=n>mount_auth</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</code></pre></div> <p>Пример защиты API метода:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>fastapi_accelerator.auth_jwt</span> <span class=kn>import</span> <span class=n>jwt_auth</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/check_protected&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>
</code></pre></div> <h3 id=api>Интеграций с внешними API</h3> <p>Большинство API-сервисов взаимодействуют с другими API или gRPC/RPC сервисами. Такие интеграции могут быть сложными и часто оказываются не полностью понятно разработчикам. Из-за этого они легко превращаются в легаси-код, который сложно поддерживать, а тестирование интеграций локально зачастую невозможно.</p> <p>Важно, чтобы в проекте была библиотека, следящая за качеством написания интеграций и заставляющая документировать их для упрощения дальнейшей поддержки. Именно для этого я разработал специальные модули:</p> <ul> <li><code>IntegrationHTTP</code>: Класс для создания интеграций по REST HTTP.</li> <li><code>Stability Patterns</code>: Паттернов стабильности для применения к методам интеграции.</li> <li><code>py2dantic</code>: Утилита для перевода Python dict в Pydantic схему.</li> <li><code>docintegration</code>: Авто генерация документации, для используемых интеграций.</li> </ul> <p>Преимущества использования этого подхода:</p> <ul> <li>Явная спецификация форматов запроса и ответа.</li> <li>Легкая переносимость кода между проектами — достаточно импортировать классы, основанные на <code>IntegrationHTTP</code>.</li> <li>Консолидация логики внешних запросов в одном месте, что упрощает поддержку.</li> <li>Возможность легко заменять реальные методы на <code>mock</code> для тестирования.</li> <li>Легкое внедрение <code>Stability Patterns</code> для методов интеграции.</li> </ul> <p>Для создания интеграции следуйте следующим шагам:</p> <ol> <li>Рекомендуется располагать код интеграций в директории <code>app/integration/ИмяПакетаИнтеграции</code>.</li> <li> <p>Создать класса интеграций <code>app/integration/ИмяПакетаИнтеграции/endpoint.py</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>httpx</span>
<span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>

<span class=kn>from</span> <span class=nn>fastapi_accelerator.integration.http_integration</span> <span class=kn>import</span> <span class=p>(</span>
    <span class=n>ApiHTTP</span><span class=p>,</span>
    <span class=n>EndpointsDeclaration</span><span class=p>,</span>
    <span class=n>HTTPMethod</span><span class=p>,</span>
    <span class=n>IntegrationHTTP</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.integration.stability_patterns</span> <span class=kn>import</span> <span class=n>sp</span>

<span class=k>class</span> <span class=nc>ИмяIntegration</span><span class=p>(</span><span class=n>EndpointsDeclaration</span><span class=p>):</span>

    <span class=n>integration</span> <span class=o>=</span> <span class=n>IntegrationHTTP</span><span class=p>(</span>
        <span class=s2>&quot;Имя Интеграции&quot;</span><span class=p>,</span>
        <span class=n>doc</span><span class=o>=</span><span class=s2>&quot;Интеграция с ... API&quot;</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=k>class</span> <span class=nc>Schema</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Схемы Pydantic для успешных ответов&quot;&quot;&quot;</span>

        <span class=k>class</span> <span class=nc>Successful</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>)</span>
            <span class=n>body</span><span class=p>:</span> <span class=nb>str</span>

    <span class=k>class</span> <span class=nc>SchemaError</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Схемы Pydantic для не успешных ответов&quot;&quot;&quot;</span>

        <span class=k>class</span> <span class=nc>http400</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>)</span>
            <span class=n>error</span><span class=p>:</span> <span class=nb>str</span>

    <span class=nd>@integration</span><span class=o>.</span><span class=n>endpoint</span><span class=p>(</span>
        <span class=n>HTTPMethod</span><span class=o>.</span><span class=n>post</span><span class=p>,</span>
        <span class=s2>&quot;/путь&quot;</span><span class=p>,</span>
        <span class=n>version</span><span class=o>=</span><span class=s2>&quot;...&quot;</span><span class=p>,</span>
        <span class=n>docurl</span><span class=o>=</span><span class=s2>&quot;https://...&quot;</span>
    <span class=p>)</span>
    <span class=nd>@sp</span><span class=o>.</span><span class=n>RetryPattern</span><span class=p>()</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>имя_метода</span><span class=p>(</span><span class=n>api</span><span class=p>:</span> <span class=n>ApiHTTP</span><span class=p>,</span> <span class=n>аргумент_1</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Schema</span><span class=o>.</span><span class=n>Successful</span> <span class=o>|</span> <span class=n>SchemaError</span><span class=o>.</span><span class=n>http400</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>response</span><span class=p>:</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>api</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>api</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>geturl</span><span class=p>(),</span> <span class=n>json</span><span class=o>=...</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
        <span class=k>except</span> <span class=n>httpx</span><span class=o>.</span><span class=n>RequestError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>e</span>
</code></pre></div> </li> <li> <p>Настроить и подключить интеграции к проекту <code>app/core/useintegration.py</code>:</p> <div class=highlight><pre><span></span><code><span class=sd>&quot;&quot;&quot;Интеграции используемые в проекте&quot;&quot;&quot;</span>

<span class=kn>from</span> <span class=nn>app.integration.ИмяПакетаИнтеграции.endpoint</span> <span class=kn>import</span> <span class=n>ИмяIntegration</span>

<span class=c1># Создание экземпляра интеграции</span>
<span class=n>имя_api</span> <span class=o>=</span> <span class=n>ИмяIntegration</span><span class=p>(</span>
    <span class=c1># Начало для url пути</span>
    <span class=n>base_url</span><span class=o>=</span><span class=s2>&quot;https://путь...&quot;</span><span class=p>,</span>
    <span class=c1># Доступы, которые можем использовать в методах интеграции</span>
    <span class=n>credentials</span><span class=o>=</span><span class=p>{</span><span class=o>...</span><span class=p>},</span>
<span class=p>)</span>
</code></pre></div> </li> <li> <p>Пример использования класса интеграции в <code>FastAPI</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>app.core.useintegration</span> <span class=kn>import</span> <span class=n>имя_api</span>
<span class=kn>from</span> <span class=nn>app.integration.ИмяПакетаИнтеграции.schema</span> <span class=kn>import</span> <span class=n>ИмяSchema</span>

<span class=nd>@router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/имя&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>имя</span><span class=p>(</span><span class=n>аргумент_1</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ИмяIntegration</span><span class=o>.</span><span class=n>Schema</span><span class=o>.</span><span class=n>Successful</span><span class=p>:</span>
    <span class=c1># Вызвать метод интеграции</span>
    <span class=k>return</span> <span class=k>await</span> <span class=n>имя_api</span><span class=o>.</span><span class=n>имя_метода</span><span class=p>(</span><span class=n>аргумент_1</span><span class=p>)</span>
</code></pre></div> </li> </ol> <h2 id=_5>Тестирование</h2> <p>Одной из ключевых особенностей нашего инструментария является мощная система для написания и выполнения тестов. Она включает в себя:</p> <ol> <li>Фикстуры для работы с тестовой базой данных и клиентом API.</li> <li>Декораторы для аутентификации и применения фикстур.</li> <li>Контекстный менеджер для отслеживания SQL-запросов.</li> <li>Утилиты для проверки JSON-ответов.</li> <li>Тестирование через классы.</li> </ol> <p>Пример функции теста:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Callable</span><span class=p>,</span> <span class=n>NamedTuple</span>

<span class=kn>from</span> <span class=nn>fastapi.testclient</span> <span class=kn>import</span> <span class=n>TestClient</span>

<span class=kn>from</span> <span class=nn>app.fixture.items_v1</span> <span class=kn>import</span> <span class=n>export_fixture_file</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.db.dbsession</span> <span class=kn>import</span> <span class=n>MainDatabaseManager</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils</span> <span class=kn>import</span> <span class=n>apply_fixture_db</span><span class=p>,</span> <span class=n>client_auth_jwt</span><span class=p>,</span> <span class=n>track_queries</span><span class=p>,</span> <span class=n>check_response_json</span>


<span class=c1># Аутентифицировать тестового клиента</span>
<span class=nd>@client_auth_jwt</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=s2>&quot;test&quot;</span><span class=p>)</span>
<span class=c1># Создать тестовые данных из функции с фикстурами</span>
<span class=nd>@apply_fixture_db</span><span class=p>(</span><span class=n>export_fixture_file</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_имя</span><span class=p>(</span>
    <span class=n>client</span><span class=p>:</span> <span class=n>TestClient</span><span class=p>,</span>               <span class=c1># Тестовый клиент для API запросов</span>
    <span class=n>url_path_for</span><span class=p>:</span> <span class=n>Callable</span><span class=p>,</span>           <span class=c1># Функция для получения url по имени функции обработчика</span>
    <span class=n>db_manager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span><span class=p>,</span>  <span class=c1># Менеджер тестовой БД</span>
    <span class=n>fixtures</span><span class=p>:</span> <span class=n>NamedTuple</span><span class=p>,</span>             <span class=c1># Хранит созданные данные из фикстур</span>
<span class=p>):</span>
    <span class=c1># Проверка количество выполняемых SQL команд</span>
    <span class=k>with</span> <span class=n>track_queries</span><span class=p>(</span><span class=n>db_manager</span><span class=p>,</span> <span class=n>expected_count</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
        <span class=c1># Запрос в API</span>
        <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url_path_for</span><span class=p>(</span><span class=s2>&quot;ИмяФункции&quot;</span><span class=p>))</span>
    <span class=c1># Проверка JSON API ответа</span>
    <span class=n>check_response_json</span><span class=p>(</span>
        <span class=n>response</span><span class=p>,</span>
        <span class=mi>200</span><span class=p>,</span>
        <span class=p>{</span>
            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>fixtures</span><span class=o>.</span><span class=n>Имя</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
        <span class=p>},</span>
    <span class=p>)</span>
</code></pre></div> <p>Пример тест класса:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Callable</span><span class=p>,</span> <span class=n>NamedTuple</span>

<span class=kn>from</span> <span class=nn>fastapi.testclient</span> <span class=kn>import</span> <span class=n>TestClient</span>

<span class=kn>from</span> <span class=nn>app.fixture.items_v1</span> <span class=kn>import</span> <span class=n>export_fixture_file</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.db.dbsession</span> <span class=kn>import</span> <span class=n>MainDatabaseManager</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils</span> <span class=kn>import</span> <span class=n>apply_fixture_db</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils.fixture_auth</span> <span class=kn>import</span> <span class=n>client_auth_jwt</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils.fixture_db.trace_sql</span> <span class=kn>import</span> <span class=n>track_queries</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils.utils</span> <span class=kn>import</span> <span class=n>BaseAuthJwtPytest</span><span class=p>,</span> <span class=n>check_response_json</span>

<span class=n>BASE_URL_V1</span> <span class=o>=</span> <span class=s2>&quot;/api/v1/&quot;</span>

<span class=k>class</span> <span class=nc>TestИмя</span><span class=p>(</span><span class=n>BaseAuthJwtPytest</span><span class=p>):</span>

    <span class=c1># Создать тестовые данных из функции с фикстурами</span>
    <span class=nd>@apply_fixture_db</span><span class=p>(</span><span class=n>export_fixture_file</span><span class=p>)</span>
    <span class=k>def</span> <span class=nf>setUp</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fixtures</span><span class=p>:</span> <span class=n>NamedTuple</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>url</span> <span class=o>=</span> <span class=n>BASE_URL_V1</span> <span class=o>+</span> <span class=s2>&quot;taskexecution&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>fixtures</span> <span class=o>=</span> <span class=n>fixtures</span> <span class=c1># Хранит созданные данные из фикстур</span>

    <span class=k>def</span> <span class=nf>test_имя</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>:</span> <span class=n>TestClient</span><span class=p>,</span> <span class=n>db_manager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span><span class=p>):</span>
        <span class=c1># Проверка количество выполняемых SQL команд</span>
        <span class=k>with</span> <span class=n>track_queries</span><span class=p>(</span><span class=n>db_manager</span><span class=p>,</span> <span class=n>expected_count</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
            <span class=c1># Запрос в API</span>
            <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
        <span class=c1># Проверка JSON API ответа</span>
        <span class=n>check_response_json</span><span class=p>(</span>
            <span class=n>response</span><span class=p>,</span>
            <span class=mi>200</span><span class=p>,</span>
            <span class=p>{</span>
                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>fixtures</span><span class=o>.</span><span class=n>Имя</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
            <span class=p>},</span>
        <span class=p>)</span>
</code></pre></div> <h2 id=_6>Сравнение с существующими решениями</h2> <p>Хотя существует несколько проектов, предлагающих инструменты для разработки и тестирования FastAPI приложений, наше решение выделяется своей комплексностью и специализацией:</p> <ol> <li><code>FastAPI-Utils</code>: Предоставляет утилиты для разработки, но менее фокусирован на тестировании.</li> <li><code>FastAPI-SQLAlchemy</code>: Интегрирует FastAPI с SQLAlchemy, включая некоторые утилиты для тестирования.</li> <li><code>FastAPI-Toolkit</code>: Предлагает набор инструментов, но менее специализирован на задачах тестирования.</li> <li><code>freddie</code> - В архиве на GitHub, только viewset</li> <li><code>fastapi_viewsets</code> - Только viewset</li> <li><code>FastAPIwee</code> - Менее специализирован на задачах тестирования.</li> </ol> <p>Наше решение отличается тем, что:</p> <ol> <li>Более специфично для задач тестирования FastAPI приложений.</li> <li>Предоставляет более широкий набор инструментов для различных аспектов тестирования.</li> <li>Включает уникальные функции, такие как декоратор <code>@apply_fixture_db</code> и контекстный менеджер <code>track_queries</code>.</li> <li>Предлагает комплексный подход, охватывающий различные аспекты разработки и тестирования FastAPI приложений.</li> </ol> <h2 id=_7>Заключение</h2> <p>Представленный инструментарий значительно упрощает и ускоряет разработку на FastAPI. Он предоставляет готовые решения для типовых задач, улучшает структуру проекта и облегчает тестирование. Использование этих инструментов позволит разработчикам сосредоточиться на бизнес-логике приложения, а не на технических деталях реализации.</p> <p>Несмотря на наличие других инструментов в экосистеме FastAPI, наше решение выделяется своей полнотой и специализацией именно на задачах тестирования. Это делает его ценным дополнением к существующим ресурсам для разработчиков FastAPI.</p> <p>Мы продолжаем развивать этот инструментарий и будем рады обратной связи от сообщества. Если у вас есть идеи по улучшению или вы нашли ошибку, пожалуйста, создайте issue в нашем репозитории на GitHub.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": ".", "features": [], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script> <script src=assets/javascripts/bundle.d6f25eb3.min.js></script> </body> </html>