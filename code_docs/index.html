<!doctype html><html lang=ru class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://denisxab.github.io/fastapi-accelerator/code_docs/ rel=canonical><link href=../test_logic/ rel=prev><link href=../plan/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.38"><title>Code Docs - Fastapi Accelerator</title><link rel=stylesheet href=../assets/stylesheets/main.8c3ca2c6.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#code-docs class=md-skip> Перейти к содержанию </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул"> <a href=.. title="Fastapi Accelerator" class="md-header__button md-logo" aria-label="Fastapi Accelerator" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Fastapi Accelerator </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Code Docs </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label="Выберите язык"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=./ hreflang=ru class=md-select__link> Русский </a> </li> <li class=md-select__item> <a href=../en/code_docs/ hreflang=en class=md-select__link> English </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Поиск placeholder=Поиск autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Поиск> <button type=reset class="md-search__icon md-icon" title=Очистить aria-label=Очистить tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Инициализация поиска </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Навигация data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Fastapi Accelerator" class="md-nav__button md-logo" aria-label="Fastapi Accelerator" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Fastapi Accelerator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../info_files/ class=md-nav__link> <span class=md-ellipsis> File descriptions </span> </a> </li> <li class=md-nav__item> <a href=../business_logic/ class=md-nav__link> <span class=md-ellipsis> Business logic </span> </a> </li> <li class=md-nav__item> <a href=../test_logic/ class=md-nav__link> <span class=md-ellipsis> Testing logic </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Code Docs </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Code Docs </span> </a> <nav class="md-nav md-nav--secondary" aria-label=Содержание> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Содержание </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fastapi_acceleratorauth_jwt class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.auth_jwt </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.auth_jwt> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt class=md-nav__link> <span class=md-ellipsis> auth_jwt </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT class=md-nav__link> <span class=md-ellipsis> BaseAuthJWT </span> </a> <nav class=md-nav aria-label=BaseAuthJWT> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT.add_jwt_body class=md-nav__link> <span class=md-ellipsis> add_jwt_body </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT.check_auth class=md-nav__link> <span class=md-ellipsis> check_auth </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT.mount_auth class=md-nav__link> <span class=md-ellipsis> mount_auth </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.jwt_auth class=md-nav__link> <span class=md-ellipsis> jwt_auth </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorcache class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.cache </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.cache> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.cache class=md-nav__link> <span class=md-ellipsis> cache </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.cache.cache_redis class=md-nav__link> <span class=md-ellipsis> cache_redis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorexception class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.exception </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.exception> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.exception class=md-nav__link> <span class=md-ellipsis> exception </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.exception.custom_http_exception_handler class=md-nav__link> <span class=md-ellipsis> custom_http_exception_handler </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratormiddleware class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.middleware </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.middleware class=md-nav__link> <span class=md-ellipsis> middleware </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.middleware.log_request_response class=md-nav__link> <span class=md-ellipsis> log_request_response </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.middleware.request_log_format class=md-nav__link> <span class=md-ellipsis> request_log_format </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorpaginator class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.paginator </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.paginator class=md-nav__link> <span class=md-ellipsis> paginator </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_acceleratortimezone class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.timezone </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.timezone> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.timezone class=md-nav__link> <span class=md-ellipsis> timezone </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.timezone.get_datetime_now class=md-nav__link> <span class=md-ellipsis> get_datetime_now </span> </a> <nav class=md-nav aria-label=get_datetime_now> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.timezone.get_datetime_now--_1 class=md-nav__link> <span class=md-ellipsis> Установка врменной зоны для проекта </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorutils class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.utils </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.utils> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.NoInstanceMeta class=md-nav__link> <span class=md-ellipsis> NoInstanceMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.SingletonMeta class=md-nav__link> <span class=md-ellipsis> SingletonMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.run_async class=md-nav__link> <span class=md-ellipsis> run_async </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.singleton class=md-nav__link> <span class=md-ellipsis> singleton </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.to_namedtuple class=md-nav__link> <span class=md-ellipsis> to_namedtuple </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorviewset class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.viewset </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.viewset> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset class=md-nav__link> <span class=md-ellipsis> viewset </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.AppOrm class=md-nav__link> <span class=md-ellipsis> AppOrm </span> </a> <nav class=md-nav aria-label=AppOrm> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.AppOrm.aget_orm class=md-nav__link> <span class=md-ellipsis> aget_orm </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.BaseViewSet class=md-nav__link> <span class=md-ellipsis> BaseViewSet </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.GenericViewSet class=md-nav__link> <span class=md-ellipsis> GenericViewSet </span> </a> <nav class=md-nav aria-label=GenericViewSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.GenericViewSet.__str__ class=md-nav__link> <span class=md-ellipsis> __str__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetCreate class=md-nav__link> <span class=md-ellipsis> ViewSetCreate </span> </a> <nav class=md-nav aria-label=ViewSetCreate> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetCreate.create class=md-nav__link> <span class=md-ellipsis> create </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetCreate.db_create class=md-nav__link> <span class=md-ellipsis> db_create </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetDelete class=md-nav__link> <span class=md-ellipsis> ViewSetDelete </span> </a> <nav class=md-nav aria-label=ViewSetDelete> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetDelete.db_delete class=md-nav__link> <span class=md-ellipsis> db_delete </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetDelete.delete class=md-nav__link> <span class=md-ellipsis> delete </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetList class=md-nav__link> <span class=md-ellipsis> ViewSetList </span> </a> <nav class=md-nav aria-label=ViewSetList> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetList.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetList.list_paginator class=md-nav__link> <span class=md-ellipsis> list_paginator </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetUpdate class=md-nav__link> <span class=md-ellipsis> ViewSetUpdate </span> </a> <nav class=md-nav aria-label=ViewSetUpdate> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetUpdate.db_update class=md-nav__link> <span class=md-ellipsis> db_update </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetUpdate.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratordb class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.db </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.db> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db class=md-nav__link> <span class=md-ellipsis> db </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseDatabaseManager class=md-nav__link> <span class=md-ellipsis> BaseDatabaseManager </span> </a> <nav class=md-nav aria-label=BaseDatabaseManager> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseDatabaseManager.check_dev class=md-nav__link> <span class=md-ellipsis> check_dev </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm class=md-nav__link> <span class=md-ellipsis> BaseOrm </span> </a> <nav class=md-nav aria-label=BaseOrm> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.delete class=md-nav__link> <span class=md-ellipsis> delete </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.get class=md-nav__link> <span class=md-ellipsis> get </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.get_list class=md-nav__link> <span class=md-ellipsis> get_list </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin class=md-nav__link> <span class=md-ellipsis> DatabaseAsyncSessionMixin </span> </a> <nav class=md-nav aria-label=DatabaseAsyncSessionMixin> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_orm class=md-nav__link> <span class=md-ellipsis> aget_orm </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_session class=md-nav__link> <span class=md-ellipsis> aget_session </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_session_transaction class=md-nav__link> <span class=md-ellipsis> aget_session_transaction </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.dispose class=md-nav__link> <span class=md-ellipsis> dispose </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin class=md-nav__link> <span class=md-ellipsis> DatabaseSyncSessionMixin </span> </a> <nav class=md-nav aria-label=DatabaseSyncSessionMixin> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.clear_all class=md-nav__link> <span class=md-ellipsis> clear_all </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.create_all class=md-nav__link> <span class=md-ellipsis> create_all </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.drop_all class=md-nav__link> <span class=md-ellipsis> drop_all </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.get_metadata class=md-nav__link> <span class=md-ellipsis> get_metadata </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.get_session class=md-nav__link> <span class=md-ellipsis> get_session </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.get_session_transaction class=md-nav__link> <span class=md-ellipsis> get_session_transaction </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsync class=md-nav__link> <span class=md-ellipsis> OrmAsync </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem class=md-nav__link> <span class=md-ellipsis> OrmAsyncItem </span> </a> <nav class=md-nav aria-label=OrmAsyncItem> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.create_item class=md-nav__link> <span class=md-ellipsis> create_item </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.delete_item class=md-nav__link> <span class=md-ellipsis> delete_item </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.eager_refresh class=md-nav__link> <span class=md-ellipsis> eager_refresh </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.get_item class=md-nav__link> <span class=md-ellipsis> get_item </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.update_item class=md-nav__link> <span class=md-ellipsis> update_item </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.SingletonMeta class=md-nav__link> <span class=md-ellipsis> SingletonMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.deep_instance class=md-nav__link> <span class=md-ellipsis> deep_instance </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.get_pk class=md-nav__link> <span class=md-ellipsis> get_pk </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorintegration class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.integration </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.integration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration class=md-nav__link> <span class=md-ellipsis> integration </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.ApiHTTP class=md-nav__link> <span class=md-ellipsis> ApiHTTP </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.BaseIntegration class=md-nav__link> <span class=md-ellipsis> BaseIntegration </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.BaseStabilityPattern class=md-nav__link> <span class=md-ellipsis> BaseStabilityPattern </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.CircuitBreakerError class=md-nav__link> <span class=md-ellipsis> CircuitBreakerError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration class=md-nav__link> <span class=md-ellipsis> EndpointsDeclaration </span> </a> <nav class=md-nav aria-label=EndpointsDeclaration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration.Schema class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration.SchemaError class=md-nav__link> <span class=md-ellipsis> SchemaError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.HTTPMethod class=md-nav__link> <span class=md-ellipsis> HTTPMethod </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.IntegrationHTTP class=md-nav__link> <span class=md-ellipsis> IntegrationHTTP </span> </a> <nav class=md-nav aria-label=IntegrationHTTP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.IntegrationHTTP.docs class=md-nav__link> <span class=md-ellipsis> docs </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.IntegrationHTTP.endpoint class=md-nav__link> <span class=md-ellipsis> endpoint </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.MaxRetriesExceededError class=md-nav__link> <span class=md-ellipsis> MaxRetriesExceededError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.StabilityError class=md-nav__link> <span class=md-ellipsis> StabilityError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.StabilityTimeoutError class=md-nav__link> <span class=md-ellipsis> StabilityTimeoutError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.ThrottlingError class=md-nav__link> <span class=md-ellipsis> ThrottlingError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp class=md-nav__link> <span class=md-ellipsis> sp </span> </a> <nav class=md-nav aria-label=sp> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.CircuitBreaker class=md-nav__link> <span class=md-ellipsis> CircuitBreaker </span> </a> <nav class=md-nav aria-label=CircuitBreaker> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.CircuitBreaker.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Fallback class=md-nav__link> <span class=md-ellipsis> Fallback </span> </a> <nav class=md-nav aria-label=Fallback> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Fallback.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.RetryPattern class=md-nav__link> <span class=md-ellipsis> RetryPattern </span> </a> <nav class=md-nav aria-label=RetryPattern> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.RetryPattern.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Throttling class=md-nav__link> <span class=md-ellipsis> Throttling </span> </a> <nav class=md-nav aria-label=Throttling> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Throttling.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Timeout class=md-nav__link> <span class=md-ellipsis> Timeout </span> </a> <nav class=md-nav aria-label=Timeout> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Timeout.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.convert_response class=md-nav__link> <span class=md-ellipsis> convert_response </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.wraper_endpoint class=md-nav__link> <span class=md-ellipsis> wraper_endpoint </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratortestutils class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.testutils </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.testutils> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils class=md-nav__link> <span class=md-ellipsis> testutils </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.ApiHTTP class=md-nav__link> <span class=md-ellipsis> ApiHTTP </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT class=md-nav__link> <span class=md-ellipsis> BaseAuthJWT </span> </a> <nav class=md-nav aria-label=BaseAuthJWT> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT.add_jwt_body class=md-nav__link> <span class=md-ellipsis> add_jwt_body </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT.check_auth class=md-nav__link> <span class=md-ellipsis> check_auth </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT.mount_auth class=md-nav__link> <span class=md-ellipsis> mount_auth </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJwtPytest class=md-nav__link> <span class=md-ellipsis> BaseAuthJwtPytest </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest class=md-nav__link> <span class=md-ellipsis> BasePytest </span> </a> <nav class=md-nav aria-label=BasePytest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setUp class=md-nav__link> <span class=md-ellipsis> setUp </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setUpClass class=md-nav__link> <span class=md-ellipsis> setUpClass </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setup_class class=md-nav__link> <span class=md-ellipsis> setup_class </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setup_method class=md-nav__link> <span class=md-ellipsis> setup_method </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.tearDown class=md-nav__link> <span class=md-ellipsis> tearDown </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.tearDownClass class=md-nav__link> <span class=md-ellipsis> tearDownClass </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.teardown_class class=md-nav__link> <span class=md-ellipsis> teardown_class </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.teardown_method class=md-nav__link> <span class=md-ellipsis> teardown_method </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration class=md-nav__link> <span class=md-ellipsis> EndpointsDeclaration </span> </a> <nav class=md-nav aria-label=EndpointsDeclaration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration.Schema class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration.SchemaError class=md-nav__link> <span class=md-ellipsis> SchemaError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.HTTPMethod class=md-nav__link> <span class=md-ellipsis> HTTPMethod </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.MockRules class=md-nav__link> <span class=md-ellipsis> MockRules </span> </a> <nav class=md-nav aria-label=MockRules> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.MockRules.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SQLQueryTracker class=md-nav__link> <span class=md-ellipsis> SQLQueryTracker </span> </a> <nav class=md-nav aria-label=SQLQueryTracker> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SQLQueryTracker.add class=md-nav__link> <span class=md-ellipsis> add </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SettingTest class=md-nav__link> <span class=md-ellipsis> SettingTest </span> </a> <nav class=md-nav aria-label=SettingTest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SettingTest.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SingletonMeta class=md-nav__link> <span class=md-ellipsis> SingletonMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.TrackerNameTuple class=md-nav__link> <span class=md-ellipsis> TrackerNameTuple </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.apply_fixture_db class=md-nav__link> <span class=md-ellipsis> apply_fixture_db </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.check_response_json class=md-nav__link> <span class=md-ellipsis> check_response_json </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.client class=md-nav__link> <span class=md-ellipsis> client </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.client_auth_jwt class=md-nav__link> <span class=md-ellipsis> client_auth_jwt </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.common_clean_table class=md-nav__link> <span class=md-ellipsis> common_clean_table </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.common_client class=md-nav__link> <span class=md-ellipsis> common_client </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.common_setup_database class=md-nav__link> <span class=md-ellipsis> common_setup_database </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.db_session class=md-nav__link> <span class=md-ellipsis> db_session </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.fixtures class=md-nav__link> <span class=md-ellipsis> fixtures </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.patch_integration class=md-nav__link> <span class=md-ellipsis> patch_integration </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.rm_key_from_deep_dict class=md-nav__link> <span class=md-ellipsis> rm_key_from_deep_dict </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.run_async class=md-nav__link> <span class=md-ellipsis> run_async </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.track_queries class=md-nav__link> <span class=md-ellipsis> track_queries </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.url_path_for class=md-nav__link> <span class=md-ellipsis> url_path_for </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../plan/ class=md-nav__link> <span class=md-ellipsis> Plan </span> </a> </li> <li class=md-nav__item> <a href=../about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=Содержание> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Содержание </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fastapi_acceleratorauth_jwt class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.auth_jwt </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.auth_jwt> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt class=md-nav__link> <span class=md-ellipsis> auth_jwt </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT class=md-nav__link> <span class=md-ellipsis> BaseAuthJWT </span> </a> <nav class=md-nav aria-label=BaseAuthJWT> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT.add_jwt_body class=md-nav__link> <span class=md-ellipsis> add_jwt_body </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT.check_auth class=md-nav__link> <span class=md-ellipsis> check_auth </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.BaseAuthJWT.mount_auth class=md-nav__link> <span class=md-ellipsis> mount_auth </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.auth_jwt.jwt_auth class=md-nav__link> <span class=md-ellipsis> jwt_auth </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorcache class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.cache </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.cache> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.cache class=md-nav__link> <span class=md-ellipsis> cache </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.cache.cache_redis class=md-nav__link> <span class=md-ellipsis> cache_redis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorexception class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.exception </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.exception> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.exception class=md-nav__link> <span class=md-ellipsis> exception </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.exception.custom_http_exception_handler class=md-nav__link> <span class=md-ellipsis> custom_http_exception_handler </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratormiddleware class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.middleware </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.middleware class=md-nav__link> <span class=md-ellipsis> middleware </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.middleware.log_request_response class=md-nav__link> <span class=md-ellipsis> log_request_response </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.middleware.request_log_format class=md-nav__link> <span class=md-ellipsis> request_log_format </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorpaginator class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.paginator </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.paginator class=md-nav__link> <span class=md-ellipsis> paginator </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_acceleratortimezone class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.timezone </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.timezone> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.timezone class=md-nav__link> <span class=md-ellipsis> timezone </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.timezone.get_datetime_now class=md-nav__link> <span class=md-ellipsis> get_datetime_now </span> </a> <nav class=md-nav aria-label=get_datetime_now> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.timezone.get_datetime_now--_1 class=md-nav__link> <span class=md-ellipsis> Установка врменной зоны для проекта </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorutils class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.utils </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.utils> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.NoInstanceMeta class=md-nav__link> <span class=md-ellipsis> NoInstanceMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.SingletonMeta class=md-nav__link> <span class=md-ellipsis> SingletonMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.run_async class=md-nav__link> <span class=md-ellipsis> run_async </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.singleton class=md-nav__link> <span class=md-ellipsis> singleton </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.utils.to_namedtuple class=md-nav__link> <span class=md-ellipsis> to_namedtuple </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorviewset class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.viewset </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.viewset> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset class=md-nav__link> <span class=md-ellipsis> viewset </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.AppOrm class=md-nav__link> <span class=md-ellipsis> AppOrm </span> </a> <nav class=md-nav aria-label=AppOrm> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.AppOrm.aget_orm class=md-nav__link> <span class=md-ellipsis> aget_orm </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.BaseViewSet class=md-nav__link> <span class=md-ellipsis> BaseViewSet </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.GenericViewSet class=md-nav__link> <span class=md-ellipsis> GenericViewSet </span> </a> <nav class=md-nav aria-label=GenericViewSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.GenericViewSet.__str__ class=md-nav__link> <span class=md-ellipsis> __str__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetCreate class=md-nav__link> <span class=md-ellipsis> ViewSetCreate </span> </a> <nav class=md-nav aria-label=ViewSetCreate> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetCreate.create class=md-nav__link> <span class=md-ellipsis> create </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetCreate.db_create class=md-nav__link> <span class=md-ellipsis> db_create </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetDelete class=md-nav__link> <span class=md-ellipsis> ViewSetDelete </span> </a> <nav class=md-nav aria-label=ViewSetDelete> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetDelete.db_delete class=md-nav__link> <span class=md-ellipsis> db_delete </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetDelete.delete class=md-nav__link> <span class=md-ellipsis> delete </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetList class=md-nav__link> <span class=md-ellipsis> ViewSetList </span> </a> <nav class=md-nav aria-label=ViewSetList> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetList.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetList.list_paginator class=md-nav__link> <span class=md-ellipsis> list_paginator </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetUpdate class=md-nav__link> <span class=md-ellipsis> ViewSetUpdate </span> </a> <nav class=md-nav aria-label=ViewSetUpdate> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetUpdate.db_update class=md-nav__link> <span class=md-ellipsis> db_update </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.viewset.ViewSetUpdate.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratordb class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.db </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.db> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db class=md-nav__link> <span class=md-ellipsis> db </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseDatabaseManager class=md-nav__link> <span class=md-ellipsis> BaseDatabaseManager </span> </a> <nav class=md-nav aria-label=BaseDatabaseManager> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseDatabaseManager.check_dev class=md-nav__link> <span class=md-ellipsis> check_dev </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm class=md-nav__link> <span class=md-ellipsis> BaseOrm </span> </a> <nav class=md-nav aria-label=BaseOrm> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.delete class=md-nav__link> <span class=md-ellipsis> delete </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.get class=md-nav__link> <span class=md-ellipsis> get </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.get_list class=md-nav__link> <span class=md-ellipsis> get_list </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.BaseOrm.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin class=md-nav__link> <span class=md-ellipsis> DatabaseAsyncSessionMixin </span> </a> <nav class=md-nav aria-label=DatabaseAsyncSessionMixin> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_orm class=md-nav__link> <span class=md-ellipsis> aget_orm </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_session class=md-nav__link> <span class=md-ellipsis> aget_session </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_session_transaction class=md-nav__link> <span class=md-ellipsis> aget_session_transaction </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseAsyncSessionMixin.dispose class=md-nav__link> <span class=md-ellipsis> dispose </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin class=md-nav__link> <span class=md-ellipsis> DatabaseSyncSessionMixin </span> </a> <nav class=md-nav aria-label=DatabaseSyncSessionMixin> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.clear_all class=md-nav__link> <span class=md-ellipsis> clear_all </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.create_all class=md-nav__link> <span class=md-ellipsis> create_all </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.drop_all class=md-nav__link> <span class=md-ellipsis> drop_all </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.get_metadata class=md-nav__link> <span class=md-ellipsis> get_metadata </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.get_session class=md-nav__link> <span class=md-ellipsis> get_session </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.DatabaseSyncSessionMixin.get_session_transaction class=md-nav__link> <span class=md-ellipsis> get_session_transaction </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsync class=md-nav__link> <span class=md-ellipsis> OrmAsync </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem class=md-nav__link> <span class=md-ellipsis> OrmAsyncItem </span> </a> <nav class=md-nav aria-label=OrmAsyncItem> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.create_item class=md-nav__link> <span class=md-ellipsis> create_item </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.delete_item class=md-nav__link> <span class=md-ellipsis> delete_item </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.eager_refresh class=md-nav__link> <span class=md-ellipsis> eager_refresh </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.get_item class=md-nav__link> <span class=md-ellipsis> get_item </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.OrmAsyncItem.update_item class=md-nav__link> <span class=md-ellipsis> update_item </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.SingletonMeta class=md-nav__link> <span class=md-ellipsis> SingletonMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.deep_instance class=md-nav__link> <span class=md-ellipsis> deep_instance </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.db.get_pk class=md-nav__link> <span class=md-ellipsis> get_pk </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratorintegration class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.integration </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.integration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration class=md-nav__link> <span class=md-ellipsis> integration </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.ApiHTTP class=md-nav__link> <span class=md-ellipsis> ApiHTTP </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.BaseIntegration class=md-nav__link> <span class=md-ellipsis> BaseIntegration </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.BaseStabilityPattern class=md-nav__link> <span class=md-ellipsis> BaseStabilityPattern </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.CircuitBreakerError class=md-nav__link> <span class=md-ellipsis> CircuitBreakerError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration class=md-nav__link> <span class=md-ellipsis> EndpointsDeclaration </span> </a> <nav class=md-nav aria-label=EndpointsDeclaration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration.Schema class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration.SchemaError class=md-nav__link> <span class=md-ellipsis> SchemaError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.EndpointsDeclaration.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.HTTPMethod class=md-nav__link> <span class=md-ellipsis> HTTPMethod </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.IntegrationHTTP class=md-nav__link> <span class=md-ellipsis> IntegrationHTTP </span> </a> <nav class=md-nav aria-label=IntegrationHTTP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.IntegrationHTTP.docs class=md-nav__link> <span class=md-ellipsis> docs </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.IntegrationHTTP.endpoint class=md-nav__link> <span class=md-ellipsis> endpoint </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.MaxRetriesExceededError class=md-nav__link> <span class=md-ellipsis> MaxRetriesExceededError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.StabilityError class=md-nav__link> <span class=md-ellipsis> StabilityError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.StabilityTimeoutError class=md-nav__link> <span class=md-ellipsis> StabilityTimeoutError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.ThrottlingError class=md-nav__link> <span class=md-ellipsis> ThrottlingError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp class=md-nav__link> <span class=md-ellipsis> sp </span> </a> <nav class=md-nav aria-label=sp> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.CircuitBreaker class=md-nav__link> <span class=md-ellipsis> CircuitBreaker </span> </a> <nav class=md-nav aria-label=CircuitBreaker> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.CircuitBreaker.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Fallback class=md-nav__link> <span class=md-ellipsis> Fallback </span> </a> <nav class=md-nav aria-label=Fallback> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Fallback.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.RetryPattern class=md-nav__link> <span class=md-ellipsis> RetryPattern </span> </a> <nav class=md-nav aria-label=RetryPattern> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.RetryPattern.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Throttling class=md-nav__link> <span class=md-ellipsis> Throttling </span> </a> <nav class=md-nav aria-label=Throttling> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Throttling.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Timeout class=md-nav__link> <span class=md-ellipsis> Timeout </span> </a> <nav class=md-nav aria-label=Timeout> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.sp.Timeout.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.convert_response class=md-nav__link> <span class=md-ellipsis> convert_response </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.integration.wraper_endpoint class=md-nav__link> <span class=md-ellipsis> wraper_endpoint </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_acceleratortestutils class=md-nav__link> <span class=md-ellipsis> fastapi_accelerator.testutils </span> </a> <nav class=md-nav aria-label=fastapi_accelerator.testutils> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils class=md-nav__link> <span class=md-ellipsis> testutils </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.ApiHTTP class=md-nav__link> <span class=md-ellipsis> ApiHTTP </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT class=md-nav__link> <span class=md-ellipsis> BaseAuthJWT </span> </a> <nav class=md-nav aria-label=BaseAuthJWT> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT.add_jwt_body class=md-nav__link> <span class=md-ellipsis> add_jwt_body </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT.check_auth class=md-nav__link> <span class=md-ellipsis> check_auth </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJWT.mount_auth class=md-nav__link> <span class=md-ellipsis> mount_auth </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BaseAuthJwtPytest class=md-nav__link> <span class=md-ellipsis> BaseAuthJwtPytest </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest class=md-nav__link> <span class=md-ellipsis> BasePytest </span> </a> <nav class=md-nav aria-label=BasePytest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setUp class=md-nav__link> <span class=md-ellipsis> setUp </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setUpClass class=md-nav__link> <span class=md-ellipsis> setUpClass </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setup_class class=md-nav__link> <span class=md-ellipsis> setup_class </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.setup_method class=md-nav__link> <span class=md-ellipsis> setup_method </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.tearDown class=md-nav__link> <span class=md-ellipsis> tearDown </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.tearDownClass class=md-nav__link> <span class=md-ellipsis> tearDownClass </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.teardown_class class=md-nav__link> <span class=md-ellipsis> teardown_class </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.BasePytest.teardown_method class=md-nav__link> <span class=md-ellipsis> teardown_method </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration class=md-nav__link> <span class=md-ellipsis> EndpointsDeclaration </span> </a> <nav class=md-nav aria-label=EndpointsDeclaration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration.Schema class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration.SchemaError class=md-nav__link> <span class=md-ellipsis> SchemaError </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.EndpointsDeclaration.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.HTTPMethod class=md-nav__link> <span class=md-ellipsis> HTTPMethod </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.MockRules class=md-nav__link> <span class=md-ellipsis> MockRules </span> </a> <nav class=md-nav aria-label=MockRules> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.MockRules.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SQLQueryTracker class=md-nav__link> <span class=md-ellipsis> SQLQueryTracker </span> </a> <nav class=md-nav aria-label=SQLQueryTracker> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SQLQueryTracker.add class=md-nav__link> <span class=md-ellipsis> add </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SettingTest class=md-nav__link> <span class=md-ellipsis> SettingTest </span> </a> <nav class=md-nav aria-label=SettingTest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SettingTest.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.SingletonMeta class=md-nav__link> <span class=md-ellipsis> SingletonMeta </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.TrackerNameTuple class=md-nav__link> <span class=md-ellipsis> TrackerNameTuple </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.apply_fixture_db class=md-nav__link> <span class=md-ellipsis> apply_fixture_db </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.check_response_json class=md-nav__link> <span class=md-ellipsis> check_response_json </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.client class=md-nav__link> <span class=md-ellipsis> client </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.client_auth_jwt class=md-nav__link> <span class=md-ellipsis> client_auth_jwt </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.common_clean_table class=md-nav__link> <span class=md-ellipsis> common_clean_table </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.common_client class=md-nav__link> <span class=md-ellipsis> common_client </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.common_setup_database class=md-nav__link> <span class=md-ellipsis> common_setup_database </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.db_session class=md-nav__link> <span class=md-ellipsis> db_session </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.fixtures class=md-nav__link> <span class=md-ellipsis> fixtures </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.patch_integration class=md-nav__link> <span class=md-ellipsis> patch_integration </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.rm_key_from_deep_dict class=md-nav__link> <span class=md-ellipsis> rm_key_from_deep_dict </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.run_async class=md-nav__link> <span class=md-ellipsis> run_async </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.track_queries class=md-nav__link> <span class=md-ellipsis> track_queries </span> </a> </li> <li class=md-nav__item> <a href=#fastapi_accelerator.testutils.url_path_for class=md-nav__link> <span class=md-ellipsis> url_path_for </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=code-docs>Code Docs</h1> <h2 id=fastapi_acceleratorauth_jwt>fastapi_accelerator.auth_jwt</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.auth_jwt></a> <div class="doc doc-contents first"> <p>Модуль для аутентификации по JWT</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.auth_jwt.BaseAuthJWT class="doc doc-heading"> <code>BaseAuthJWT</code> </h3> <div class="doc doc-contents "> <p>Пример:</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>AuthJWT</span><span class=p>(</span><span class=n>BaseAuthJWT</span><span class=p>):</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>username</span> <span class=o>==</span> <span class=s2>&quot;admin&quot;</span> <span class=ow>and</span> <span class=n>password</span> <span class=o>==</span> <span class=s2>&quot;admin&quot;</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>username</span><span class=o>.</span><span class=n>title</span><span class=p>()}</span>


<span class=c1># Подключить аутентификацию по JWT</span>
<span class=n>AuthJWT</span><span class=o>.</span><span class=n>mount_auth</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</code></pre></div> <p>Пример защиты API метода:</p> <div class=highlight><pre><span></span><code><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/cheack_protected&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseAuthJWT</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Пример:</span>

<span class=sd>    ```python</span>
<span class=sd>    class AuthJWT(BaseAuthJWT):</span>
<span class=sd>        async def check_auth(username: str, password: str) -&gt; bool:</span>
<span class=sd>            &quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
<span class=sd>            return username == &quot;admin&quot; and password == &quot;admin&quot;</span>

<span class=sd>        async def add_jwt_body(username: str) -&gt; dict:</span>
<span class=sd>            &quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>
<span class=sd>            return {&quot;version&quot;: username.title()}</span>


<span class=sd>    # Подключить аутентификацию по JWT</span>
<span class=sd>    AuthJWT.mount_auth(app)</span>
<span class=sd>    ```</span>

<span class=sd>    Пример защиты API метода:</span>

<span class=sd>    ```python</span>
<span class=sd>    @app.get(&quot;/cheack_protected&quot;, summary=&quot;Проверить аутентификацию по JWT&quot;)</span>
<span class=sd>    async def protected_route(jwt: dict = Depends(jwt_auth)):</span>
<span class=sd>        return {&quot;message&quot;: &quot;This is a protected route&quot;, &quot;user&quot;: jwt}</span>
<span class=sd>    ```</span>
<span class=sd>    &#39;&#39;&#39;</span>

    <span class=n>ALGORITHM</span> <span class=o>=</span> <span class=s2>&quot;HS256&quot;</span>
    <span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span> <span class=o>=</span> <span class=mi>30</span>
    <span class=c1># Установиться автоматически в mount_auth</span>
    <span class=n>secret_key</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>

    <span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>mount_auth</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>app</span><span class=p>:</span> <span class=n>FastAPI</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Подключение аутентификации по JWT&quot;&quot;&quot;</span>
        <span class=c1># Установить класс для аутентификации</span>
        <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>auth_jwt</span> <span class=o>=</span> <span class=bp>cls</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>SECRET_KEY</span>

        <span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/token&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Аутентификация по JWT&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>])</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>login</span><span class=p>(</span>
            <span class=n>user</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>OAuth2PasswordRequestForm</span><span class=p>,</span> <span class=n>Depends</span><span class=p>()],</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Token</span><span class=p>:</span>
            <span class=k>if</span> <span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>check_auth</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>user</span><span class=o>.</span><span class=n>password</span><span class=p>):</span>
                <span class=k>return</span> <span class=n>Token</span><span class=p>(</span>
                    <span class=n>access_token</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>_create_access_token</span><span class=p>(</span>
                        <span class=n>data</span><span class=o>=</span><span class=p>{</span>
                            <span class=s2>&quot;sub&quot;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span>
                            <span class=o>**</span><span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>),</span>
                        <span class=p>},</span>
                    <span class=p>),</span>
                    <span class=n>token_type</span><span class=o>=</span><span class=s2>&quot;bearer&quot;</span><span class=p>,</span>
                <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&quot;Invalid credentials&quot;</span><span class=p>)</span>

        <span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=s2>&quot;/check_protected&quot;</span><span class=p>,</span>
            <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>,</span>
            <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>],</span>
        <span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>

        <span class=k>return</span> <span class=n>login</span><span class=p>,</span> <span class=n>protected_route</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>_create_access_token</span><span class=p>(</span>
        <span class=bp>cls</span><span class=p>,</span>
        <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
        <span class=n>expires_delta</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>timedelta</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Создание JWT токена&quot;&quot;&quot;</span>
        <span class=n>to_encode</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>expires_delta</span><span class=p>:</span>
            <span class=n>expire</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>expires_delta</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>expire</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span>
                <span class=n>minutes</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span>
            <span class=p>)</span>
        <span class=n>to_encode</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&quot;exp&quot;</span><span class=p>:</span> <span class=n>expire</span><span class=p>})</span>
        <span class=n>encoded_jwt</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>to_encode</span><span class=p>,</span> <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>ALGORITHM</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>encoded_jwt</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>_verify_token</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>token</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка валидности JWT токена&quot;&quot;&quot;</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>payload</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span><span class=bp>cls</span><span class=o>.</span><span class=n>ALGORITHM</span><span class=p>])</span>
            <span class=k>return</span> <span class=n>payload</span>
        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>ExpiredSignatureError</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>
        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>InvalidTokenError</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.auth_jwt.BaseAuthJWT.add_jwt_body class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Функция для добавление дополнительных данных в JWT токен пользователя</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.auth_jwt.BaseAuthJWT.check_auth class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Проверка введенного логина и пароля.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
    <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.auth_jwt.BaseAuthJWT.mount_auth class="doc doc-heading"> <code class="highlight language-python"><span class=n>mount_auth</span><span class=p>(</span><span class=n>app</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Подключение аутентификации по JWT</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>mount_auth</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>app</span><span class=p>:</span> <span class=n>FastAPI</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Подключение аутентификации по JWT&quot;&quot;&quot;</span>
    <span class=c1># Установить класс для аутентификации</span>
    <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>auth_jwt</span> <span class=o>=</span> <span class=bp>cls</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>SECRET_KEY</span>

    <span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/token&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Аутентификация по JWT&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>])</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>login</span><span class=p>(</span>
        <span class=n>user</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>OAuth2PasswordRequestForm</span><span class=p>,</span> <span class=n>Depends</span><span class=p>()],</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Token</span><span class=p>:</span>
        <span class=k>if</span> <span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>check_auth</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>user</span><span class=o>.</span><span class=n>password</span><span class=p>):</span>
            <span class=k>return</span> <span class=n>Token</span><span class=p>(</span>
                <span class=n>access_token</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>_create_access_token</span><span class=p>(</span>
                    <span class=n>data</span><span class=o>=</span><span class=p>{</span>
                        <span class=s2>&quot;sub&quot;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span>
                        <span class=o>**</span><span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>),</span>
                    <span class=p>},</span>
                <span class=p>),</span>
                <span class=n>token_type</span><span class=o>=</span><span class=s2>&quot;bearer&quot;</span><span class=p>,</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&quot;Invalid credentials&quot;</span><span class=p>)</span>

    <span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=s2>&quot;/check_protected&quot;</span><span class=p>,</span>
        <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>,</span>
        <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>],</span>
    <span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>

    <span class=k>return</span> <span class=n>login</span><span class=p>,</span> <span class=n>protected_route</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.auth_jwt.jwt_auth class="doc doc-heading"> <code class="highlight language-python"><span class=n>jwt_auth</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>token</span><span class=o>=</span><span class=n>Depends</span><span class=p>(</span><span class=n>oauth2_scheme</span><span class=p>))</span></code> </h3> <div class="doc doc-contents "> <p>Depends для проверки JWT</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>jwt_auth</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>token</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>oauth2_scheme</span><span class=p>))</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Depends для проверки JWT&quot;&quot;&quot;</span>
    <span class=n>auth_jwt</span><span class=p>:</span> <span class=n>BaseAuthJWT</span> <span class=o>=</span> <span class=n>AUTH_JWT</span><span class=p>()</span> <span class=ow>or</span> <span class=n>AUTH_JWT</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>app</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>auth_jwt</span><span class=o>.</span><span class=n>_verify_token</span><span class=p>(</span><span class=n>token</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>payload</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_401_UNAUTHORIZED</span><span class=p>,</span>
            <span class=n>detail</span><span class=o>=</span><span class=s2>&quot;Could not validate credentials&quot;</span><span class=p>,</span>
            <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;WWW-Authenticate&quot;</span><span class=p>:</span> <span class=s2>&quot;Bearer&quot;</span><span class=p>},</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>payload</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratorcache>fastapi_accelerator.cache</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.cache></a> <div class="doc doc-contents first"> <p>Работа с кеш Redis</p> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.cache.cache_redis class="doc doc-heading"> <code class="highlight language-python"><span class=n>cache_redis</span><span class=p>(</span><span class=n>cache_class</span><span class=p>,</span> <span class=n>cache_ttl</span><span class=p>,</span> <span class=n>cache</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Декоратор для кеширования ответов API в Redis.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>cache_class</code></td> <td> <code><span title="fastapi_accelerator.cache.BaseCache">BaseCache</span></code> </td> <td> <div class=doc-md-description> <p>Класс кеша для взаимодействия с Redis.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>cache_ttl</code></td> <td> <code><span title="datetime.timedelta">timedelta</span></code> </td> <td> <div class=doc-md-description> <p>Время жизни кеша.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>cache</code></td> <td> <code>bool</code> </td> <td> <div class=doc-md-description> <p>Флаг, включающий или отключающий кеширование.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>ViewSetRetrieve</span><span class=p>(</span><span class=n>BaseViewSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>register_routes</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&#39;&#39;&#39;Регистраций API обработчиков&#39;&#39;&#39;</span>

        <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>/</span><span class=se>{{</span><span class=s2>item_uid</span><span class=se>}}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>)</span>
        <span class=nd>@cache_redis</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span><span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>get_item</span><span class=p>(</span>
            <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
            <span class=n>item_uid</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>),</span>
            <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>:</span>
            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                <span class=n>select</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_name_pk</span> <span class=o>==</span> <span class=n>item_uid</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=n>response</span>

        <span class=k>return</span> <span class=n>get_item</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>fastapi_accelerator/cache.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>cache_redis</span><span class=p>(</span><span class=n>cache_class</span><span class=p>:</span> <span class=n>BaseCache</span><span class=p>,</span> <span class=n>cache_ttl</span><span class=p>:</span> <span class=n>timedelta</span><span class=p>,</span> <span class=n>cache</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Декоратор для кеширования ответов API в Redis.</span>

<span class=sd>    Args:</span>
<span class=sd>        cache_class: Класс кеша для взаимодействия с Redis.</span>
<span class=sd>        cache_ttl: Время жизни кеша.</span>
<span class=sd>        cache: Флаг, включающий или отключающий кеширование.</span>

<span class=sd>    ```python</span>
<span class=sd>    class ViewSetRetrieve(BaseViewSet):</span>
<span class=sd>        def register_routes(self):</span>
<span class=sd>            &#39;&#39;&#39;Регистраций API обработчиков&#39;&#39;&#39;</span>

<span class=sd>            @self.router.get(f&quot;{self.prefix}/{{item_uid}}&quot;, tags=self.tags)</span>
<span class=sd>            @cache_redis(self.cache, self.cache_class, self.cache_ttl)</span>
<span class=sd>            async def get_item(</span>
<span class=sd>                request: Request,</span>
<span class=sd>                item_uid: str = Path(...),</span>
<span class=sd>                aorm: OrmAsync = Depends(AppOrm.aget_orm),</span>
<span class=sd>            ) -&gt; self.pydantic_model:</span>
<span class=sd>                response = await aorm.get(</span>
<span class=sd>                    select(self.db_model).filter(self._name_pk == item_uid)</span>
<span class=sd>                )</span>
<span class=sd>                return response</span>

<span class=sd>            return get_item</span>
<span class=sd>    ```</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
            <span class=n>request</span><span class=p>:</span> <span class=n>Request</span> <span class=o>=</span> <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;request&quot;</span><span class=p>]</span>

            <span class=n>cache_status</span> <span class=o>=</span> <span class=n>CACHE_STATUS</span><span class=p>()</span> <span class=ow>or</span> <span class=n>CACHE_STATUS</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>app</span><span class=p>)</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>cache_status</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>cache</span><span class=p>:</span>
                <span class=c1># кеш отключен</span>
                <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

            <span class=n>key_cache</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>?</span><span class=si>{</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>query</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=n>cache_response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cache_class</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key_cache</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>cache_response</span><span class=p>:</span>
                <span class=c1># Создаем ответ с заголовком, указывающим, что данные из кеша</span>
                <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
                    <span class=n>content</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>cache_response</span><span class=p>),</span> <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;X-Cache&quot;</span><span class=p>:</span> <span class=s2>&quot;HIT&quot;</span><span class=p>}</span>
                <span class=p>)</span>

            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

            <span class=n>json_data</span> <span class=o>=</span> <span class=n>jsonable_encoder</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
            <span class=k>await</span> <span class=n>cache_class</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>key_cache</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>json_data</span><span class=p>),</span> <span class=n>ex</span><span class=o>=</span><span class=n>cache_ttl</span><span class=p>)</span>
            <span class=c1># Возвращаем результат с заголовком</span>
            <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=n>json_data</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;X-Cache&quot;</span><span class=p>:</span> <span class=s2>&quot;MISS&quot;</span><span class=p>})</span>

        <span class=k>return</span> <span class=n>wrapper</span>

    <span class=k>return</span> <span class=n>decorator</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratorexception>fastapi_accelerator.exception</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.exception></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.exception.custom_http_exception_handler class="doc doc-heading"> <code class="highlight language-python"><span class=n>custom_http_exception_handler</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>exc</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h3> <div class="doc doc-contents "> <p>Кастомный обработки исключений</p> <p>Подключение:</p> <pre><code>from starlette.exceptions import HTTPException as StarletteHTTPException
app.exception_handler(StarletteHTTPException)(custom_http_exception_handler)
</code></pre> <details class=quote> <summary>Source code in <code>fastapi_accelerator/exception.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>custom_http_exception_handler</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>StarletteHTTPException</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Кастомный обработки исключений</span>

<span class=sd>    Подключение:</span>

<span class=sd>        from starlette.exceptions import HTTPException as StarletteHTTPException</span>
<span class=sd>        app.exception_handler(StarletteHTTPException)(custom_http_exception_handler)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>exc_status_code</span> <span class=o>=</span> <span class=n>exc</span><span class=o>.</span><span class=n>status_code</span>
    <span class=k>if</span> <span class=n>exc_status_code</span> <span class=ow>in</span> <span class=p>(</span><span class=mi>400</span><span class=p>,</span> <span class=mi>401</span><span class=p>,</span> <span class=mi>403</span><span class=p>,</span> <span class=mi>404</span><span class=p>,</span> <span class=mi>429</span><span class=p>,</span> <span class=mi>503</span><span class=p>,</span> <span class=mi>504</span><span class=p>):</span>
        <span class=n>debug</span> <span class=o>=</span> <span class=n>DEBUG</span><span class=p>()</span> <span class=ow>or</span> <span class=n>DEBUG</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>app</span><span class=p>)</span>
        <span class=n>timezone</span> <span class=o>=</span> <span class=n>TIMEZONE</span><span class=p>()</span> <span class=ow>or</span> <span class=n>TIMEZONE</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>app</span><span class=p>)</span>

        <span class=n>content</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;detail&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>exc</span><span class=o>.</span><span class=n>detail</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;context&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request_log_format</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>exc_status_code</span><span class=p>)</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;erorr_id&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;datetime&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_datetime_now</span><span class=p>(</span><span class=n>timezone</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;host&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&quot;host&quot;</span><span class=p>]</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;http_method&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;request_path&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>path</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;query_params&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>query_params</span><span class=p>)</span>
        <span class=n>content</span><span class=p>[</span><span class=s2>&quot;user-agent&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;User-Agent&quot;</span><span class=p>,</span> <span class=s2>&quot;unknown&quot;</span><span class=p>)</span>

        <span class=c1># Добавляем трассировку стека в debug режиме</span>
        <span class=k>if</span> <span class=n>debug</span><span class=p>:</span>
            <span class=n>content</span><span class=p>[</span><span class=s2>&quot;traceback&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
            <span class=n>status_code</span><span class=o>=</span><span class=n>exc_status_code</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=n>content</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>headers</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=k>await</span> <span class=n>http_exception_handler</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>exc</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratormiddleware>fastapi_accelerator.middleware</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.middleware></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h2 id=fastapi_accelerator.middleware.log_request_response class="doc doc-heading"> <code class="highlight language-python"><span class=n>log_request_response</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h2> <div class="doc doc-contents "> <p>Логировать время выполение API запроса</p> <p>Подключение:</p> <p>app.middleware('http')(log_request_response)</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/middleware.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>log_request_response</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Логировать время выполение API запроса</span>

<span class=sd>    Подключение:</span>

<span class=sd>    app.middleware(&#39;http&#39;)(log_request_response)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
    <span class=n>process_time</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>

    <span class=n>debug</span> <span class=o>=</span> <span class=n>DEBUG</span><span class=p>()</span> <span class=ow>or</span> <span class=n>DEBUG</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>app</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>debug</span><span class=p>:</span>
        <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>)</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>request_log_format</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=n>process_time</span><span class=p>))</span>
    <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&quot;X-Process-Time&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>process_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> ms&quot;</span>
    <span class=k>return</span> <span class=n>response</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=fastapi_accelerator.middleware.request_log_format class="doc doc-heading"> <code class="highlight language-python"><span class=n>request_log_format</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>status_code</span><span class=p>,</span> <span class=n>process_time</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Форматировать запрос в лог строку</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/middleware.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>request_log_format</span><span class=p>(</span>
    <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>status_code</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>process_time</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Форматировать запрос в лог строку&quot;&quot;&quot;</span>
    <span class=n>query</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>query</span>
    <span class=k>return</span> <span class=p>(</span>
        <span class=s1>&#39;</span><span class=si>{host}</span><span class=s1>:</span><span class=si>{port}</span><span class=s1> - &quot;</span><span class=si>{method}</span><span class=s1> </span><span class=si>{path}{query}</span><span class=s1>&quot; - </span><span class=si>{status_code}{process_time}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>host</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>host</span><span class=p>,</span>
            <span class=n>port</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>port</span><span class=p>,</span>
            <span class=n>method</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
            <span class=n>path</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
            <span class=n>query</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;?</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>if</span> <span class=n>query</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
            <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
            <span class=n>process_time</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot; - [</span><span class=si>{</span><span class=n>process_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> ms]&quot;</span> <span class=k>if</span> <span class=n>process_time</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
        <span class=p>)</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><p>options: show_source: true heading_level: 3</p> <h2 id=fastapi_acceleratorpaginator>fastapi_accelerator.paginator</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.paginator></a> <div class="doc doc-contents first"> <p>Модуль дял пагиации овтета</p> <div class="doc doc-children"> </div> </div> </div><p>options: show_source: true heading_level: 3</p> <h2 id=fastapi_acceleratortimezone>fastapi_accelerator.timezone</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.timezone></a> <div class="doc doc-contents first"> <p>Модуль для работы со временем и временными зонами</p> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.timezone.get_datetime_now class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_datetime_now</span><span class=p>(</span><span class=n>timezone</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Получить текущие время с учетом тайм зоны</p> <h4 id=fastapi_accelerator.timezone.get_datetime_now--_1>Установка врменной зоны для проекта</h4> <p>app.state.TIMEZONE = moscow_tz</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/timezone.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_datetime_now</span><span class=p>(</span><span class=n>timezone</span><span class=p>:</span> <span class=n>pytz</span><span class=o>.</span><span class=n>timezone</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>datetime</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получить текущие время с учетом тайм зоны</span>

<span class=sd>    # Установка врменной зоны для проекта</span>
<span class=sd>    app.state.TIMEZONE = moscow_tz</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratorutils>fastapi_accelerator.utils</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.utils></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.utils.NoInstanceMeta class="doc doc-heading"> <code>NoInstanceMeta</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>type</code></p> <p>Нельзя создавать экземпляры этого класса</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>NoInstanceMeta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Нельзя создавать экземпляры этого класса&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;You cannot create instances of this class&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.utils.SingletonMeta class="doc doc-heading"> <code>SingletonMeta</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>type</code></p> <p>Мета класс для реализации паттерна Одиночка</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SingletonMeta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Мета класс для реализации паттерна Одиночка&quot;&quot;&quot;</span>

    <span class=n>instance</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>SingletonMeta</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__call__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.utils.run_async class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_async</span><span class=p>(</span><span class=n>async_function</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Синхронная обертка для асинхронного вызова</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>run_async</span><span class=p>(</span><span class=n>async_function</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Синхронная обертка для асинхронного вызова&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>run_until_complete</span><span class=p>(</span><span class=n>async_function</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.utils.singleton class="doc doc-heading"> <code class="highlight language-python"><span class=n>singleton</span><span class=p>(</span><span class=n>func</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Декоратор для реализации паттерна Одиночка</p> <p>Пример использования:</p> <pre><code>@singleton
def CACHE_STATUS(app=None) -&gt; bool:
    return app.state.CACHE_STATUS

cache_status = CACHE_STATUS() or CACHE_STATUS(request.app)
</code></pre> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>singleton</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Декоратор для реализации паттерна Одиночка</span>

<span class=sd>    Пример использования:</span>

<span class=sd>        @singleton</span>
<span class=sd>        def CACHE_STATUS(app=None) -&gt; bool:</span>
<span class=sd>            return app.state.CACHE_STATUS</span>

<span class=sd>        cache_status = CACHE_STATUS() or CACHE_STATUS(request.app)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>instance</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=k>nonlocal</span> <span class=n>instance</span>
        <span class=k>if</span> <span class=n>instance</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>instance</span>
        <span class=k>if</span> <span class=n>instance</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=p>(</span><span class=ow>not</span> <span class=n>args</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>kwargs</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>False</span>
        <span class=k>if</span> <span class=n>instance</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>instance</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>instance</span>

    <span class=k>return</span> <span class=n>wrapper</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.utils.to_namedtuple class="doc doc-heading"> <code class="highlight language-python"><span class=n>to_namedtuple</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Вернуть именованный кортеж</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>to_namedtuple</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>NamedTuple</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Вернуть именованный кортеж&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s2>&quot;CommonNameTuple&quot;</span><span class=p>,</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>keys</span><span class=p>())(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratorviewset>fastapi_accelerator.viewset</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.viewset></a> <div class="doc doc-contents first"> <p>Модуль для высокоуровневой работы с API обработками используя подход ViewSet которые автоматизируют базовый CRUD функционал, и поваляют гибко переопределять логику ViewSet</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.AppOrm class="doc doc-heading"> <code>AppOrm</code> </h3> <div class="doc doc-contents "> <p>Брать методы получения сессии из настроек APP DATABASE_MANAGER</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>AppOrm</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Брать методы получения сессии из настроек APP DATABASE_MANAGER&quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>aget_orm</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Метод получения сессии берем из настоек APP&quot;&quot;&quot;</span>
        <span class=n>database_manager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span> <span class=o>=</span> <span class=n>DATABASE_MANAGER</span><span class=p>()</span> <span class=ow>or</span> <span class=n>DATABASE_MANAGER</span><span class=p>(</span>
            <span class=n>request</span><span class=o>.</span><span class=n>app</span>
        <span class=p>)</span>
        <span class=k>async</span> <span class=k>for</span> <span class=n>orm</span> <span class=ow>in</span> <span class=n>database_manager</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>():</span>
            <span class=k>yield</span> <span class=n>orm</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.AppOrm.aget_orm class="doc doc-heading"> <code class="highlight language-python"><span class=n>aget_orm</span><span class=p>(</span><span class=n>request</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Метод получения сессии берем из настоек APP</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>aget_orm</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Метод получения сессии берем из настоек APP&quot;&quot;&quot;</span>
    <span class=n>database_manager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span> <span class=o>=</span> <span class=n>DATABASE_MANAGER</span><span class=p>()</span> <span class=ow>or</span> <span class=n>DATABASE_MANAGER</span><span class=p>(</span>
        <span class=n>request</span><span class=o>.</span><span class=n>app</span>
    <span class=p>)</span>
    <span class=k>async</span> <span class=k>for</span> <span class=n>orm</span> <span class=ow>in</span> <span class=n>database_manager</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>():</span>
        <span class=k>yield</span> <span class=n>orm</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.BaseViewSet class="doc doc-heading"> <code>BaseViewSet</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title="abc.ABC">ABC</span></code></p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseViewSet</span><span class=p>(</span><span class=n>abc</span><span class=o>.</span><span class=n>ABC</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>_register_endpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Регистраций API обработчиков&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.GenericViewSet class="doc doc-heading"> <code>GenericViewSet</code> </h3> <div class="doc doc-contents "> <p>from app.api.v1.schemas.file import File from app.models.file import File as FileDb</p> <p>router = APIRouter()</p> <p>class FileViewSet(FullViewSet): db_model = FileDb pydantic_model = File</p> <p>router.views = [ FileViewSet().as_view(router, prefix="/file"), ]</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>GenericViewSet</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    from app.api.v1.schemas.file import File</span>
<span class=sd>    from app.models.file import File as FileDb</span>

<span class=sd>    router = APIRouter()</span>

<span class=sd>    class FileViewSet(FullViewSet):</span>
<span class=sd>        db_model = FileDb</span>
<span class=sd>        pydantic_model = File</span>

<span class=sd>    router.views = [</span>
<span class=sd>        FileViewSet().as_view(router, prefix=&quot;/file&quot;),</span>
<span class=sd>    ]</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Модель БД SqlAlchemy</span>
    <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span>
    <span class=c1># Модель Схемы</span>
    <span class=n>pydantic_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>]</span>

    <span class=c1># Теги для URL</span>
    <span class=n>tags</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span>

    <span class=c1># Пагинация для List</span>
    <span class=n>paginator_class</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BasePaginatorClass</span><span class=p>]</span>

    <span class=c1># Класс для кешировать ответ List, Retrieve</span>
    <span class=n>cache_class</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseCache</span><span class=p>]</span>
    <span class=c1># Время жизни ответа в кеше</span>
    <span class=n>cache_ttl</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>timedelta</span><span class=p>]</span>

    <span class=c1># Включить поддержку вложенных схем pydantic</span>
    <span class=c1># это значит что будет происходить рекурсивное создание, обновление, удаление связанных записей</span>
    <span class=n>deep_schema</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span>

    <span class=c1># Зависимости на весь ViewSet</span>
    <span class=c1># Например можно указать аутентификацию по JWT `[Depends(jwt_auth)]`</span>
    <span class=n>dependencies</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=n>Callable</span><span class=p>]]</span>

    <span class=c1># Какой тип у первичного ключа для Api метода</span>
    <span class=n>type_item_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>type</span><span class=p>]</span>

    <span class=k>def</span> <span class=nf>as_view</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>router</span><span class=p>:</span> <span class=n>APIRouter</span><span class=p>,</span> <span class=n>prefix</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_mro_class</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>mro</span><span class=p>()</span>
        <span class=c1># Модель БД SqlAlchemy</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>router</span><span class=p>:</span> <span class=n>APIRouter</span> <span class=o>=</span> <span class=n>router</span>
        <span class=c1># Модель Схемы</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_model</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span>
        <span class=c1># Префикс для URL</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>prefix</span>
        <span class=c1># Теги</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>,</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>_mro_class</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=vm>__name__</span><span class=p>])</span>
        <span class=c1># Имя столбца с первичным ключом</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span>
        <span class=c1># Включить поддержку вложенных схем</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;deep_schema&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
        <span class=c1># Зависимости на весь ViewSet</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;dependencies&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=c1># Пагинация для List</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>paginator_class</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;paginator_class&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=c1># Какой тип у первичного ключа для Api метода</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>type_item_id</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span>
            <span class=s2>&quot;type_item_id&quot;</span><span class=p>,</span>
            <span class=c1># Попытаться определить тип автоматически по типу первичного ключа в модели</span>
            <span class=n>SQL_TO_PYTHON_TYPE</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                <span class=n>class_mapper</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>primary_key</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>type</span><span class=o>.</span><span class=vm>__class__</span><span class=p>,</span>
                <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>UUID</span><span class=p>],</span>
            <span class=p>),</span>
        <span class=p>)</span>

        <span class=c1># Логика кеширования</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>if</span> <span class=n>cache_class</span> <span class=o>:=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;cache_class&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span> <span class=o>=</span> <span class=n>cache_class</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;cache_ttl&quot;</span><span class=p>,</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>3</span><span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=c1># Подключить API обработчики</span>
        <span class=k>for</span> <span class=bp>cls</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_mro_class</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>cls</span> <span class=ow>in</span> <span class=p>(</span>
                <span class=n>ViewSetList</span><span class=p>,</span>
                <span class=n>ViewSetCreate</span><span class=p>,</span>
                <span class=n>ViewSetRetrieve</span><span class=p>,</span>
                <span class=n>ViewSetUpdate</span><span class=p>,</span>
                <span class=n>ViewSetDelete</span><span class=p>,</span>
            <span class=p>):</span>
                <span class=bp>cls</span><span class=o>.</span><span class=n>_register_endpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>

        <span class=c1># Документирование тегов</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>openapi_tag</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=p>)}</span>
        <span class=k>return</span> <span class=bp>self</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Сформировать документацию для ViewSet&quot;&quot;&quot;</span>
        <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;ViewSet&quot;</span>
        <span class=k>if</span> <span class=n>doc</span> <span class=o>:=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_mro_class</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=vm>__doc__</span><span class=p>:</span>
            <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{doc}</span><span class=s2>: </span><span class=si>{db_model}{dependencies}{cache}{deep_schema}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>doc</span><span class=o>=</span><span class=n>doc</span><span class=o>.</span><span class=n>strip</span><span class=p>(),</span>
                <span class=n>db_model</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot; **db_model**=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>dependencies</span><span class=o>=</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot; **dependencies**=[</span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>d</span><span class=o>.</span><span class=n>dependency</span><span class=o>.</span><span class=vm>__name__</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span><span class=p>)</span><span class=si>}</span><span class=s2>]&quot;</span>
                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
                    <span class=k>else</span> <span class=s2>&quot;&quot;</span>
                <span class=p>),</span>
                <span class=n>cache</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot; **cache**=On&quot;</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
                <span class=n>deep_schema</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot; **deep_schema**=On&quot;</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
            <span class=p>)</span>
        <span class=k>return</span> <span class=n>description</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.GenericViewSet.__str__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__str__</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>Сформировать документацию для ViewSet</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Сформировать документацию для ViewSet&quot;&quot;&quot;</span>
    <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;ViewSet&quot;</span>
    <span class=k>if</span> <span class=n>doc</span> <span class=o>:=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_mro_class</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=vm>__doc__</span><span class=p>:</span>
        <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{doc}</span><span class=s2>: </span><span class=si>{db_model}{dependencies}{cache}{deep_schema}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>doc</span><span class=o>=</span><span class=n>doc</span><span class=o>.</span><span class=n>strip</span><span class=p>(),</span>
            <span class=n>db_model</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot; **db_model**=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
            <span class=n>dependencies</span><span class=o>=</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot; **dependencies**=[</span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>d</span><span class=o>.</span><span class=n>dependency</span><span class=o>.</span><span class=vm>__name__</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span><span class=p>)</span><span class=si>}</span><span class=s2>]&quot;</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
                <span class=k>else</span> <span class=s2>&quot;&quot;</span>
            <span class=p>),</span>
            <span class=n>cache</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot; **cache**=On&quot;</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
            <span class=n>deep_schema</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot; **deep_schema**=On&quot;</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>description</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.ViewSetCreate class="doc doc-heading"> <code>ViewSetCreate</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.viewset.BaseViewSet" href="#fastapi_accelerator.viewset.BaseViewSet">BaseViewSet</a></code></p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ViewSetCreate</span><span class=p>(</span><span class=n>BaseViewSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>_register_endpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>_to_db_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Преобразовать элемент pydantic в db_item&quot;&quot;&quot;</span>
        <span class=n>db_item</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>deep_instance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item</span><span class=p>)</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span>
            <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>(</span><span class=o>**</span><span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>())</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>db_item</span>

    <span class=k>def</span> <span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;API обработки&quot;&quot;&quot;</span>

        <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
        <span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span>
            <span class=n>item</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>,</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>)</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_create</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>create_item</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>db_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>],</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>object</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для создание записи в БД.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>create_item</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_to_db_item</span><span class=p>(</span><span class=n>item</span><span class=p>),</span> <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetCreate.create class="doc doc-heading"> <code class="highlight language-python"><span class=n>create</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>API обработки</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;API обработки&quot;&quot;&quot;</span>

    <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
    <span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span>
        <span class=n>item</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>,</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>)</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>:</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_create</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>create_item</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetCreate.db_create class="doc doc-heading"> <code class="highlight language-python"><span class=n>db_create</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Функция для создание записи в БД.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>db_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>],</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>object</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Функция для создание записи в БД.&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>create_item</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_to_db_item</span><span class=p>(</span><span class=n>item</span><span class=p>),</span> <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.ViewSetDelete class="doc doc-heading"> <code>ViewSetDelete</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.viewset.BaseViewSet" href="#fastapi_accelerator.viewset.BaseViewSet">BaseViewSet</a></code></p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ViewSetDelete</span><span class=p>(</span><span class=n>BaseViewSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>_register_endpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;API обработки&quot;&quot;&quot;</span>

        <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>/</span><span class=se>{{</span><span class=s2>item_id</span><span class=se>}}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
        <span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>delete_item</span><span class=p>(</span>
            <span class=n>item_id</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>type_item_id</span><span class=p>,</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>)</span>
        <span class=p>):</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_delete</span><span class=p>(</span><span class=n>item_id</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>delete_item</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>db_delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>UUID</span><span class=p>],</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для удаления записи в БД&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>delete_item</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetDelete.db_delete class="doc doc-heading"> <code class="highlight language-python"><span class=n>db_delete</span><span class=p>(</span><span class=n>item_id</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Функция для удаления записи в БД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>db_delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>UUID</span><span class=p>],</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Функция для удаления записи в БД&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>delete_item</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetDelete.delete class="doc doc-heading"> <code class="highlight language-python"><span class=n>delete</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>API обработки</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;API обработки&quot;&quot;&quot;</span>

    <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>/</span><span class=se>{{</span><span class=s2>item_id</span><span class=se>}}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
    <span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>delete_item</span><span class=p>(</span>
        <span class=n>item_id</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>type_item_id</span><span class=p>,</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>)</span>
    <span class=p>):</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_delete</span><span class=p>(</span><span class=n>item_id</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>delete_item</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.ViewSetList class="doc doc-heading"> <code>ViewSetList</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.viewset.BaseViewSet" href="#fastapi_accelerator.viewset.BaseViewSet">BaseViewSet</a></code></p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ViewSetList</span><span class=p>(</span><span class=n>BaseViewSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>_register_endpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>list_paginator</span><span class=p>()</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>paginator_class</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>list</span><span class=p>()</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span> <span class=nf>get_offset</span><span class=p>(</span><span class=n>page</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>size</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>page</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>size</span>

    <span class=k>def</span> <span class=nf>list_paginator</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Обработчик API с пагинацией&quot;&quot;&quot;</span>

        <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
        <span class=p>)</span>
        <span class=nd>@cache_redis</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>get_list_items_paginator</span><span class=p>(</span>
            <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
            <span class=n>page</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
            <span class=n>size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
            <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>paginator_class</span><span class=o>.</span><span class=n>Schema</span><span class=p>:</span>
            <span class=n>offset</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_offset</span><span class=p>(</span><span class=n>page</span><span class=p>,</span> <span class=n>size</span><span class=p>)</span>
            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>get_list</span><span class=p>(</span>
                <span class=n>select</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name_pk</span><span class=p>)</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>offset</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>size</span><span class=p>),</span>
                <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>,</span>
                <span class=n>db_model</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>paginator_class</span><span class=o>.</span><span class=n>json</span><span class=p>(</span><span class=n>page</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>get_list_items_paginator</span>

    <span class=k>def</span> <span class=nf>list</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Обработчик API&quot;&quot;&quot;</span>

        <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
        <span class=p>)</span>
        <span class=nd>@cache_redis</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>get_list_items</span><span class=p>(</span>
            <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
            <span class=n>skip</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>gte</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
            <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
            <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>]:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>get_list</span><span class=p>(</span>
                <span class=n>select</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>skip</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>limit</span><span class=p>),</span>
                <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>,</span>
                <span class=n>db_model</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>get_list_items</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetList.list class="doc doc-heading"> <code class="highlight language-python"><span class=nb>list</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>Обработчик API</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>list</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Обработчик API&quot;&quot;&quot;</span>

    <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
    <span class=p>)</span>
    <span class=nd>@cache_redis</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_list_items</span><span class=p>(</span>
        <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
        <span class=n>skip</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>gte</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
        <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
        <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>]:</span>
        <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>get_list</span><span class=p>(</span>
            <span class=n>select</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>skip</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>limit</span><span class=p>),</span>
            <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>,</span>
            <span class=n>db_model</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>get_list_items</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetList.list_paginator class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_paginator</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>Обработчик API с пагинацией</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span>
<span class=normal>97</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>list_paginator</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Обработчик API с пагинацией&quot;&quot;&quot;</span>

    <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
    <span class=p>)</span>
    <span class=nd>@cache_redis</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cache_class</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_list_items_paginator</span><span class=p>(</span>
        <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
        <span class=n>page</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
        <span class=n>size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Query</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=n>gt</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
        <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>paginator_class</span><span class=o>.</span><span class=n>Schema</span><span class=p>:</span>
        <span class=n>offset</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_offset</span><span class=p>(</span><span class=n>page</span><span class=p>,</span> <span class=n>size</span><span class=p>)</span>
        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>get_list</span><span class=p>(</span>
            <span class=n>select</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name_pk</span><span class=p>)</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>offset</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>size</span><span class=p>),</span>
            <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span><span class=p>,</span>
            <span class=n>db_model</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>paginator_class</span><span class=o>.</span><span class=n>json</span><span class=p>(</span><span class=n>page</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>get_list_items_paginator</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.viewset.ViewSetUpdate class="doc doc-heading"> <code>ViewSetUpdate</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.viewset.BaseViewSet" href="#fastapi_accelerator.viewset.BaseViewSet">BaseViewSet</a></code></p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ViewSetUpdate</span><span class=p>(</span><span class=n>BaseViewSet</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>_register_endpoint</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>update</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;API обработки&quot;&quot;&quot;</span>

        <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>put</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>/</span><span class=se>{{</span><span class=s2>item_id</span><span class=se>}}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
        <span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span>
            <span class=n>item_id</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>type_item_id</span><span class=p>,</span>
            <span class=n>item</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>,</span>
            <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_update</span><span class=p>(</span><span class=n>item_id</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>update_item</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>db_update</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>UUID</span><span class=p>],</span> <span class=n>item</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>],</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>object</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для обновление записи в БД&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>update_item</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>(</span><span class=n>exclude_unset</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span> <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetUpdate.db_update class="doc doc-heading"> <code class="highlight language-python"><span class=n>db_update</span><span class=p>(</span><span class=n>item_id</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Функция для обновление записи в БД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>db_update</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>UUID</span><span class=p>],</span> <span class=n>item</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>],</span> <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>object</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Функция для обновление записи в БД&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=k>await</span> <span class=n>aorm</span><span class=o>.</span><span class=n>update_item</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>(</span><span class=n>exclude_unset</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span> <span class=n>deep</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>deep_schema</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.viewset.ViewSetUpdate.update class="doc doc-heading"> <code class="highlight language-python"><span class=n>update</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>API обработки</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/viewset.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;API обработки&quot;&quot;&quot;</span>

    <span class=nd>@self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>put</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>prefix</span><span class=si>}</span><span class=s2>/</span><span class=se>{{</span><span class=s2>item_id</span><span class=se>}}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tags</span><span class=p>,</span> <span class=n>dependencies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>dependencies</span>
    <span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span>
        <span class=n>item_id</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>type_item_id</span><span class=p>,</span>
        <span class=n>item</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>,</span>
        <span class=n>aorm</span><span class=p>:</span> <span class=n>OrmAsync</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>AppOrm</span><span class=o>.</span><span class=n>aget_orm</span><span class=p>),</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>pydantic_model</span><span class=p>:</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_update</span><span class=p>(</span><span class=n>item_id</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>aorm</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>update_item</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratordb>fastapi_accelerator.db</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.db></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.BaseDatabaseManager class="doc doc-heading"> <code>BaseDatabaseManager</code> </h3> <div class="doc doc-contents "> <p>Базовый класс для работы с РСУБД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseDatabaseManager</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>SingletonMeta</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Базовый класс для работы с РСУБД&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>database_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=o>*</span><span class=p>,</span>
        <span class=n>pool_size</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
        <span class=n>max_overflow</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
        <span class=n>echo</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=n>DEV_STATUS</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>database_url</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>engine</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>Base</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>adatabase_url</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>aengine</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>asession</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_aBase</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>DEV_STATUS</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=nf>get_session</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>pass</span>

    <span class=k>def</span> <span class=nf>get_session_transaction</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>pass</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>aget_session</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>AsyncSession</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>pass</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>aget_session_transaction</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>AsyncSession</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>pass</span>

    <span class=k>def</span> <span class=nf>check_dev</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверять включенный режим разработки&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>DEV_STATUS</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Такое действие можно выполнять только в DEV режиме.&quot;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>create_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>

    <span class=k>def</span> <span class=nf>drop_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>acreate_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>adrop_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.BaseDatabaseManager.check_dev class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_dev</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>Проверять включенный режим разработки</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>check_dev</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Проверять включенный режим разработки&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>DEV_STATUS</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Такое действие можно выполнять только в DEV режиме.&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.BaseOrm class="doc doc-heading"> <code>BaseOrm</code> </h3> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseOrm</span><span class=p>:</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>asession</span><span class=p>:</span> <span class=n>AsyncSession</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>asession</span> <span class=o>=</span> <span class=n>asession</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>_execute</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Select</span><span class=p>,</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Выполнить Select запрос&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>response</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>db_model</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;Not set db_model&quot;</span><span class=p>)</span>
            <span class=n>relationships</span> <span class=o>=</span> <span class=n>class_mapper</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>relationships</span>
            <span class=n>options</span> <span class=o>=</span> <span class=p>[</span><span class=n>joinedload</span><span class=p>(</span><span class=nb>getattr</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>rel</span><span class=o>.</span><span class=n>key</span><span class=p>))</span> <span class=k>for</span> <span class=n>rel</span> <span class=ow>in</span> <span class=n>relationships</span><span class=p>]</span>
            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=o>*</span><span class=n>options</span><span class=p>))</span>
            <span class=k>return</span> <span class=n>response</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>get</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>query</span><span class=p>:</span> <span class=n>Select</span><span class=p>,</span>
        <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Получить объект по запросу&quot;&quot;&quot;</span>
        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_execute</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>deep</span><span class=p>,</span> <span class=n>db_model</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>scalar_one_or_none</span><span class=p>()</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_list</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>query</span><span class=p>:</span> <span class=n>Select</span><span class=p>,</span>
        <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Получить список объектов по запросу&quot;&quot;&quot;</span>
        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_execute</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>deep</span><span class=p>,</span> <span class=n>db_model</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>scalars</span><span class=p>()</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Update</span><span class=p>,</span> <span class=n>update_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Обновить объекты по запросу&quot;&quot;&quot;</span>
        <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>values</span><span class=p>(</span><span class=o>**</span><span class=n>update_data</span><span class=p>)</span><span class=o>.</span><span class=n>returning</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>table</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>scalars</span><span class=p>()</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Delete</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Удалить объекты по запросу&quot;&quot;&quot;</span>
        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>rowcount</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.BaseOrm.delete class="doc doc-heading"> <code class="highlight language-python"><span class=n>delete</span><span class=p>(</span><span class=n>query</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Удалить объекты по запросу</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Delete</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Удалить объекты по запросу&quot;&quot;&quot;</span>
    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>rowcount</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.BaseOrm.get class="doc doc-heading"> <code class="highlight language-python"><span class=n>get</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>db_model</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Получить объект по запросу</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>get</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>query</span><span class=p>:</span> <span class=n>Select</span><span class=p>,</span>
    <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получить объект по запросу&quot;&quot;&quot;</span>
    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_execute</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>deep</span><span class=p>,</span> <span class=n>db_model</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>scalar_one_or_none</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.BaseOrm.get_list class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_list</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>db_model</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Получить список объектов по запросу</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span>
<span class=normal>97</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>get_list</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>query</span><span class=p>:</span> <span class=n>Select</span><span class=p>,</span>
    <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получить список объектов по запросу&quot;&quot;&quot;</span>
    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_execute</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>deep</span><span class=p>,</span> <span class=n>db_model</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>scalars</span><span class=p>()</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.BaseOrm.update class="doc doc-heading"> <code class="highlight language-python"><span class=n>update</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>update_data</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Обновить объекты по запросу</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>Update</span><span class=p>,</span> <span class=n>update_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Обновить объекты по запросу&quot;&quot;&quot;</span>
    <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>values</span><span class=p>(</span><span class=o>**</span><span class=n>update_data</span><span class=p>)</span><span class=o>.</span><span class=n>returning</span><span class=p>(</span><span class=n>query</span><span class=o>.</span><span class=n>table</span><span class=p>)</span>
    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>scalars</span><span class=p>()</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.DatabaseAsyncSessionMixin class="doc doc-heading"> <code>DatabaseAsyncSessionMixin</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.db.dbsession.BaseDatabaseManager" href="#fastapi_accelerator.db.BaseDatabaseManager">BaseDatabaseManager</a></code></p> <p>Класс для асинхронной работы с РСУБД используя пул соединений</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>DatabaseAsyncSessionMixin</span><span class=p>(</span><span class=n>BaseDatabaseManager</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Класс для асинхронной работы с РСУБД используя пул соединений&quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>aget_session</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>AsyncSession</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных</span>

<span class=sd>        Получить сессию:</span>

<span class=sd>        async for asession in aget_orm():</span>
<span class=sd>            yield asession</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>async</span> <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>asession</span><span class=p>()</span> <span class=k>as</span> <span class=n>asession</span><span class=p>:</span>
            <span class=k>yield</span> <span class=n>asession</span>

    <span class=nd>@classmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>aget_orm</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>OrmAsync</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных с транзакцией</span>

<span class=sd>        Получить сессию:</span>

<span class=sd>        async for orm in aget_orm():</span>
<span class=sd>            yield orm</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>async</span> <span class=k>for</span> <span class=n>asession</span> <span class=ow>in</span> <span class=bp>cls</span><span class=o>.</span><span class=n>aget_session</span><span class=p>():</span>
            <span class=k>yield</span> <span class=n>OrmAsync</span><span class=p>(</span><span class=n>asession</span><span class=p>)</span>

    <span class=nd>@classmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>aget_session_transaction</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>AsyncSession</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессию в транзакции</span>

<span class=sd>        Получить сессию:</span>

<span class=sd>        async for asession in aget_session_transaction():</span>
<span class=sd>            yield asession</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>async</span> <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>asession</span><span class=p>()</span> <span class=k>as</span> <span class=n>asession</span><span class=p>:</span>
            <span class=k>async</span> <span class=k>with</span> <span class=n>asession</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
                <span class=k>yield</span> <span class=n>asession</span>

    <span class=nd>@classmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>acreate_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
        <span class=k>async</span> <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>aengine</span><span class=o>.</span><span class=n>begin</span><span class=p>()</span> <span class=k>as</span> <span class=n>aconn</span><span class=p>:</span>
            <span class=c1># await conn.run_sync(Base.metadata.drop_all)</span>
            <span class=k>await</span> <span class=n>aconn</span><span class=o>.</span><span class=n>run_sync</span><span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>_aBase</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>)</span>

    <span class=nd>@classmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>dispose</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Метод dispose() закрывает все неиспользуемые соединения</span>
<span class=sd>        в пуле соединений, связанном с данным engine.</span>
<span class=sd>        Это позволяет освободить ресурсы базы данных, когда они больше не нужны</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>aengine</span><span class=o>.</span><span class=n>dispose</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_orm class="doc doc-heading"> <code class="highlight language-python"><span class=n>aget_orm</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Зависимость для получения сессии базы данных с транзакцией</p> <p>Получить сессию:</p> <p>async for orm in aget_orm(): yield orm</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>aget_orm</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>OrmAsync</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных с транзакцией</span>

<span class=sd>    Получить сессию:</span>

<span class=sd>    async for orm in aget_orm():</span>
<span class=sd>        yield orm</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>async</span> <span class=k>for</span> <span class=n>asession</span> <span class=ow>in</span> <span class=bp>cls</span><span class=o>.</span><span class=n>aget_session</span><span class=p>():</span>
        <span class=k>yield</span> <span class=n>OrmAsync</span><span class=p>(</span><span class=n>asession</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_session class="doc doc-heading"> <code class="highlight language-python"><span class=n>aget_session</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Зависимость для получения сессии базы данных</p> <p>Получить сессию:</p> <p>async for asession in aget_orm(): yield asession</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>aget_session</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>AsyncSession</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных</span>

<span class=sd>    Получить сессию:</span>

<span class=sd>    async for asession in aget_orm():</span>
<span class=sd>        yield asession</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>async</span> <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>asession</span><span class=p>()</span> <span class=k>as</span> <span class=n>asession</span><span class=p>:</span>
        <span class=k>yield</span> <span class=n>asession</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseAsyncSessionMixin.aget_session_transaction class="doc doc-heading"> <code class="highlight language-python"><span class=n>aget_session_transaction</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Зависимость для получения сессию в транзакции</p> <p>Получить сессию:</p> <p>async for asession in aget_session_transaction(): yield asession</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>aget_session_transaction</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncGenerator</span><span class=p>[</span><span class=n>AsyncSession</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессию в транзакции</span>

<span class=sd>    Получить сессию:</span>

<span class=sd>    async for asession in aget_session_transaction():</span>
<span class=sd>        yield asession</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>async</span> <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>asession</span><span class=p>()</span> <span class=k>as</span> <span class=n>asession</span><span class=p>:</span>
        <span class=k>async</span> <span class=k>with</span> <span class=n>asession</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
            <span class=k>yield</span> <span class=n>asession</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseAsyncSessionMixin.dispose class="doc doc-heading"> <code class="highlight language-python"><span class=n>dispose</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Метод dispose() закрывает все неиспользуемые соединения в пуле соединений, связанном с данным engine. Это позволяет освободить ресурсы базы данных, когда они больше не нужны</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>dispose</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Метод dispose() закрывает все неиспользуемые соединения</span>
<span class=sd>    в пуле соединений, связанном с данным engine.</span>
<span class=sd>    Это позволяет освободить ресурсы базы данных, когда они больше не нужны</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>aengine</span><span class=o>.</span><span class=n>dispose</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.DatabaseSyncSessionMixin class="doc doc-heading"> <code>DatabaseSyncSessionMixin</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.db.dbsession.BaseDatabaseManager" href="#fastapi_accelerator.db.BaseDatabaseManager">BaseDatabaseManager</a></code></p> <p>Класс для синхронной работы с РСУБД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>DatabaseSyncSessionMixin</span><span class=p>(</span><span class=n>BaseDatabaseManager</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Класс для синхронной работы с РСУБД&quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>get_session</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных&quot;&quot;&quot;</span>
        <span class=n>session</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>yield</span> <span class=n>session</span>
        <span class=k>finally</span><span class=p>:</span>
            <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>get_session_transaction</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных с транзакцией&quot;&quot;&quot;</span>
        <span class=n>session</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
                <span class=k>yield</span> <span class=n>session</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
            <span class=k>raise</span>
        <span class=k>finally</span><span class=p>:</span>
            <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>get_metadata</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>MetaData</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Получаем обновленные метаданные&quot;&quot;&quot;</span>
        <span class=n>metadata</span> <span class=o>=</span> <span class=n>MetaData</span><span class=p>()</span>
        <span class=n>metadata</span><span class=o>.</span><span class=n>reflect</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>metadata</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>create_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Создать все таблицы в БД&quot;&quot;&quot;</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>Base</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>drop_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Удалить все таблицы из БД&quot;&quot;&quot;</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>get_metadata</span><span class=p>()</span><span class=o>.</span><span class=n>drop_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>clear_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>exclude_tables_name</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Отчистить данные во всех таблицах</span>

<span class=sd>        exclude_tables_name: Список имён таблиц которые не нужно отчищать</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
        <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>session</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
            <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
                <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>get_metadata</span><span class=p>()</span><span class=o>.</span><span class=n>sorted_tables</span><span class=p>):</span>
                    <span class=k>if</span> <span class=n>table</span><span class=o>.</span><span class=n>name</span> <span class=ow>in</span> <span class=n>exclude_tables_name</span><span class=p>:</span>
                        <span class=k>continue</span>
                    <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>delete</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseSyncSessionMixin.clear_all class="doc doc-heading"> <code class="highlight language-python"><span class=n>clear_all</span><span class=p>(</span><span class=n>exclude_tables_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Отчистить данные во всех таблицах</p> <p>exclude_tables_name: Список имён таблиц которые не нужно отчищать</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>clear_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>exclude_tables_name</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Отчистить данные во всех таблицах</span>

<span class=sd>    exclude_tables_name: Список имён таблиц которые не нужно отчищать</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
    <span class=k>with</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>session</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
        <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
            <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>get_metadata</span><span class=p>()</span><span class=o>.</span><span class=n>sorted_tables</span><span class=p>):</span>
                <span class=k>if</span> <span class=n>table</span><span class=o>.</span><span class=n>name</span> <span class=ow>in</span> <span class=n>exclude_tables_name</span><span class=p>:</span>
                    <span class=k>continue</span>
                <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>delete</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseSyncSessionMixin.create_all class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_all</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Создать все таблицы в БД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>create_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Создать все таблицы в БД&quot;&quot;&quot;</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>Base</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseSyncSessionMixin.drop_all class="doc doc-heading"> <code class="highlight language-python"><span class=n>drop_all</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Удалить все таблицы из БД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>drop_all</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Удалить все таблицы из БД&quot;&quot;&quot;</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>check_dev</span><span class=p>()</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>get_metadata</span><span class=p>()</span><span class=o>.</span><span class=n>drop_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseSyncSessionMixin.get_metadata class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_metadata</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Получаем обновленные метаданные</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span>
<span class=normal>97</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>get_metadata</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>MetaData</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получаем обновленные метаданные&quot;&quot;&quot;</span>
    <span class=n>metadata</span> <span class=o>=</span> <span class=n>MetaData</span><span class=p>()</span>
    <span class=n>metadata</span><span class=o>.</span><span class=n>reflect</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>metadata</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseSyncSessionMixin.get_session class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_session</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Зависимость для получения сессии базы данных</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>get_session</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных&quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>yield</span> <span class=n>session</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.DatabaseSyncSessionMixin.get_session_transaction class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_session_transaction</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Зависимость для получения сессии базы данных с транзакцией</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dbsession.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>get_session_transaction</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Зависимость для получения сессии базы данных с транзакцией&quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
            <span class=k>yield</span> <span class=n>session</span>
    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
        <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
        <span class=k>raise</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.OrmAsync class="doc doc-heading"> <code>OrmAsync</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.db.dborm.OrmAsyncItem" href="#fastapi_accelerator.db.OrmAsyncItem">OrmAsyncItem</a></code></p> <p>Взаимодействие с БД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>OrmAsync</span><span class=p>(</span><span class=n>OrmAsyncItem</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Взаимодействие с БД&quot;&quot;&quot;</span>

    <span class=o>...</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.OrmAsyncItem class="doc doc-heading"> <code>OrmAsyncItem</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.db.dborm.BaseOrm" href="#fastapi_accelerator.db.BaseOrm">BaseOrm</a></code></p> <p>Логика для работы с одним элементом</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>OrmAsyncItem</span><span class=p>(</span><span class=n>BaseOrm</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Логика для работы с одним элементом&quot;&quot;&quot;</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_item</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span><span class=p>],</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Получить объект по PK&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
            <span class=c1># Получить имя первичного ключа</span>
            <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>select</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_pk</span> <span class=o>==</span> <span class=n>item_id</span><span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Получить вложенный объект&quot;&quot;&quot;</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                <span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
            <span class=p>)</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Создать объект&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>obj</span>
        <span class=k>else</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Создать вложенный объект&quot;&quot;&quot;</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>eager_refresh</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span>
        <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span><span class=p>],</span>
        <span class=n>update_item</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
        <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Обновить объект по PK&quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
            <span class=c1># Получить имя первичного ключа</span>
            <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
                <span class=n>update</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_pk</span> <span class=o>==</span> <span class=n>item_id</span><span class=p>),</span> <span class=n>update_item</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Обновить вложенный объект&quot;&quot;&quot;</span>

            <span class=k>async</span> <span class=k>def</span> <span class=nf>update_nested</span><span class=p>(</span><span class=n>obj</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span> <span class=n>update_item</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>                </span><span class=sd>&quot;&quot;&quot;Функция рекурсивного обновления&quot;&quot;&quot;</span>
                <span class=n>db_model</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=vm>__class__</span>
                <span class=n>mapper</span> <span class=o>=</span> <span class=n>class_mapper</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
                <span class=c1># Связи объекта с другими таблицами</span>
                <span class=n>relationships_keys</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=n>r</span><span class=o>.</span><span class=n>local_remote_pairs</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>key</span><span class=p>:</span> <span class=n>r</span><span class=o>.</span><span class=n>key</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>mapper</span><span class=o>.</span><span class=n>relationships</span>
                <span class=p>}</span>
                <span class=c1># Получить имя первичного ключа</span>
                <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
                <span class=c1># Исключаем колонки с первичными ключами</span>
                <span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>key</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>mapper</span><span class=o>.</span><span class=n>column_attrs</span> <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>key</span> <span class=o>!=</span> <span class=n>name_pk</span><span class=o>.</span><span class=n>name</span><span class=p>]</span>
                <span class=k>for</span> <span class=n>column_name</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>:</span>
                    <span class=c1># Взять значение входного</span>
                    <span class=n>update_value</span> <span class=o>=</span> <span class=n>update_item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>column_name</span><span class=p>)</span>
                    <span class=c1># Если это связь с другой таблицей</span>
                    <span class=k>if</span> <span class=n>overwrite_column_name</span> <span class=o>:=</span> <span class=n>relationships_keys</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>column_name</span><span class=p>):</span>
                        <span class=n>related_obj</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>overwrite_column_name</span><span class=p>)</span>
                        <span class=n>nested_obj</span> <span class=o>=</span> <span class=k>await</span> <span class=n>update_nested</span><span class=p>(</span>
                            <span class=n>related_obj</span><span class=p>,</span> <span class=n>update_item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>overwrite_column_name</span><span class=p>)</span>
                        <span class=p>)</span>
                        <span class=n>update_value</span> <span class=o>=</span> <span class=n>nested_obj</span>
                        <span class=n>column_name</span> <span class=o>=</span> <span class=n>overwrite_column_name</span>

                    <span class=nb>setattr</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>column_name</span><span class=p>,</span> <span class=n>update_value</span><span class=p>)</span>
                <span class=k>return</span> <span class=n>obj</span>

            <span class=c1># Получить объект</span>
            <span class=n>obj</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                <span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>obj</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>NoResultFound</span><span class=p>()</span>  <span class=c1># Если объект не найден, возвращаем ошибку</span>

            <span class=c1># Обновить объект</span>
            <span class=n>update_obj</span> <span class=o>=</span> <span class=k>await</span> <span class=n>update_nested</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>update_item</span><span class=p>)</span>
            <span class=c1># Применить обновление в БД</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>update_obj</span><span class=p>)</span>
            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
            <span class=k>return</span> <span class=n>update_obj</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>delete_item</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span><span class=p>],</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Удалить объект по PK&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
            <span class=c1># Получить имя первичного ключа</span>
            <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>delete</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_pk</span> <span class=o>==</span> <span class=n>item_id</span><span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Удалить вложенный объект и его зависимости.&quot;&quot;&quot;</span>

            <span class=c1># Получаем объект с его зависимостями через selectinload</span>
            <span class=n>obj</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                <span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>obj</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>False</span>  <span class=c1># Если объект не найден, возвращаем False</span>

            <span class=k>async</span> <span class=k>def</span> <span class=nf>delete_nested</span><span class=p>(</span>
                <span class=n>tmp_obj</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span>
                <span class=n>pre_model</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
            <span class=p>):</span>
<span class=w>                </span><span class=sd>&quot;&quot;&quot;Рекурсивное удаление всех зависимостей объекта.&quot;&quot;&quot;</span>
                <span class=n>mapper</span> <span class=o>=</span> <span class=n>class_mapper</span><span class=p>(</span><span class=n>tmp_obj</span><span class=o>.</span><span class=vm>__class__</span><span class=p>)</span>

                <span class=c1># Находим все связи объекта с другими таблицами</span>
                <span class=k>for</span> <span class=n>relationship</span> <span class=ow>in</span> <span class=n>mapper</span><span class=o>.</span><span class=n>relationships</span><span class=p>:</span>
                    <span class=c1># Не пытаемся удалить запись из предыдущей итерации стека</span>
                    <span class=k>if</span> <span class=p>(</span>
                        <span class=n>pre_model</span>
                        <span class=ow>and</span> <span class=n>relationship</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>pre_model</span><span class=o>.</span><span class=n>__table__</span><span class=o>.</span><span class=n>name</span>
                    <span class=p>):</span>
                        <span class=k>continue</span>
                    <span class=n>related_objs</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>tmp_obj</span><span class=p>,</span> <span class=n>relationship</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
                    <span class=k>if</span> <span class=n>related_objs</span><span class=p>:</span>
                        <span class=k>if</span> <span class=n>relationship</span><span class=o>.</span><span class=n>uselist</span><span class=p>:</span>
                            <span class=c1># Если это список объектов, удаляем их рекурсивно</span>
                            <span class=k>for</span> <span class=n>related_obj</span> <span class=ow>in</span> <span class=n>related_objs</span><span class=p>:</span>
                                <span class=k>await</span> <span class=n>delete_nested</span><span class=p>(</span>
                                    <span class=n>related_obj</span><span class=p>,</span> <span class=n>pre_model</span><span class=o>=</span><span class=n>tmp_obj</span><span class=o>.</span><span class=vm>__class__</span>
                                <span class=p>)</span>
                        <span class=k>else</span><span class=p>:</span>
                            <span class=c1># Если это один объект, удаляем его рекурсивно</span>
                            <span class=k>await</span> <span class=n>delete_nested</span><span class=p>(</span>
                                <span class=n>related_objs</span><span class=p>,</span> <span class=n>pre_model</span><span class=o>=</span><span class=n>tmp_obj</span><span class=o>.</span><span class=vm>__class__</span>
                            <span class=p>)</span>

                <span class=c1># Удаляем сам объект</span>
                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>tmp_obj</span><span class=p>)</span>

            <span class=c1># Начинаем рекурсивное удаление с корневого объекта</span>
            <span class=k>await</span> <span class=n>delete_nested</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
            <span class=c1># Коммит транзакции</span>
            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
            <span class=k>return</span> <span class=kc>True</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>eager_refresh</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Жадно загрузить все связанные записи для данного объекта.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=p>),</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>obj</span><span class=p>),</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.OrmAsyncItem.create_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_item</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Создать объект</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>create_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Создать объект&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>obj</span>
    <span class=k>else</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Создать вложенный объект&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>eager_refresh</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.OrmAsyncItem.delete_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>delete_item</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Удалить объект по PK</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>delete_item</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span><span class=p>],</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Удалить объект по PK&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
        <span class=c1># Получить имя первичного ключа</span>
        <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>delete</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_pk</span> <span class=o>==</span> <span class=n>item_id</span><span class=p>))</span>
    <span class=k>else</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Удалить вложенный объект и его зависимости.&quot;&quot;&quot;</span>

        <span class=c1># Получаем объект с его зависимостями через selectinload</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>obj</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>  <span class=c1># Если объект не найден, возвращаем False</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>delete_nested</span><span class=p>(</span>
            <span class=n>tmp_obj</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span>
            <span class=n>pre_model</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=p>):</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Рекурсивное удаление всех зависимостей объекта.&quot;&quot;&quot;</span>
            <span class=n>mapper</span> <span class=o>=</span> <span class=n>class_mapper</span><span class=p>(</span><span class=n>tmp_obj</span><span class=o>.</span><span class=vm>__class__</span><span class=p>)</span>

            <span class=c1># Находим все связи объекта с другими таблицами</span>
            <span class=k>for</span> <span class=n>relationship</span> <span class=ow>in</span> <span class=n>mapper</span><span class=o>.</span><span class=n>relationships</span><span class=p>:</span>
                <span class=c1># Не пытаемся удалить запись из предыдущей итерации стека</span>
                <span class=k>if</span> <span class=p>(</span>
                    <span class=n>pre_model</span>
                    <span class=ow>and</span> <span class=n>relationship</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>pre_model</span><span class=o>.</span><span class=n>__table__</span><span class=o>.</span><span class=n>name</span>
                <span class=p>):</span>
                    <span class=k>continue</span>
                <span class=n>related_objs</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>tmp_obj</span><span class=p>,</span> <span class=n>relationship</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>related_objs</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>relationship</span><span class=o>.</span><span class=n>uselist</span><span class=p>:</span>
                        <span class=c1># Если это список объектов, удаляем их рекурсивно</span>
                        <span class=k>for</span> <span class=n>related_obj</span> <span class=ow>in</span> <span class=n>related_objs</span><span class=p>:</span>
                            <span class=k>await</span> <span class=n>delete_nested</span><span class=p>(</span>
                                <span class=n>related_obj</span><span class=p>,</span> <span class=n>pre_model</span><span class=o>=</span><span class=n>tmp_obj</span><span class=o>.</span><span class=vm>__class__</span>
                            <span class=p>)</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=c1># Если это один объект, удаляем его рекурсивно</span>
                        <span class=k>await</span> <span class=n>delete_nested</span><span class=p>(</span>
                            <span class=n>related_objs</span><span class=p>,</span> <span class=n>pre_model</span><span class=o>=</span><span class=n>tmp_obj</span><span class=o>.</span><span class=vm>__class__</span>
                        <span class=p>)</span>

            <span class=c1># Удаляем сам объект</span>
            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>tmp_obj</span><span class=p>)</span>

        <span class=c1># Начинаем рекурсивное удаление с корневого объекта</span>
        <span class=k>await</span> <span class=n>delete_nested</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
        <span class=c1># Коммит транзакции</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=k>return</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.OrmAsyncItem.eager_refresh class="doc doc-heading"> <code class="highlight language-python"><span class=n>eager_refresh</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Жадно загрузить все связанные записи для данного объекта.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>eager_refresh</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Жадно загрузить все связанные записи для данного объекта.&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=p>),</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>obj</span><span class=p>),</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.OrmAsyncItem.get_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_item</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Получить объект по PK</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>get_item</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span> <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span><span class=p>],</span> <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>T</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получить объект по PK&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
        <span class=c1># Получить имя первичного ключа</span>
        <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>select</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_pk</span> <span class=o>==</span> <span class=n>item_id</span><span class=p>))</span>
    <span class=k>else</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Получить вложенный объект&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.db.OrmAsyncItem.update_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>update_item</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>update_item</span><span class=p>,</span> <span class=n>deep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Обновить объект по PK</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>update_item</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span>
    <span class=n>item_id</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span><span class=p>],</span>
    <span class=n>update_item</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
    <span class=n>deep</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Обновить объект по PK&quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>deep</span><span class=p>:</span>
        <span class=c1># Получить имя первичного ключа</span>
        <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
            <span class=n>update</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name_pk</span> <span class=o>==</span> <span class=n>item_id</span><span class=p>),</span> <span class=n>update_item</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Обновить вложенный объект&quot;&quot;&quot;</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>update_nested</span><span class=p>(</span><span class=n>obj</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span> <span class=n>update_item</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Функция рекурсивного обновления&quot;&quot;&quot;</span>
            <span class=n>db_model</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=vm>__class__</span>
            <span class=n>mapper</span> <span class=o>=</span> <span class=n>class_mapper</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
            <span class=c1># Связи объекта с другими таблицами</span>
            <span class=n>relationships_keys</span> <span class=o>=</span> <span class=p>{</span>
                <span class=n>r</span><span class=o>.</span><span class=n>local_remote_pairs</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>key</span><span class=p>:</span> <span class=n>r</span><span class=o>.</span><span class=n>key</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>mapper</span><span class=o>.</span><span class=n>relationships</span>
            <span class=p>}</span>
            <span class=c1># Получить имя первичного ключа</span>
            <span class=n>name_pk</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span>
            <span class=c1># Исключаем колонки с первичными ключами</span>
            <span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>key</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>mapper</span><span class=o>.</span><span class=n>column_attrs</span> <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>key</span> <span class=o>!=</span> <span class=n>name_pk</span><span class=o>.</span><span class=n>name</span><span class=p>]</span>
            <span class=k>for</span> <span class=n>column_name</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>:</span>
                <span class=c1># Взять значение входного</span>
                <span class=n>update_value</span> <span class=o>=</span> <span class=n>update_item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>column_name</span><span class=p>)</span>
                <span class=c1># Если это связь с другой таблицей</span>
                <span class=k>if</span> <span class=n>overwrite_column_name</span> <span class=o>:=</span> <span class=n>relationships_keys</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>column_name</span><span class=p>):</span>
                    <span class=n>related_obj</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>overwrite_column_name</span><span class=p>)</span>
                    <span class=n>nested_obj</span> <span class=o>=</span> <span class=k>await</span> <span class=n>update_nested</span><span class=p>(</span>
                        <span class=n>related_obj</span><span class=p>,</span> <span class=n>update_item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>overwrite_column_name</span><span class=p>)</span>
                    <span class=p>)</span>
                    <span class=n>update_value</span> <span class=o>=</span> <span class=n>nested_obj</span>
                    <span class=n>column_name</span> <span class=o>=</span> <span class=n>overwrite_column_name</span>

                <span class=nb>setattr</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>column_name</span><span class=p>,</span> <span class=n>update_value</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>obj</span>

        <span class=c1># Получить объект</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=n>db_model</span><span class=p>,</span> <span class=n>item_id</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=p>[</span><span class=n>selectinload</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>)]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>obj</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>NoResultFound</span><span class=p>()</span>  <span class=c1># Если объект не найден, возвращаем ошибку</span>

        <span class=c1># Обновить объект</span>
        <span class=n>update_obj</span> <span class=o>=</span> <span class=k>await</span> <span class=n>update_nested</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>update_item</span><span class=p>)</span>
        <span class=c1># Применить обновление в БД</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>update_obj</span><span class=p>)</span>
        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>asession</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>update_obj</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.db.SingletonMeta class="doc doc-heading"> <code>SingletonMeta</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>type</code></p> <p>Мета класс для реализации паттерна Одиночка</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SingletonMeta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Мета класс для реализации паттерна Одиночка&quot;&quot;&quot;</span>

    <span class=n>instance</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>SingletonMeta</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__call__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.db.deep_instance class="doc doc-heading"> <code class="highlight language-python"><span class=n>deep_instance</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>pydantic_data</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Создает экземпляр SQLAlchemy модели из словаря. Если словарь содержит вложенные данные для связанных объектов, они также будут созданы.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>deep_instance</span><span class=p>(</span><span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>],</span> <span class=n>pydantic_data</span><span class=p>:</span> <span class=n>BaseModel</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Создает экземпляр SQLAlchemy модели из словаря.</span>
<span class=sd>    Если словарь содержит вложенные данные для связанных объектов, они также будут созданы.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>field</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>pydantic_data</span><span class=p>:</span>
        <span class=c1># Если значение также является словарем, создаем вложенный объект</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>BaseModel</span><span class=p>):</span>
            <span class=c1># Получаем тип модели для связанного объекта</span>
            <span class=n>related_model</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>field</span><span class=p>)</span><span class=o>.</span><span class=n>property</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>class_</span>
            <span class=n>value</span> <span class=o>=</span> <span class=n>deep_instance</span><span class=p>(</span><span class=n>related_model</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
        <span class=n>kwargs</span><span class=p>[</span><span class=n>field</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
    <span class=k>return</span> <span class=n>db_model</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.db.get_pk class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Получить первичный ключ у модели</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/db/dborm.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_pk</span><span class=p>(</span><span class=n>db_model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>T</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получить первичный ключ у модели&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>db_model</span><span class=p>,</span> <span class=n>db_model</span><span class=o>.</span><span class=n>__table__</span><span class=o>.</span><span class=n>primary_key</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>values</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratorintegration>fastapi_accelerator.integration</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.integration></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.ApiHTTP class="doc doc-heading"> <code>ApiHTTP</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p> <p>Stores API connection details and client.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ApiHTTP</span><span class=p>(</span><span class=n>NamedTuple</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Stores API connection details and client.&quot;&quot;&quot;</span>

    <span class=n>credentials</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=kc>None</span>  <span class=c1># Authentication credentials</span>
    <span class=n>url</span><span class=p>:</span> <span class=n>ParseResult</span>  <span class=c1># Parsed URL of the API endpoint</span>
    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># API version</span>
    <span class=n>httpmethod</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># Use HTTP method</span>
    <span class=n>client</span><span class=p>:</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span> <span class=o>|</span> <span class=kc>None</span>  <span class=c1># HTTP client for making requests (None in tests)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.BaseIntegration class="doc doc-heading"> <code>BaseIntegration</code> </h3> <div class="doc doc-contents "> <p>Базовый класс для интеграций</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/base_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseIntegration</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Базовый класс для интеграций&quot;&quot;&quot;</span>

    <span class=o>...</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.BaseStabilityPattern class="doc doc-heading"> <code>BaseStabilityPattern</code> </h3> <div class="doc doc-contents "> <p>Базовый класс для реализации паттерна стабильности</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseStabilityPattern</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Базовый класс для реализации паттерна стабильности&quot;&quot;&quot;</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span> <span class=o>...</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]:</span>
        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>R</span><span class=p>:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>))</span>

        <span class=k>return</span> <span class=n>wrapper</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.CircuitBreakerError class="doc doc-heading"> <code>CircuitBreakerError</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.StabilityError" href="#fastapi_accelerator.integration.StabilityError">StabilityError</a></code></p> <p>Ошибка, возникающая при срабатывании предохранителя.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>CircuitBreakerError</span><span class=p>(</span><span class=n>StabilityError</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Ошибка, возникающая при срабатывании предохранителя.&quot;&quot;&quot;</span>

    <span class=c1># Этот статус сигнализирует, что сервер временно не может обработать запрос</span>
    <span class=c1># из-за перегрузки или проведения технических работ.</span>
    <span class=n>http_status</span> <span class=o>=</span> <span class=mi>503</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Circuit Breaker в состоянии OPEN.&quot;</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.EndpointsDeclaration class="doc doc-heading"> <code>EndpointsDeclaration</code> </h3> <div class="doc doc-contents "> <p>Базовый класс для объявления интеграций с внешними API.</p> <p>Этот класс предоставляет платформу для определения и управления интеграциями API, включая обработку аутентификации и настройку базового URL.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>EndpointsDeclaration</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Базовый класс для объявления интеграций с внешними API.</span>

<span class=sd>    Этот класс предоставляет платформу для определения и управления интеграциями API,</span>
<span class=sd>    включая обработку аутентификации и настройку базового URL.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>integration</span><span class=p>:</span> <span class=n>IntegrationHTTP</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_url</span><span class=p>:</span> <span class=n>URL</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>credentials</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Аргументы:</span>
<span class=sd>            base_url (URL): Базовый URL для API. Это может быть доменное имя или адрес в формате host:port.</span>
<span class=sd>            credentials (dict | None): Доступные учетные данные для аутентификации в внешней системе.</span>

<span class=sd>        Примечание:</span>
<span class=sd>            Рекомендуется задавать base_url через переменные окружения, чтобы избежать проблем с конфигурацией</span>
<span class=sd>            на разных уровнях (например, на production-среде) из-за межсетевых экранов или других факторов.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>base_url</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>credentials</span> <span class=o>=</span> <span class=n>credentials</span>

    <span class=k>class</span> <span class=nc>Schema</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для успешных ответов.</span>

<span class=sd>        Эта схема описывает структуру данных, которые ожидаются в успешных ответах от REST API.</span>
<span class=sd>        &quot;&quot;&quot;</span>

    <span class=k>class</span> <span class=nc>SchemaError</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для неуспешных ответов.</span>

<span class=sd>        Эта схема описывает структуру данных, которые могут быть возвращены</span>
<span class=sd>        в случае ошибки при взаимодействии с REST API.</span>
<span class=sd>        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.EndpointsDeclaration.Schema class="doc doc-heading"> <code>Schema</code> </h4> <div class="doc doc-contents "> <p>Схема Pydantic для успешных ответов.</p> <p>Эта схема описывает структуру данных, которые ожидаются в успешных ответах от REST API.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>Schema</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для успешных ответов.</span>

<span class=sd>    Эта схема описывает структуру данных, которые ожидаются в успешных ответах от REST API.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.EndpointsDeclaration.SchemaError class="doc doc-heading"> <code>SchemaError</code> </h4> <div class="doc doc-contents "> <p>Схема Pydantic для неуспешных ответов.</p> <p>Эта схема описывает структуру данных, которые могут быть возвращены в случае ошибки при взаимодействии с REST API.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SchemaError</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для неуспешных ответов.</span>

<span class=sd>    Эта схема описывает структуру данных, которые могут быть возвращены</span>
<span class=sd>    в случае ошибки при взаимодействии с REST API.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.integration.EndpointsDeclaration.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>credentials</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <details class=аргументы open> <summary>Аргументы</summary> <p>base_url (URL): Базовый URL для API. Это может быть доменное имя или адрес в формате host:port. credentials (dict | None): Доступные учетные данные для аутентификации в внешней системе.</p> </details> <details class=примечание open> <summary>Примечание</summary> <p>Рекомендуется задавать base_url через переменные окружения, чтобы избежать проблем с конфигурацией на разных уровнях (например, на production-среде) из-за межсетевых экранов или других факторов.</p> </details> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_url</span><span class=p>:</span> <span class=n>URL</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>credentials</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Аргументы:</span>
<span class=sd>        base_url (URL): Базовый URL для API. Это может быть доменное имя или адрес в формате host:port.</span>
<span class=sd>        credentials (dict | None): Доступные учетные данные для аутентификации в внешней системе.</span>

<span class=sd>    Примечание:</span>
<span class=sd>        Рекомендуется задавать base_url через переменные окружения, чтобы избежать проблем с конфигурацией</span>
<span class=sd>        на разных уровнях (например, на production-среде) из-за межсетевых экранов или других факторов.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>base_url</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>credentials</span> <span class=o>=</span> <span class=n>credentials</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.HTTPMethod class="doc doc-heading"> <code>HTTPMethod</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>str</code>, <code><span title="enum.Enum">Enum</span></code></p> <p>Доступные HTTP методы</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>HTTPMethod</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>Enum</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Доступные HTTP методы&quot;&quot;&quot;</span>

    <span class=n>get</span> <span class=o>=</span> <span class=s2>&quot;GET&quot;</span>
    <span class=n>post</span> <span class=o>=</span> <span class=s2>&quot;POST&quot;</span>
    <span class=n>put</span> <span class=o>=</span> <span class=s2>&quot;PUT&quot;</span>
    <span class=n>patch</span> <span class=o>=</span> <span class=s2>&quot;PATCH&quot;</span>
    <span class=n>delete</span> <span class=o>=</span> <span class=s2>&quot;DELETE&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.IntegrationHTTP class="doc doc-heading"> <code>IntegrationHTTP</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.base_integration.BaseIntegration" href="#fastapi_accelerator.integration.BaseIntegration">BaseIntegration</a></code></p> <p>Класс для интеграции с сервисами REST API.</p> <p>Этот класс используется для регистрации конечных точек в классе <code>EndpointsDeclaration</code> используя декоратор <code>@endpoint</code>. Это обеспечивает структурированный способ определения и интеграция с API.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>IntegrationHTTP</span><span class=p>(</span><span class=n>BaseIntegration</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Класс для интеграции с сервисами REST API.</span>

<span class=sd>    Этот класс используется для регистрации конечных точек в классе `EndpointsDeclaration`</span>
<span class=sd>    используя декоратор `@endpoint`. Это обеспечивает структурированный способ определения</span>
<span class=sd>    и интеграция с API.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>doc</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
        <span class=c1># Документаци интеграции</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_doc</span> <span class=o>=</span> <span class=n>doc</span>
        <span class=c1># Информация о классе</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_class_info</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
            <span class=s2>&quot;docstring&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_doc</span><span class=p>,</span>
            <span class=s2>&quot;methods&quot;</span><span class=p>:</span> <span class=p>[],</span>
        <span class=p>}</span>
        <span class=c1># Человеоко понятное имя</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>

    <span class=k>def</span> <span class=nf>_add_integrations_method</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>version</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>docurl</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>httpmethod</span><span class=p>:</span> <span class=n>HTTPMethod</span><span class=p>,</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Добавьте документацию по методу интеграции.&quot;&quot;&quot;</span>
        <span class=c1># Добавить документацию функции</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_class_info</span><span class=p>[</span><span class=s2>&quot;methods&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
            <span class=p>{</span>
                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
                <span class=s2>&quot;docstring&quot;</span><span class=p>:</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=s2>&quot;__doc__&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
                <span class=s2>&quot;annotations&quot;</span><span class=p>:</span> <span class=p>{</span>
                    <span class=n>k</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=vm>__name__</span> <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=s2>&quot;__name__&quot;</span><span class=p>)</span> <span class=k>else</span> <span class=nb>str</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>func</span><span class=o>.</span><span class=vm>__annotations__</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
                    <span class=c1># Исключаем аргумент api</span>
                    <span class=k>if</span> <span class=n>k</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;api&quot;</span><span class=p>)</span>
                <span class=p>},</span>
                <span class=s2>&quot;path&quot;</span><span class=p>:</span> <span class=n>path</span><span class=p>,</span>
                <span class=s2>&quot;httpmethod&quot;</span><span class=p>:</span> <span class=n>httpmethod</span><span class=p>,</span>
                <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>version</span><span class=p>,</span>
                <span class=s2>&quot;docurl&quot;</span><span class=p>:</span> <span class=n>docurl</span><span class=p>,</span>
            <span class=p>}</span>
        <span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span> <span class=nf>docs</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Получите документацию по этой интеграции.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_class_info</span>

    <span class=k>def</span> <span class=nf>endpoint</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>httpmethod</span><span class=p>:</span> <span class=n>HTTPMethod</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>docurl</span><span class=p>:</span> <span class=nb>str</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Callable</span><span class=p>[[</span><span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]],</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Декоратор для интеграции REST-эндпоинтов с HTTP-запросами.</span>

<span class=sd>        Этот декоратор применяется к методам класса, наследующего от `IntegrationHTTP`,</span>
<span class=sd>        и обеспечивает интеграцию с внешними REST-эндпоинтами через HTTP-запросы.</span>

<span class=sd>        Args:</span>
<span class=sd>            path (str): Путь, на который отправляется запрос.</span>
<span class=sd>            version (str): Версия этого эндпоинта.</span>
<span class=sd>            docurl (str): Ссылка на документацию эндпоинта.</span>
<span class=sd>            httpmethod (HTTPMethod): Какой HTTP метод испольузеится.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Callable[..., Awaitable[R]]: Декорированная функция, готовая для интеграции с REST-эндпоинтом.</span>

<span class=sd>        Примечания:</span>
<span class=sd>            - Метод, к которому применяется декоратор, должен быть определен в классе, наследующем от `IntegrationHTTP`</span>
<span class=sd>            - Для декорируемого метода должен быть указан возвращаемый тип аннотации.</span>
<span class=sd>            - Обязательные аргументы должны быть указаны в декораторе.</span>

<span class=sd>        Raises:</span>
<span class=sd>            ValueError: Если для интеграционной функции не указан тип возвращаемого значения.</span>
<span class=sd>            TypeError: Вызыван метод не у экземпляра класса</span>

<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]:</span>

            <span class=c1># Проверить что у функции указан тип ответа</span>
            <span class=n>return_type</span> <span class=o>=</span> <span class=n>func</span><span class=o>.</span><span class=vm>__annotations__</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;return&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>return_type</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                    <span class=s2>&quot;Return type must be specified for integration function&quot;</span>
                <span class=p>)</span>

            <span class=c1># Добавить метод в хранилище</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_add_integrations_method</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>version</span><span class=p>,</span> <span class=n>docurl</span><span class=p>,</span> <span class=n>httpmethod</span><span class=p>)</span>

            <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
            <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span>
                <span class=n>self_endpoint</span><span class=p>:</span> <span class=n>EndpointsDeclaration</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span>
            <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>R</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>self_endpoint</span><span class=p>,</span> <span class=n>EndpointsDeclaration</span><span class=p>):</span>
                    <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
                        <span class=s2>&quot;Method must be called on an instance, not the class itself&quot;</span>
                    <span class=p>)</span>

                <span class=c1># Полный путь до endpoint</span>
                <span class=n>url</span><span class=p>:</span> <span class=n>ParseResult</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=n>self_endpoint</span><span class=o>.</span><span class=n>base_url</span> <span class=o>+</span> <span class=n>path</span><span class=p>)</span>
                <span class=k>try</span><span class=p>:</span>

                    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>wraper_endpoint</span><span class=p>(</span>
                        <span class=n>self_endpoint</span><span class=p>,</span>
                        <span class=n>func</span><span class=p>,</span>
                        <span class=n>url</span><span class=p>,</span>
                        <span class=n>version</span><span class=p>,</span>
                        <span class=n>httpmethod</span><span class=p>,</span>
                        <span class=o>*</span><span class=n>args</span><span class=p>,</span>
                        <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
                    <span class=p>)</span>
                    <span class=c1># Конвертировать ответ в ожидаемый тип</span>
                    <span class=k>return</span> <span class=n>convert_response</span><span class=p>(</span><span class=n>return_type</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>
                <span class=k>except</span> <span class=n>StabilityError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                    <span class=c1># Если возникло исключение в обработчиках стабльности</span>
                    <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
                        <span class=n>status_code</span><span class=o>=</span><span class=nb>getattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;http_status&quot;</span><span class=p>,</span> <span class=mi>500</span><span class=p>),</span>
                        <span class=n>detail</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                    <span class=p>)</span>

            <span class=k>return</span> <span class=n>wrapper</span>

        <span class=k>return</span> <span class=n>decorator</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h4 id=fastapi_accelerator.integration.IntegrationHTTP.docs class="doc doc-heading"> <code class="highlight language-python"><span class=n>docs</span><span class=p>:</span> <span class=nb>dict</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h4> <div class="doc doc-contents "> <p>Получите документацию по этой интеграции.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.integration.IntegrationHTTP.endpoint class="doc doc-heading"> <code class="highlight language-python"><span class=n>endpoint</span><span class=p>(</span><span class=n>httpmethod</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>version</span><span class=p>,</span> <span class=n>docurl</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <p>Декоратор для интеграции REST-эндпоинтов с HTTP-запросами.</p> <p>Этот декоратор применяется к методам класса, наследующего от <code>IntegrationHTTP</code>, и обеспечивает интеграцию с внешними REST-эндпоинтами через HTTP-запросы.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>path</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Путь, на который отправляется запрос.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>version</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Версия этого эндпоинта.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>docurl</code></td> <td> <code>str</code> </td> <td> <div class=doc-md-description> <p>Ссылка на документацию эндпоинта.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>httpmethod</code></td> <td> <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.http_integration.HTTPMethod" href="#fastapi_accelerator.testutils.HTTPMethod">HTTPMethod</a></code> </td> <td> <div class=doc-md-description> <p>Какой HTTP метод испольузеится.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.Callable">Callable</span>[[<span title="typing.Callable">Callable</span>[..., <span title="typing.Awaitable">Awaitable</span>[<span title="fastapi_accelerator.integration.http_integration.R">R</span>]]], <span title="typing.Callable">Callable</span>[..., <span title="typing.Awaitable">Awaitable</span>[<span title="fastapi_accelerator.integration.http_integration.R">R</span>]]]</code> </td> <td> <div class=doc-md-description> <p>Callable[..., Awaitable[R]]: Декорированная функция, готовая для интеграции с REST-эндпоинтом.</p> </div> </td> </tr> </tbody> </table> <details class=примечания open> <summary>Примечания</summary> <ul> <li>Метод, к которому применяется декоратор, должен быть определен в классе, наследующем от <code>IntegrationHTTP</code></li> <li>Для декорируемого метода должен быть указан возвращаемый тип аннотации.</li> <li>Обязательные аргументы должны быть указаны в декораторе.</li> </ul> </details> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>ValueError</code> </td> <td> <div class=doc-md-description> <p>Если для интеграционной функции не указан тип возвращаемого значения.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code>TypeError</code> </td> <td> <div class=doc-md-description> <p>Вызыван метод не у экземпляра класса</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>endpoint</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>httpmethod</span><span class=p>:</span> <span class=n>HTTPMethod</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>docurl</span><span class=p>:</span> <span class=nb>str</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Callable</span><span class=p>[[</span><span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]],</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Декоратор для интеграции REST-эндпоинтов с HTTP-запросами.</span>

<span class=sd>    Этот декоратор применяется к методам класса, наследующего от `IntegrationHTTP`,</span>
<span class=sd>    и обеспечивает интеграцию с внешними REST-эндпоинтами через HTTP-запросы.</span>

<span class=sd>    Args:</span>
<span class=sd>        path (str): Путь, на который отправляется запрос.</span>
<span class=sd>        version (str): Версия этого эндпоинта.</span>
<span class=sd>        docurl (str): Ссылка на документацию эндпоинта.</span>
<span class=sd>        httpmethod (HTTPMethod): Какой HTTP метод испольузеится.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Callable[..., Awaitable[R]]: Декорированная функция, готовая для интеграции с REST-эндпоинтом.</span>

<span class=sd>    Примечания:</span>
<span class=sd>        - Метод, к которому применяется декоратор, должен быть определен в классе, наследующем от `IntegrationHTTP`</span>
<span class=sd>        - Для декорируемого метода должен быть указан возвращаемый тип аннотации.</span>
<span class=sd>        - Обязательные аргументы должны быть указаны в декораторе.</span>

<span class=sd>    Raises:</span>
<span class=sd>        ValueError: Если для интеграционной функции не указан тип возвращаемого значения.</span>
<span class=sd>        TypeError: Вызыван метод не у экземпляра класса</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Awaitable</span><span class=p>[</span><span class=n>R</span><span class=p>]]:</span>

        <span class=c1># Проверить что у функции указан тип ответа</span>
        <span class=n>return_type</span> <span class=o>=</span> <span class=n>func</span><span class=o>.</span><span class=vm>__annotations__</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;return&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>return_type</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;Return type must be specified for integration function&quot;</span>
            <span class=p>)</span>

        <span class=c1># Добавить метод в хранилище</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_add_integrations_method</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>version</span><span class=p>,</span> <span class=n>docurl</span><span class=p>,</span> <span class=n>httpmethod</span><span class=p>)</span>

        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span>
            <span class=n>self_endpoint</span><span class=p>:</span> <span class=n>EndpointsDeclaration</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>R</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>self_endpoint</span><span class=p>,</span> <span class=n>EndpointsDeclaration</span><span class=p>):</span>
                <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
                    <span class=s2>&quot;Method must be called on an instance, not the class itself&quot;</span>
                <span class=p>)</span>

            <span class=c1># Полный путь до endpoint</span>
            <span class=n>url</span><span class=p>:</span> <span class=n>ParseResult</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=n>self_endpoint</span><span class=o>.</span><span class=n>base_url</span> <span class=o>+</span> <span class=n>path</span><span class=p>)</span>
            <span class=k>try</span><span class=p>:</span>

                <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>wraper_endpoint</span><span class=p>(</span>
                    <span class=n>self_endpoint</span><span class=p>,</span>
                    <span class=n>func</span><span class=p>,</span>
                    <span class=n>url</span><span class=p>,</span>
                    <span class=n>version</span><span class=p>,</span>
                    <span class=n>httpmethod</span><span class=p>,</span>
                    <span class=o>*</span><span class=n>args</span><span class=p>,</span>
                    <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
                <span class=p>)</span>
                <span class=c1># Конвертировать ответ в ожидаемый тип</span>
                <span class=k>return</span> <span class=n>convert_response</span><span class=p>(</span><span class=n>return_type</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>
            <span class=k>except</span> <span class=n>StabilityError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=c1># Если возникло исключение в обработчиках стабльности</span>
                <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
                    <span class=n>status_code</span><span class=o>=</span><span class=nb>getattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;http_status&quot;</span><span class=p>,</span> <span class=mi>500</span><span class=p>),</span>
                    <span class=n>detail</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=p>)</span>

        <span class=k>return</span> <span class=n>wrapper</span>

    <span class=k>return</span> <span class=n>decorator</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.MaxRetriesExceededError class="doc doc-heading"> <code>MaxRetriesExceededError</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.StabilityError" href="#fastapi_accelerator.integration.StabilityError">StabilityError</a></code></p> <p>Ошибка, возникающая при превышении максимального числа попыток.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>MaxRetriesExceededError</span><span class=p>(</span><span class=n>StabilityError</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Ошибка, возникающая при превышении максимального числа попыток.&quot;&quot;&quot;</span>

    <span class=c1># Этот статус указывает, что клиент отправил слишком много запросов за короткий период времени.</span>
    <span class=n>http_status</span> <span class=o>=</span> <span class=mi>429</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_attempts</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
        <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Превышено максимальное число попыток: </span><span class=si>{</span><span class=n>max_attempts</span><span class=si>}</span><span class=s2>.&quot;</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.StabilityError class="doc doc-heading"> <code>StabilityError</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>Exception</code></p> <p>Базовый класс для ошибок стабильности.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>StabilityError</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Базовый класс для ошибок стабильности.&quot;&quot;&quot;</span>

    <span class=n>http_status</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>message</span> <span class=o>=</span> <span class=n>message</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.StabilityTimeoutError class="doc doc-heading"> <code>StabilityTimeoutError</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.StabilityError" href="#fastapi_accelerator.integration.StabilityError">StabilityError</a></code></p> <p>Ошибка, возникающая при превышении времени ожидания.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>StabilityTimeoutError</span><span class=p>(</span><span class=n>StabilityError</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Ошибка, возникающая при превышении времени ожидания.&quot;&quot;&quot;</span>

    <span class=c1># Этот статус указывает, что сервер, выступающий в роли шлюза или прокси,</span>
    <span class=c1># не получил своевременный ответ от вышестоящего сервера.</span>
    <span class=n>http_status</span> <span class=o>=</span> <span class=mi>504</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Время ожидания истекло.&quot;</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.ThrottlingError class="doc doc-heading"> <code>ThrottlingError</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.StabilityError" href="#fastapi_accelerator.integration.StabilityError">StabilityError</a></code></p> <p>Ошибка, возникающая при превышении лимита запросов.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ThrottlingError</span><span class=p>(</span><span class=n>StabilityError</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Ошибка, возникающая при превышении лимита запросов.&quot;&quot;&quot;</span>

    <span class=c1># Этот статус указывает, что клиент отправил слишком много запросов за короткий период времени.</span>
    <span class=n>http_status</span> <span class=o>=</span> <span class=mi>429</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Превышен лимит запросов в секунду.&quot;</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.integration.sp class="doc doc-heading"> <code>sp</code> </h3> <div class="doc doc-contents "> <p>Содержит в себе классы реализующие паттерны стабильности.</p> <p>Рекомендуемый порядок применения паттернов стабильности:</p> <p>Fallback должен быть самым внутренним, так как он предоставляет альтернативное поведение в случае сбоя основной функции.</p> <blockquote> <p>Fallback(alternative_func)</p> </blockquote> <p>Timeout следует применять сразу после Fallback, чтобы ограничить время выполнения как основной функции, так и резервной.</p> <blockquote> <p>Timeout(seconds=timeout_seconds)</p> </blockquote> <p>CircuitBreaker идет следующим, чтобы предотвратить повторные вызовы, если функция постоянно завершается неудачно или по таймауту.</p> <blockquote> <p>CircuitBreaker(fail_threshold, reset_timeout)</p> </blockquote> <p>Retry следует за CircuitBreaker, чтобы попытаться выполнить операцию несколько раз, если CircuitBreaker позволяет это.</p> <blockquote> <p>RetryPattern(max_attempts=max_attempts, delay=timedelta(seconds=delay_seconds))</p> </blockquote> <p>Throttling применяется в последнюю очередь, чтобы ограничить частоту вызовов всей обёрнутой функциональности.</p> <blockquote> <p>Throttling(calls_per_second=calls_per_second)</p> </blockquote> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>sp</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Содержит в себе классы реализующие паттерны стабильности.</span>

<span class=sd>    Рекомендуемый порядок применения паттернов стабильности:</span>

<span class=sd>    Fallback должен быть самым внутренним, так как он предоставляет</span>
<span class=sd>    альтернативное поведение в случае сбоя основной функции.</span>
<span class=sd>    &gt; Fallback(alternative_func)</span>

<span class=sd>    Timeout следует применять сразу после Fallback, чтобы ограничить время выполнения как</span>
<span class=sd>    основной функции, так и резервной.</span>
<span class=sd>    &gt; Timeout(seconds=timeout_seconds)</span>

<span class=sd>    CircuitBreaker идет следующим, чтобы предотвратить повторные вызовы, если функция постоянно</span>
<span class=sd>    завершается неудачно или по таймауту.</span>
<span class=sd>    &gt; CircuitBreaker(fail_threshold, reset_timeout)</span>

<span class=sd>    Retry следует за CircuitBreaker, чтобы попытаться выполнить</span>
<span class=sd>    операцию несколько раз, если CircuitBreaker позволяет это.</span>
<span class=sd>    &gt; RetryPattern(max_attempts=max_attempts, delay=timedelta(seconds=delay_seconds))</span>

<span class=sd>    Throttling применяется в последнюю очередь, чтобы ограничить частоту</span>
<span class=sd>    вызовов всей обёрнутой функциональности.</span>
<span class=sd>    &gt; Throttling(calls_per_second=calls_per_second)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>class</span> <span class=nc>Fallback</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;(Резервный вариант) - Предоставляет альтернативный путь выполнения в случае сбоя основного.</span>
<span class=sd>        Позволяет системе деградировать контролируемо, а не падать с ошибкой.&quot;&quot;&quot;</span>

        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>alternative_func</span><span class=p>:</span> <span class=n>Coroutine</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            alternative_func: Функция которая вызолится при возникновение исключения</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>alternative_func</span> <span class=o>=</span> <span class=n>alternative_func</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>alternative_func</span><span class=p>()</span>

    <span class=k>class</span> <span class=nc>Timeout</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;(Тайм-аут) - Ограничивает время ожидания ответа от внешнего сервиса. Предотвращает блокировку ресурсов при</span>
<span class=sd>        зависании вызова.&quot;&quot;&quot;</span>

        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>seconds</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            seconds: Через сколько секунд прервать выполнение запроса</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>seconds</span> <span class=o>=</span> <span class=n>seconds</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>return</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>wait_for</span><span class=p>(</span><span class=n>func</span><span class=p>(),</span> <span class=n>timeout</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>seconds</span><span class=p>)</span>
            <span class=k>except</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>TimeoutError</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>StabilityTimeoutError</span><span class=p>(</span><span class=s2>&quot;Function call timed out&quot;</span><span class=p>)</span>

    <span class=k>class</span> <span class=nc>CircuitBreaker</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;(Предохранитель) - Отслеживает количество ошибок при вызове внешнего сервиса. При превышении лимита временно</span>
<span class=sd>        блокирует вызов, предотвращая каскадные сбои.</span>


<span class=sd>        Состояния Circuit Breaker:</span>

<span class=sd>        -   **Close** - Идет передача запросов между сервисами и подсчет количества сбоев.</span>
<span class=sd>            Если число сбоев за заданный интервал времени превышает пороговое значение,</span>
<span class=sd>            выключатель переводится в состояние Open.</span>

<span class=sd>        -   **Open** - Запросы от исходного сервиса немедленно возвращаются с ошибкой.</span>
<span class=sd>            По истечении заданного тайм-аута выключатель переводится в состояние Half-Open.</span>

<span class=sd>        -   **Half-open** - Выключатель пропускает ограниченное количество запросов от исходного сервиса и</span>
<span class=sd>            подсчитывает число успешных запросов. Если необходимое количество достигнуто, выключатель переходит</span>
<span class=sd>            в состояние Closed, если нет — возвращается в статус Open.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fail_threshold</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>reset_timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            fail_threshold: Пороговое значения числа сбоев</span>
<span class=sd>            reset_timeout: Период сброса подсчета количества сбоев</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>fail_threshold</span> <span class=o>=</span> <span class=n>fail_threshold</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>reset_timeout</span> <span class=o>=</span> <span class=n>reset_timeout</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;CLOSED&quot;</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>==</span> <span class=s2>&quot;OPEN&quot;</span><span class=p>:</span>
                <span class=k>if</span> <span class=p>(</span>
                    <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span>
                    <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>reset_timeout</span>
                <span class=p>):</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;HALF-OPEN&quot;</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=n>CircuitBreakerError</span><span class=p>(</span><span class=s2>&quot;Circuit is OPEN&quot;</span><span class=p>)</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>==</span> <span class=s2>&quot;HALF-OPEN&quot;</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;CLOSED&quot;</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=k>return</span> <span class=n>result</span>
            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fail_threshold</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;OPEN&quot;</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
                <span class=k>raise</span> <span class=n>e</span>

    <span class=k>class</span> <span class=nc>RetryPattern</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;(Паттерн повторения) - Автоматически повторяет запрос при возникновении временной ошибки.&quot;&quot;&quot;</span>

        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span> <span class=n>max_attempts</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>delay</span><span class=p>:</span> <span class=n>timedelta</span> <span class=o>=</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            max_attempts: Сколько раз попытаться повторить запрос</span>
<span class=sd>            delay: Задержка между попытками запросов</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span> <span class=o>=</span> <span class=n>max_attempts</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>delay</span> <span class=o>=</span> <span class=n>delay</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
            <span class=n>attempts</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>while</span> <span class=n>attempts</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>:</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                    <span class=n>attempts</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=k>if</span> <span class=n>attempts</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>:</span>
                        <span class=k>raise</span> <span class=n>MaxRetriesExceededError</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>e</span>
                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>delay</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>())</span>

    <span class=k>class</span> <span class=nc>Throttling</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;(Регулирование) - Ограничивает количество запросов к ресурсу для предотвращения его перегрузки.</span>
<span class=sd>        Защищает систему от шторма запросов.&quot;&quot;&quot;</span>

        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>calls_per_second</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1_000</span><span class=p>):</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            calls_per_second: Сколько разрешено запросов в секунду</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>calls_per_second</span> <span class=o>=</span> <span class=n>calls_per_second</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_interval</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>calls_per_second</span>

        <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
            <span class=n>current_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
            <span class=n>time_passed</span> <span class=o>=</span> <span class=n>current_time</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span>
            <span class=c1># Вычисляем, сколько времени нужно подождать</span>
            <span class=k>if</span> <span class=n>time_passed</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>_interval</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>ThrottlingError</span><span class=p>(</span><span class=s2>&quot;Превышен лимит запросов в секунду.&quot;</span><span class=p>)</span>
            <span class=c1># Обновляем время последнего вызова</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
            <span class=c1># Вызываем переданную функцию</span>
            <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.sp.CircuitBreaker class="doc doc-heading"> <code>CircuitBreaker</code> </h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.BaseStabilityPattern" href="#fastapi_accelerator.integration.BaseStabilityPattern">BaseStabilityPattern</a></code></p> <p>(Предохранитель) - Отслеживает количество ошибок при вызове внешнего сервиса. При превышении лимита временно блокирует вызов, предотвращая каскадные сбои.</p> <p>Состояния Circuit Breaker:</p> <ul> <li> <p><strong>Close</strong> - Идет передача запросов между сервисами и подсчет количества сбоев. Если число сбоев за заданный интервал времени превышает пороговое значение, выключатель переводится в состояние Open.</p> </li> <li> <p><strong>Open</strong> - Запросы от исходного сервиса немедленно возвращаются с ошибкой. По истечении заданного тайм-аута выключатель переводится в состояние Half-Open.</p> </li> <li> <p><strong>Half-open</strong> - Выключатель пропускает ограниченное количество запросов от исходного сервиса и подсчитывает число успешных запросов. Если необходимое количество достигнуто, выключатель переходит в состояние Closed, если нет — возвращается в статус Open.</p> </li> </ul> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>CircuitBreaker</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;(Предохранитель) - Отслеживает количество ошибок при вызове внешнего сервиса. При превышении лимита временно</span>
<span class=sd>    блокирует вызов, предотвращая каскадные сбои.</span>


<span class=sd>    Состояния Circuit Breaker:</span>

<span class=sd>    -   **Close** - Идет передача запросов между сервисами и подсчет количества сбоев.</span>
<span class=sd>        Если число сбоев за заданный интервал времени превышает пороговое значение,</span>
<span class=sd>        выключатель переводится в состояние Open.</span>

<span class=sd>    -   **Open** - Запросы от исходного сервиса немедленно возвращаются с ошибкой.</span>
<span class=sd>        По истечении заданного тайм-аута выключатель переводится в состояние Half-Open.</span>

<span class=sd>    -   **Half-open** - Выключатель пропускает ограниченное количество запросов от исходного сервиса и</span>
<span class=sd>        подсчитывает число успешных запросов. Если необходимое количество достигнуто, выключатель переходит</span>
<span class=sd>        в состояние Closed, если нет — возвращается в статус Open.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fail_threshold</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>reset_timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        fail_threshold: Пороговое значения числа сбоев</span>
<span class=sd>        reset_timeout: Период сброса подсчета количества сбоев</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>fail_threshold</span> <span class=o>=</span> <span class=n>fail_threshold</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>reset_timeout</span> <span class=o>=</span> <span class=n>reset_timeout</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;CLOSED&quot;</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>==</span> <span class=s2>&quot;OPEN&quot;</span><span class=p>:</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span>
                <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>reset_timeout</span>
            <span class=p>):</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;HALF-OPEN&quot;</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>CircuitBreakerError</span><span class=p>(</span><span class=s2>&quot;Circuit is OPEN&quot;</span><span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>==</span> <span class=s2>&quot;HALF-OPEN&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;CLOSED&quot;</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>return</span> <span class=n>result</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fail_threshold</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;OPEN&quot;</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
            <span class=k>raise</span> <span class=n>e</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=fastapi_accelerator.integration.sp.CircuitBreaker.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>fail_threshold</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>reset_timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span></code> </h5> <div class="doc doc-contents "> <p>fail_threshold: Пороговое значения числа сбоев reset_timeout: Период сброса подсчета количества сбоев</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fail_threshold</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>reset_timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    fail_threshold: Пороговое значения числа сбоев</span>
<span class=sd>    reset_timeout: Период сброса подсчета количества сбоев</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>fail_threshold</span> <span class=o>=</span> <span class=n>fail_threshold</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>reset_timeout</span> <span class=o>=</span> <span class=n>reset_timeout</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_failures</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_last_failure_time</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=s2>&quot;CLOSED&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.sp.Fallback class="doc doc-heading"> <code>Fallback</code> </h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.BaseStabilityPattern" href="#fastapi_accelerator.integration.BaseStabilityPattern">BaseStabilityPattern</a></code></p> <p>(Резервный вариант) - Предоставляет альтернативный путь выполнения в случае сбоя основного. Позволяет системе деградировать контролируемо, а не падать с ошибкой.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>Fallback</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;(Резервный вариант) - Предоставляет альтернативный путь выполнения в случае сбоя основного.</span>
<span class=sd>    Позволяет системе деградировать контролируемо, а не падать с ошибкой.&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>alternative_func</span><span class=p>:</span> <span class=n>Coroutine</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        alternative_func: Функция которая вызолится при возникновение исключения</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>alternative_func</span> <span class=o>=</span> <span class=n>alternative_func</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>alternative_func</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=fastapi_accelerator.integration.sp.Fallback.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>alternative_func</span><span class=p>)</span></code> </h5> <div class="doc doc-contents "> <p>alternative_func: Функция которая вызолится при возникновение исключения</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>alternative_func</span><span class=p>:</span> <span class=n>Coroutine</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    alternative_func: Функция которая вызолится при возникновение исключения</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>alternative_func</span> <span class=o>=</span> <span class=n>alternative_func</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.sp.RetryPattern class="doc doc-heading"> <code>RetryPattern</code> </h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.BaseStabilityPattern" href="#fastapi_accelerator.integration.BaseStabilityPattern">BaseStabilityPattern</a></code></p> <p>(Паттерн повторения) - Автоматически повторяет запрос при возникновении временной ошибки.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>RetryPattern</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;(Паттерн повторения) - Автоматически повторяет запрос при возникновении временной ошибки.&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>max_attempts</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>delay</span><span class=p>:</span> <span class=n>timedelta</span> <span class=o>=</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        max_attempts: Сколько раз попытаться повторить запрос</span>
<span class=sd>        delay: Задержка между попытками запросов</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span> <span class=o>=</span> <span class=n>max_attempts</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>delay</span> <span class=o>=</span> <span class=n>delay</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
        <span class=n>attempts</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>while</span> <span class=n>attempts</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>attempts</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=k>if</span> <span class=n>attempts</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=n>MaxRetriesExceededError</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>e</span>
                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>delay</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=fastapi_accelerator.integration.sp.RetryPattern.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>max_attempts</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>delay</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span></code> </h5> <div class="doc doc-contents "> <p>max_attempts: Сколько раз попытаться повторить запрос delay: Задержка между попытками запросов</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>max_attempts</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>delay</span><span class=p>:</span> <span class=n>timedelta</span> <span class=o>=</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    max_attempts: Сколько раз попытаться повторить запрос</span>
<span class=sd>    delay: Задержка между попытками запросов</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>max_attempts</span> <span class=o>=</span> <span class=n>max_attempts</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>delay</span> <span class=o>=</span> <span class=n>delay</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.sp.Throttling class="doc doc-heading"> <code>Throttling</code> </h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.BaseStabilityPattern" href="#fastapi_accelerator.integration.BaseStabilityPattern">BaseStabilityPattern</a></code></p> <p>(Регулирование) - Ограничивает количество запросов к ресурсу для предотвращения его перегрузки. Защищает систему от шторма запросов.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>Throttling</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;(Регулирование) - Ограничивает количество запросов к ресурсу для предотвращения его перегрузки.</span>
<span class=sd>    Защищает систему от шторма запросов.&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>calls_per_second</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1_000</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        calls_per_second: Сколько разрешено запросов в секунду</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>calls_per_second</span> <span class=o>=</span> <span class=n>calls_per_second</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_interval</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>calls_per_second</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
        <span class=n>current_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
        <span class=n>time_passed</span> <span class=o>=</span> <span class=n>current_time</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span>
        <span class=c1># Вычисляем, сколько времени нужно подождать</span>
        <span class=k>if</span> <span class=n>time_passed</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>_interval</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>ThrottlingError</span><span class=p>(</span><span class=s2>&quot;Превышен лимит запросов в секунду.&quot;</span><span class=p>)</span>
        <span class=c1># Обновляем время последнего вызова</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
        <span class=c1># Вызываем переданную функцию</span>
        <span class=k>return</span> <span class=k>await</span> <span class=n>func</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=fastapi_accelerator.integration.sp.Throttling.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>calls_per_second</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span></code> </h5> <div class="doc doc-contents "> <p>calls_per_second: Сколько разрешено запросов в секунду</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>calls_per_second</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1_000</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    calls_per_second: Сколько разрешено запросов в секунду</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>calls_per_second</span> <span class=o>=</span> <span class=n>calls_per_second</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_last_called</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_interval</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>calls_per_second</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.integration.sp.Timeout class="doc doc-heading"> <code>Timeout</code> </h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.integration.stability_patterns.BaseStabilityPattern" href="#fastapi_accelerator.integration.BaseStabilityPattern">BaseStabilityPattern</a></code></p> <p>(Тайм-аут) - Ограничивает время ожидания ответа от внешнего сервиса. Предотвращает блокировку ресурсов при зависании вызова.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>Timeout</span><span class=p>(</span><span class=n>BaseStabilityPattern</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;(Тайм-аут) - Ограничивает время ожидания ответа от внешнего сервиса. Предотвращает блокировку ресурсов при</span>
<span class=sd>    зависании вызова.&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>seconds</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        seconds: Через сколько секунд прервать выполнение запроса</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>seconds</span> <span class=o>=</span> <span class=n>seconds</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>Coroutine</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>wait_for</span><span class=p>(</span><span class=n>func</span><span class=p>(),</span> <span class=n>timeout</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>seconds</span><span class=p>)</span>
        <span class=k>except</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>TimeoutError</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>StabilityTimeoutError</span><span class=p>(</span><span class=s2>&quot;Function call timed out&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=fastapi_accelerator.integration.sp.Timeout.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span></code> </h5> <div class="doc doc-contents "> <p>seconds: Через сколько секунд прервать выполнение запроса</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/stability_patterns.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>seconds</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    seconds: Через сколько секунд прервать выполнение запроса</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>seconds</span> <span class=o>=</span> <span class=n>seconds</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.integration.convert_response class="doc doc-heading"> <code class="highlight language-python"><span class=n>convert_response</span><span class=p>(</span><span class=n>rtypes</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Конвертирует входные данные в модель Pydantic или список моделей.</p> <p>Эта функция пытается преобразовать входные данные в указанный тип или типы. Она поддерживает одиночные типы, Union типы, и списки типов.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>rtypes</code></td> <td> <code><span title="types.GenericAlias">GenericAlias</span></code> </td> <td> <div class=doc-md-description> <p>Ожидаемый тип или типы ответа. Может быть одиночным типом или Union из нескольких типов.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td><code>data</code></td> <td> <code><span title="typing.Union">Union</span>[dict, list]</code> </td> <td> <div class=doc-md-description> <p>Данные для конвертации. Могут быть словарем или списком.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="typing.Union">Union</span>[<span title="typing.Any">Any</span>, <span title="pydantic.BaseModel">BaseModel</span>, <span title="typing.List">List</span>[<span title="pydantic.BaseModel">BaseModel</span>]]</code> </td> <td> <div class=doc-md-description> <p>Union[dict, list, BaseModel, List[BaseModel]]: Сконвертированные данные.</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title="typing.Union">Union</span>[<span title="typing.Any">Any</span>, <span title="pydantic.BaseModel">BaseModel</span>, <span title="typing.List">List</span>[<span title="pydantic.BaseModel">BaseModel</span>]]</code> </td> <td> <div class=doc-md-description> <p>Если конвертация не удалась или не требовалась, возвращаются исходные данные.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title="pydantic_core.ValidationError">ValidationError</span></code> </td> <td> <div class=doc-md-description> <p>Если все попытки конвертации завершились неудачно.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/base_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>convert_response</span><span class=p>(</span>
    <span class=n>rtypes</span><span class=p>:</span> <span class=n>GenericAlias</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Any</span><span class=p>,</span> <span class=nb>dict</span><span class=p>,</span> <span class=nb>list</span><span class=p>]</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Any</span><span class=p>,</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Конвертирует входные данные в модель Pydantic или список моделей.</span>

<span class=sd>    Эта функция пытается преобразовать входные данные в указанный тип или типы.</span>
<span class=sd>    Она поддерживает одиночные типы, Union типы, и списки типов.</span>

<span class=sd>    Args:</span>
<span class=sd>        rtypes (GenericAlias):</span>
<span class=sd>            Ожидаемый тип или типы ответа. Может быть одиночным типом или Union из нескольких типов.</span>
<span class=sd>        data (Union[dict, list]):</span>
<span class=sd>            Данные для конвертации. Могут быть словарем или списком.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[dict, list, BaseModel, List[BaseModel]]: Сконвертированные данные.</span>
<span class=sd>        Если конвертация не удалась или не требовалась, возвращаются исходные данные.</span>

<span class=sd>    Raises:</span>
<span class=sd>        ValidationError: Если все попытки конвертации завершились неудачно.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Если rtypes - это Union, разворачиваем его в список типов.</span>
    <span class=c1># В противном случае, создаем список из одного элемента.</span>
    <span class=n>rtypes</span> <span class=o>=</span> <span class=n>rtypes</span><span class=o>.</span><span class=n>__args__</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>rtypes</span><span class=p>,</span> <span class=n>UnionType</span><span class=p>)</span> <span class=k>else</span> <span class=p>[</span><span class=n>rtypes</span><span class=p>]</span>

    <span class=c1># Определяем, сколько ошибок можно пропустить.</span>
    <span class=c1># Это позволяет попробовать все типы из Union перед тем, как выбросить исключение.</span>
    <span class=n>skip_error</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>rtypes</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>

    <span class=k>for</span> <span class=n>rtype</span> <span class=ow>in</span> <span class=n>rtypes</span><span class=p>:</span>
        <span class=c1># Проверяем, ожидается ли список элементов</span>
        <span class=n>origin</span> <span class=o>=</span> <span class=n>get_origin</span><span class=p>(</span><span class=n>rtype</span><span class=p>)</span>
        <span class=n>many</span> <span class=o>=</span> <span class=n>origin</span> <span class=ow>is</span> <span class=nb>list</span>
        <span class=k>if</span> <span class=n>many</span><span class=p>:</span>
            <span class=c1># Если ожидается список, извлекаем тип элементов списка</span>
            <span class=n>rtype</span> <span class=o>=</span> <span class=n>get_args</span><span class=p>(</span><span class=n>rtype</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

        <span class=c1># Проверяем, является ли ожидаемый тип Pydantic моделью</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>rtype</span><span class=p>,</span> <span class=nb>type</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>issubclass</span><span class=p>(</span><span class=n>rtype</span><span class=p>,</span> <span class=n>BaseModel</span><span class=p>):</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>many</span><span class=p>:</span>
                    <span class=c1># Если ожидается список моделей, применяем parse_obj к каждому элементу</span>
                    <span class=k>return</span> <span class=p>[</span><span class=n>rtype</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>d</span><span class=p>)</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>data</span><span class=p>]</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=c1># Если ожидается одна модель, применяем parse_obj ко всем данным</span>
                    <span class=k>return</span> <span class=n>rtype</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
            <span class=k>except</span> <span class=n>ValidationError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=c1># Если возникла ошибка валидации, проверяем, можно ли её пропустить</span>
                <span class=k>if</span> <span class=n>skip_error</span><span class=p>:</span>
                    <span class=c1># Если можно пропустить, уменьшаем счетчик и продолжаем цикл</span>
                    <span class=n>skip_error</span> <span class=o>-=</span> <span class=mi>1</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=c1># Если пропустить нельзя, выбрасываем исключение</span>
                    <span class=k>raise</span> <span class=n>e</span>
        <span class=c1># Есои не указана схема, то не пытаемся делать конвертацию типов</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>break</span>

    <span class=c1># Если ни одна конвертация не удалась или не требовалась, возвращаем исходные данные</span>
    <span class=k>return</span> <span class=n>data</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.integration.wraper_endpoint class="doc doc-heading"> <code class="highlight language-python"><span class=n>wraper_endpoint</span><span class=p>(</span><span class=n>self_endpoint</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>version</span><span class=p>,</span> <span class=n>httpmethod</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h3> <div class="doc doc-contents "> <p>Выполнить метод с интеграцией</p> <details class=примечание open> <summary>Примечание</summary> <p>Эта функция можно будет заменена во вемя тестирования, чтобы не делать реальные запросы. Для этого используйте фикстуру patch_integration</p> </details> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>async</span> <span class=k>def</span> <span class=nf>wraper_endpoint</span><span class=p>(</span>
    <span class=n>self_endpoint</span><span class=p>:</span> <span class=n>EndpointsDeclaration</span><span class=p>,</span>
    <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>,</span>
    <span class=n>url</span><span class=p>:</span> <span class=n>ParseResult</span><span class=p>,</span>
    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>httpmethod</span><span class=p>:</span> <span class=n>HTTPMethod</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span><span class=p>,</span>
    <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>R</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Выполнить метод с интеграцией</span>

<span class=sd>    Примечание:</span>
<span class=sd>        Эта функция можно будет заменена во вемя тестирования,</span>
<span class=sd>        чтобы не делать реальные запросы.</span>
<span class=sd>        Для этого используйте фикстуру patch_integration</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>async</span> <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>(</span>
            <span class=n>ApiHTTP</span><span class=p>(</span><span class=n>self_endpoint</span><span class=o>.</span><span class=n>credentials</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>version</span><span class=p>,</span> <span class=n>httpmethod</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>client</span><span class=p>),</span>
            <span class=o>*</span><span class=n>args</span><span class=p>,</span>
            <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>response</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=fastapi_acceleratortestutils>fastapi_accelerator.testutils</h2> <div class="doc doc-object doc-module"> <a id=fastapi_accelerator.testutils></a> <div class="doc doc-contents first"> <p>Пакет с логикой тестовых фикстур, который упрощают создания и поддержание тестов в FastAPi проекте</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.ApiHTTP class="doc doc-heading"> <code>ApiHTTP</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p> <p>Stores API connection details and client.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>ApiHTTP</span><span class=p>(</span><span class=n>NamedTuple</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Stores API connection details and client.&quot;&quot;&quot;</span>

    <span class=n>credentials</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=kc>None</span>  <span class=c1># Authentication credentials</span>
    <span class=n>url</span><span class=p>:</span> <span class=n>ParseResult</span>  <span class=c1># Parsed URL of the API endpoint</span>
    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># API version</span>
    <span class=n>httpmethod</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># Use HTTP method</span>
    <span class=n>client</span><span class=p>:</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span> <span class=o>|</span> <span class=kc>None</span>  <span class=c1># HTTP client for making requests (None in tests)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.BaseAuthJWT class="doc doc-heading"> <code>BaseAuthJWT</code> </h3> <div class="doc doc-contents "> <p>Пример:</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>AuthJWT</span><span class=p>(</span><span class=n>BaseAuthJWT</span><span class=p>):</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>username</span> <span class=o>==</span> <span class=s2>&quot;admin&quot;</span> <span class=ow>and</span> <span class=n>password</span> <span class=o>==</span> <span class=s2>&quot;admin&quot;</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>username</span><span class=o>.</span><span class=n>title</span><span class=p>()}</span>


<span class=c1># Подключить аутентификацию по JWT</span>
<span class=n>AuthJWT</span><span class=o>.</span><span class=n>mount_auth</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</code></pre></div> <p>Пример защиты API метода:</p> <div class=highlight><pre><span></span><code><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/cheack_protected&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseAuthJWT</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Пример:</span>

<span class=sd>    ```python</span>
<span class=sd>    class AuthJWT(BaseAuthJWT):</span>
<span class=sd>        async def check_auth(username: str, password: str) -&gt; bool:</span>
<span class=sd>            &quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
<span class=sd>            return username == &quot;admin&quot; and password == &quot;admin&quot;</span>

<span class=sd>        async def add_jwt_body(username: str) -&gt; dict:</span>
<span class=sd>            &quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>
<span class=sd>            return {&quot;version&quot;: username.title()}</span>


<span class=sd>    # Подключить аутентификацию по JWT</span>
<span class=sd>    AuthJWT.mount_auth(app)</span>
<span class=sd>    ```</span>

<span class=sd>    Пример защиты API метода:</span>

<span class=sd>    ```python</span>
<span class=sd>    @app.get(&quot;/cheack_protected&quot;, summary=&quot;Проверить аутентификацию по JWT&quot;)</span>
<span class=sd>    async def protected_route(jwt: dict = Depends(jwt_auth)):</span>
<span class=sd>        return {&quot;message&quot;: &quot;This is a protected route&quot;, &quot;user&quot;: jwt}</span>
<span class=sd>    ```</span>
<span class=sd>    &#39;&#39;&#39;</span>

    <span class=n>ALGORITHM</span> <span class=o>=</span> <span class=s2>&quot;HS256&quot;</span>
    <span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span> <span class=o>=</span> <span class=mi>30</span>
    <span class=c1># Установиться автоматически в mount_auth</span>
    <span class=n>secret_key</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>

    <span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>mount_auth</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>app</span><span class=p>:</span> <span class=n>FastAPI</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Подключение аутентификации по JWT&quot;&quot;&quot;</span>
        <span class=c1># Установить класс для аутентификации</span>
        <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>auth_jwt</span> <span class=o>=</span> <span class=bp>cls</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>SECRET_KEY</span>

        <span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/token&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Аутентификация по JWT&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>])</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>login</span><span class=p>(</span>
            <span class=n>user</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>OAuth2PasswordRequestForm</span><span class=p>,</span> <span class=n>Depends</span><span class=p>()],</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Token</span><span class=p>:</span>
            <span class=k>if</span> <span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>check_auth</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>user</span><span class=o>.</span><span class=n>password</span><span class=p>):</span>
                <span class=k>return</span> <span class=n>Token</span><span class=p>(</span>
                    <span class=n>access_token</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>_create_access_token</span><span class=p>(</span>
                        <span class=n>data</span><span class=o>=</span><span class=p>{</span>
                            <span class=s2>&quot;sub&quot;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span>
                            <span class=o>**</span><span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>),</span>
                        <span class=p>},</span>
                    <span class=p>),</span>
                    <span class=n>token_type</span><span class=o>=</span><span class=s2>&quot;bearer&quot;</span><span class=p>,</span>
                <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&quot;Invalid credentials&quot;</span><span class=p>)</span>

        <span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=s2>&quot;/check_protected&quot;</span><span class=p>,</span>
            <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>,</span>
            <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>],</span>
        <span class=p>)</span>
        <span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>

        <span class=k>return</span> <span class=n>login</span><span class=p>,</span> <span class=n>protected_route</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>_create_access_token</span><span class=p>(</span>
        <span class=bp>cls</span><span class=p>,</span>
        <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
        <span class=n>expires_delta</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>timedelta</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Создание JWT токена&quot;&quot;&quot;</span>
        <span class=n>to_encode</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>expires_delta</span><span class=p>:</span>
            <span class=n>expire</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>expires_delta</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>expire</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span>
                <span class=n>minutes</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span>
            <span class=p>)</span>
        <span class=n>to_encode</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&quot;exp&quot;</span><span class=p>:</span> <span class=n>expire</span><span class=p>})</span>
        <span class=n>encoded_jwt</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>to_encode</span><span class=p>,</span> <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>ALGORITHM</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>encoded_jwt</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>_verify_token</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>token</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Проверка валидности JWT токена&quot;&quot;&quot;</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>payload</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span><span class=bp>cls</span><span class=o>.</span><span class=n>ALGORITHM</span><span class=p>])</span>
            <span class=k>return</span> <span class=n>payload</span>
        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>ExpiredSignatureError</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>
        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>InvalidTokenError</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BaseAuthJWT.add_jwt_body class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Функция для добавление дополнительных данных в JWT токен пользователя</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>add_jwt_body</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Функция для добавление дополнительных данных в JWT токен пользователя&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BaseAuthJWT.check_auth class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> </h4> <div class="doc doc-contents "> <p>Проверка введенного логина и пароля.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Проверка введенного логина и пароля.&quot;&quot;&quot;</span>
    <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BaseAuthJWT.mount_auth class="doc doc-heading"> <code class="highlight language-python"><span class=n>mount_auth</span><span class=p>(</span><span class=n>app</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Подключение аутентификации по JWT</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/auth_jwt.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>mount_auth</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>app</span><span class=p>:</span> <span class=n>FastAPI</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Подключение аутентификации по JWT&quot;&quot;&quot;</span>
    <span class=c1># Установить класс для аутентификации</span>
    <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>auth_jwt</span> <span class=o>=</span> <span class=bp>cls</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>SECRET_KEY</span>

    <span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/token&quot;</span><span class=p>,</span> <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Аутентификация по JWT&quot;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>])</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>login</span><span class=p>(</span>
        <span class=n>user</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>OAuth2PasswordRequestForm</span><span class=p>,</span> <span class=n>Depends</span><span class=p>()],</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Token</span><span class=p>:</span>
        <span class=k>if</span> <span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>check_auth</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>user</span><span class=o>.</span><span class=n>password</span><span class=p>):</span>
            <span class=k>return</span> <span class=n>Token</span><span class=p>(</span>
                <span class=n>access_token</span><span class=o>=</span><span class=bp>cls</span><span class=o>.</span><span class=n>_create_access_token</span><span class=p>(</span>
                    <span class=n>data</span><span class=o>=</span><span class=p>{</span>
                        <span class=s2>&quot;sub&quot;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span>
                        <span class=o>**</span><span class=k>await</span> <span class=bp>cls</span><span class=o>.</span><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>),</span>
                    <span class=p>},</span>
                <span class=p>),</span>
                <span class=n>token_type</span><span class=o>=</span><span class=s2>&quot;bearer&quot;</span><span class=p>,</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&quot;Invalid credentials&quot;</span><span class=p>)</span>

    <span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=s2>&quot;/check_protected&quot;</span><span class=p>,</span>
        <span class=n>summary</span><span class=o>=</span><span class=s2>&quot;Проверить аутентификацию по JWT&quot;</span><span class=p>,</span>
        <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;common&quot;</span><span class=p>],</span>
    <span class=p>)</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>protected_route</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>jwt</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>jwt_auth</span><span class=p>)):</span>
        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This is a protected route&quot;</span><span class=p>,</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=n>jwt</span><span class=p>}</span>

    <span class=k>return</span> <span class=n>login</span><span class=p>,</span> <span class=n>protected_route</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.BaseAuthJwtPytest class="doc doc-heading"> <code>BaseAuthJwtPytest</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="fastapi_accelerator.testutils.utils.BasePytest" href="#fastapi_accelerator.testutils.BasePytest">BasePytest</a></code></p> <p>Базовый класс для тестов с использованием pytest, который выполняет логику аутентификации для клиента по JWT</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BaseAuthJwtPytest</span><span class=p>(</span><span class=n>BasePytest</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Базовый класс для тестов с использованием pytest,</span>
<span class=sd>    который выполняет логику аутентификации для клиента по JWT</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>autouse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>def</span> <span class=nf>setup_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>):</span>
        <span class=nd>@client_auth_jwt</span><span class=p>()</span>
        <span class=k>def</span> <span class=nf>inner</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>):</span>
            <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>setup_method</span><span class=p>()</span>

        <span class=k>return</span> <span class=n>inner</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=o>=</span><span class=n>client</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.BasePytest class="doc doc-heading"> <code>BasePytest</code> </h3> <div class="doc doc-contents "> <p>Базовый класс для тестов с использованием pytest.</p> <p>Данный класс предоставляет методы для настройки и очистки состояния тестов. Наследуйте этот класс и называйте дочерний класс в формате:</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>TestИмяКласса</span><span class=p>(</span><span class=n>BasePytest</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>setUp</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=o>...</span>

    <span class=k>def</span> <span class=nf>test_метод_1</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=o>...</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>BasePytest</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Базовый класс для тестов с использованием pytest.</span>

<span class=sd>    Данный класс предоставляет методы для настройки и очистки состояния тестов.</span>
<span class=sd>    Наследуйте этот класс и называйте дочерний класс в формате:</span>

<span class=sd>    ```python</span>
<span class=sd>    class TestИмяКласса(BasePytest):</span>

<span class=sd>        def setUp(self):</span>
<span class=sd>            ...</span>

<span class=sd>        def test_метод_1(self):</span>
<span class=sd>            ...</span>
<span class=sd>    ```</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Данные для входа тестового пользователя</span>
    <span class=n>TEST_USER</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;username&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>,</span> <span class=s2>&quot;password&quot;</span><span class=p>:</span> <span class=s2>&quot;qwerty&quot;</span><span class=p>}</span>

    <span class=k>def</span> <span class=nf>setup_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Вызывается перед выполнением каждого тестового метода.</span>

<span class=sd>        Этот метод вызывает setUp(), который может быть переопределен в дочернем классе</span>
<span class=sd>        для выполнения необходимой настройки перед тестами.</span>

<span class=sd>        :param method: Метод, который будет выполняться (тест).</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>setUp</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>setUp</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Метод для выполнения необходимой настройки перед каждым тестом.</span>

<span class=sd>        Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>        настройки, необходимой для тестов.</span>
<span class=sd>        &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=nf>teardown_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Вызывается после выполнения каждого тестового метода.</span>

<span class=sd>        Этот метод вызывает tearDown(), который может быть переопределен в дочернем классе</span>
<span class=sd>        для выполнения необходимой очистки после тестов.</span>

<span class=sd>        :param method: Метод, который был выполнен (тест).</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>tearDown</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>tearDown</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Метод для выполнения необходимой очистки после каждого теста.</span>

<span class=sd>        Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>        очистки, необходимой после тестов.</span>
<span class=sd>        &quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>setup_class</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Вызывается перед выполнением всех тестовых методов в классе.</span>

<span class=sd>        Этот метод вызывает setUpClass(), который может быть переопределен в дочернем классе</span>
<span class=sd>        для выполнения необходимой настройки перед всеми тестами в классе.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>setUpClass</span><span class=p>()</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>setUpClass</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Метод для выполнения необходимой настройки перед всеми тестами в классе.</span>

<span class=sd>        Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>        настройки, необходимой для всех тестов в классе.</span>
<span class=sd>        &quot;&quot;&quot;</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>teardown_class</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Вызывается после выполнения всех тестовых методов в классе.</span>

<span class=sd>        Этот метод может быть переопределен в дочернем классе для выполнения необходимой</span>
<span class=sd>        очистки после всех тестов в классе.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>tearDownClass</span><span class=p>()</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>tearDownClass</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Метод для выполнения необходимой очистки после всех тестов в классе.</span>

<span class=sd>        Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>        очистки, необходимой после всех тестов в классе.</span>
<span class=sd>        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.setUp class="doc doc-heading"> <code class="highlight language-python"><span class=n>setUp</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>Метод для выполнения необходимой настройки перед каждым тестом.</p> <p>Этот метод может быть переопределен в дочернем классе для выполнения специфической настройки, необходимой для тестов.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>setUp</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Метод для выполнения необходимой настройки перед каждым тестом.</span>

<span class=sd>    Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>    настройки, необходимой для тестов.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.setUpClass class="doc doc-heading"> <code class="highlight language-python"><span class=n>setUpClass</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Метод для выполнения необходимой настройки перед всеми тестами в классе.</p> <p>Этот метод может быть переопределен в дочернем классе для выполнения специфической настройки, необходимой для всех тестов в классе.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>setUpClass</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Метод для выполнения необходимой настройки перед всеми тестами в классе.</span>

<span class=sd>    Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>    настройки, необходимой для всех тестов в классе.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.setup_class class="doc doc-heading"> <code class="highlight language-python"><span class=n>setup_class</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Вызывается перед выполнением всех тестовых методов в классе.</p> <p>Этот метод вызывает setUpClass(), который может быть переопределен в дочернем классе для выполнения необходимой настройки перед всеми тестами в классе.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>setup_class</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Вызывается перед выполнением всех тестовых методов в классе.</span>

<span class=sd>    Этот метод вызывает setUpClass(), который может быть переопределен в дочернем классе</span>
<span class=sd>    для выполнения необходимой настройки перед всеми тестами в классе.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>setUpClass</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.setup_method class="doc doc-heading"> <code class="highlight language-python"><span class=n>setup_method</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <p>Вызывается перед выполнением каждого тестового метода.</p> <p>Этот метод вызывает setUp(), который может быть переопределен в дочернем классе для выполнения необходимой настройки перед тестами.</p> <p>:param method: Метод, который будет выполняться (тест).</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>setup_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Вызывается перед выполнением каждого тестового метода.</span>

<span class=sd>    Этот метод вызывает setUp(), который может быть переопределен в дочернем классе</span>
<span class=sd>    для выполнения необходимой настройки перед тестами.</span>

<span class=sd>    :param method: Метод, который будет выполняться (тест).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>setUp</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.tearDown class="doc doc-heading"> <code class="highlight language-python"><span class=n>tearDown</span><span class=p>()</span></code> </h4> <div class="doc doc-contents "> <p>Метод для выполнения необходимой очистки после каждого теста.</p> <p>Этот метод может быть переопределен в дочернем классе для выполнения специфической очистки, необходимой после тестов.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>tearDown</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Метод для выполнения необходимой очистки после каждого теста.</span>

<span class=sd>    Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>    очистки, необходимой после тестов.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.tearDownClass class="doc doc-heading"> <code class="highlight language-python"><span class=n>tearDownClass</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Метод для выполнения необходимой очистки после всех тестов в классе.</p> <p>Этот метод может быть переопределен в дочернем классе для выполнения специфической очистки, необходимой после всех тестов в классе.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>tearDownClass</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Метод для выполнения необходимой очистки после всех тестов в классе.</span>

<span class=sd>    Этот метод может быть переопределен в дочернем классе для выполнения специфической</span>
<span class=sd>    очистки, необходимой после всех тестов в классе.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.teardown_class class="doc doc-heading"> <code class="highlight language-python"><span class=n>teardown_class</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h4> <div class="doc doc-contents "> <p>Вызывается после выполнения всех тестовых методов в классе.</p> <p>Этот метод может быть переопределен в дочернем классе для выполнения необходимой очистки после всех тестов в классе.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span> <span class=nf>teardown_class</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Вызывается после выполнения всех тестовых методов в классе.</span>

<span class=sd>    Этот метод может быть переопределен в дочернем классе для выполнения необходимой</span>
<span class=sd>    очистки после всех тестов в классе.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>cls</span><span class=o>.</span><span class=n>tearDownClass</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.BasePytest.teardown_method class="doc doc-heading"> <code class="highlight language-python"><span class=n>teardown_method</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <p>Вызывается после выполнения каждого тестового метода.</p> <p>Этот метод вызывает tearDown(), который может быть переопределен в дочернем классе для выполнения необходимой очистки после тестов.</p> <p>:param method: Метод, который был выполнен (тест).</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>teardown_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Вызывается после выполнения каждого тестового метода.</span>

<span class=sd>    Этот метод вызывает tearDown(), который может быть переопределен в дочернем классе</span>
<span class=sd>    для выполнения необходимой очистки после тестов.</span>

<span class=sd>    :param method: Метод, который был выполнен (тест).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>tearDown</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.EndpointsDeclaration class="doc doc-heading"> <code>EndpointsDeclaration</code> </h3> <div class="doc doc-contents "> <p>Базовый класс для объявления интеграций с внешними API.</p> <p>Этот класс предоставляет платформу для определения и управления интеграциями API, включая обработку аутентификации и настройку базового URL.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>EndpointsDeclaration</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Базовый класс для объявления интеграций с внешними API.</span>

<span class=sd>    Этот класс предоставляет платформу для определения и управления интеграциями API,</span>
<span class=sd>    включая обработку аутентификации и настройку базового URL.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>integration</span><span class=p>:</span> <span class=n>IntegrationHTTP</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_url</span><span class=p>:</span> <span class=n>URL</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>credentials</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Аргументы:</span>
<span class=sd>            base_url (URL): Базовый URL для API. Это может быть доменное имя или адрес в формате host:port.</span>
<span class=sd>            credentials (dict | None): Доступные учетные данные для аутентификации в внешней системе.</span>

<span class=sd>        Примечание:</span>
<span class=sd>            Рекомендуется задавать base_url через переменные окружения, чтобы избежать проблем с конфигурацией</span>
<span class=sd>            на разных уровнях (например, на production-среде) из-за межсетевых экранов или других факторов.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>base_url</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>credentials</span> <span class=o>=</span> <span class=n>credentials</span>

    <span class=k>class</span> <span class=nc>Schema</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для успешных ответов.</span>

<span class=sd>        Эта схема описывает структуру данных, которые ожидаются в успешных ответах от REST API.</span>
<span class=sd>        &quot;&quot;&quot;</span>

    <span class=k>class</span> <span class=nc>SchemaError</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для неуспешных ответов.</span>

<span class=sd>        Эта схема описывает структуру данных, которые могут быть возвращены</span>
<span class=sd>        в случае ошибки при взаимодействии с REST API.</span>
<span class=sd>        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.testutils.EndpointsDeclaration.Schema class="doc doc-heading"> <code>Schema</code> </h4> <div class="doc doc-contents "> <p>Схема Pydantic для успешных ответов.</p> <p>Эта схема описывает структуру данных, которые ожидаются в успешных ответах от REST API.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>Schema</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для успешных ответов.</span>

<span class=sd>    Эта схема описывает структуру данных, которые ожидаются в успешных ответах от REST API.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-class"> <h4 id=fastapi_accelerator.testutils.EndpointsDeclaration.SchemaError class="doc doc-heading"> <code>SchemaError</code> </h4> <div class="doc doc-contents "> <p>Схема Pydantic для неуспешных ответов.</p> <p>Эта схема описывает структуру данных, которые могут быть возвращены в случае ошибки при взаимодействии с REST API.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SchemaError</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Схема Pydantic для неуспешных ответов.</span>

<span class=sd>    Эта схема описывает структуру данных, которые могут быть возвращены</span>
<span class=sd>    в случае ошибки при взаимодействии с REST API.</span>
<span class=sd>    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.EndpointsDeclaration.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>credentials</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <details class=аргументы open> <summary>Аргументы</summary> <p>base_url (URL): Базовый URL для API. Это может быть доменное имя или адрес в формате host:port. credentials (dict | None): Доступные учетные данные для аутентификации в внешней системе.</p> </details> <details class=примечание open> <summary>Примечание</summary> <p>Рекомендуется задавать base_url через переменные окружения, чтобы избежать проблем с конфигурацией на разных уровнях (например, на production-среде) из-за межсетевых экранов или других факторов.</p> </details> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_url</span><span class=p>:</span> <span class=n>URL</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>credentials</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Аргументы:</span>
<span class=sd>        base_url (URL): Базовый URL для API. Это может быть доменное имя или адрес в формате host:port.</span>
<span class=sd>        credentials (dict | None): Доступные учетные данные для аутентификации в внешней системе.</span>

<span class=sd>    Примечание:</span>
<span class=sd>        Рекомендуется задавать base_url через переменные окружения, чтобы избежать проблем с конфигурацией</span>
<span class=sd>        на разных уровнях (например, на production-среде) из-за межсетевых экранов или других факторов.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>base_url</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>credentials</span> <span class=o>=</span> <span class=n>credentials</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.HTTPMethod class="doc doc-heading"> <code>HTTPMethod</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>str</code>, <code><span title="enum.Enum">Enum</span></code></p> <p>Доступные HTTP методы</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/integration/http_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>HTTPMethod</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>Enum</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Доступные HTTP методы&quot;&quot;&quot;</span>

    <span class=n>get</span> <span class=o>=</span> <span class=s2>&quot;GET&quot;</span>
    <span class=n>post</span> <span class=o>=</span> <span class=s2>&quot;POST&quot;</span>
    <span class=n>put</span> <span class=o>=</span> <span class=s2>&quot;PUT&quot;</span>
    <span class=n>patch</span> <span class=o>=</span> <span class=s2>&quot;PATCH&quot;</span>
    <span class=n>delete</span> <span class=o>=</span> <span class=s2>&quot;DELETE&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.MockRules class="doc doc-heading"> <code>MockRules</code> </h3> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>MockRules</span><span class=p>:</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mock_rules</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=n>Callable</span><span class=p>,</span> <span class=n>Callable</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Аргументы:</span>
<span class=sd>            mock_rules (dict[Callable, Callable]): Правила подмены методов интеграции на mock.</span>
<span class=sd>            Если в коде вызывается интеграция, которая не указана в mock_rules, возникает исключение.</span>
<span class=sd>            Это предотвращает случайные реальные запросы, если вы забыли указать mock.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_rules</span> <span class=o>=</span> <span class=n>mock_rules</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.MockRules.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>mock_rules</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <details class=аргументы open> <summary>Аргументы</summary> <p>mock_rules (dict[Callable, Callable]): Правила подмены методов интеграции на mock. Если в коде вызывается интеграция, которая не указана в mock_rules, возникает исключение. Это предотвращает случайные реальные запросы, если вы забыли указать mock.</p> </details> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mock_rules</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=n>Callable</span><span class=p>,</span> <span class=n>Callable</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>    Аргументы:</span>
<span class=sd>        mock_rules (dict[Callable, Callable]): Правила подмены методов интеграции на mock.</span>
<span class=sd>        Если в коде вызывается интеграция, которая не указана в mock_rules, возникает исключение.</span>
<span class=sd>        Это предотвращает случайные реальные запросы, если вы забыли указать mock.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_rules</span> <span class=o>=</span> <span class=n>mock_rules</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.SQLQueryTracker class="doc doc-heading"> <code>SQLQueryTracker</code> </h3> <div class="doc doc-contents "> <p>Хранит трекер запросов в РСУБД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/trace_sql.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SQLQueryTracker</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Хранит трекер запросов в РСУБД&quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>queries</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>NamedTuple</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>statement</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>,</span> <span class=n>executemany</span><span class=p>:</span> <span class=nb>bool</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Добавить SQL команду в трекер&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>queries</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>TrackerNameTuple</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>executemany</span><span class=p>))</span>

    <span class=nd>@property</span>
    <span class=k>def</span> <span class=nf>count</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
        <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>queries</span><span class=p>)</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>queries</span><span class=si>}</span><span class=s2>&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.SQLQueryTracker.add class="doc doc-heading"> <code class="highlight language-python"><span class=n>add</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>executemany</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <p>Добавить SQL команду в трекер</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/trace_sql.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>statement</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>,</span> <span class=n>executemany</span><span class=p>:</span> <span class=nb>bool</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Добавить SQL команду в трекер&quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>queries</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>TrackerNameTuple</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>executemany</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.SettingTest class="doc doc-heading"> <code>SettingTest</code> </h3> <div class="doc doc-contents "> <p>Настройки для тестов</p> <p>Пример <code>app/conftest.py</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>app.core.config</span> <span class=kn>import</span> <span class=n>TEST_DATABASE_URL</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.db.dbsession</span> <span class=kn>import</span> <span class=n>MainDatabaseManager</span>

<span class=c1># Вы можете указать точный список импорта, это для простоты мы импортируем все</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils</span> <span class=kn>import</span> <span class=o>*</span>  <span class=c1># noqa E402</span>
<span class=kn>from</span> <span class=nn>fastapi_accelerator.testutils</span> <span class=kn>import</span> <span class=n>SettingTest</span>

<span class=c1># Нужно создать менеджер БД до импорта APP</span>
<span class=c1># чтобы паттерн одиночка создал только тестовое instance</span>
<span class=c1># а в приложение уже взялся тестовый instance</span>
<span class=n>TestDatabaseManager</span> <span class=o>=</span> <span class=n>MainDatabaseManager</span><span class=p>(</span>
    <span class=n>TEST_DATABASE_URL</span><span class=p>,</span> <span class=n>echo</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>DEV_STATUS</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>

<span class=kn>from</span> <span class=nn>main</span> <span class=kn>import</span> <span class=n>app</span>  <span class=c1># noqa E402</span>

<span class=c1># Отключить кеширование во время тестов</span>
<span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>CACHE_STATUS</span> <span class=o>=</span> <span class=kc>False</span>

<span class=n>SettingTest</span><span class=p>(</span><span class=n>TestDatabaseManager</span><span class=p>,</span> <span class=n>app</span><span class=p>,</span> <span class=n>alembic_migrate</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>keepdb</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_base.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SettingTest</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>SingletonMeta</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Настройки для тестов</span>

<span class=sd>    Пример `app/conftest.py`:</span>

<span class=sd>    ```python</span>
<span class=sd>    from app.core.config import TEST_DATABASE_URL</span>
<span class=sd>    from fastapi_accelerator.db.dbsession import MainDatabaseManager</span>

<span class=sd>    # Вы можете указать точный список импорта, это для простоты мы импортируем все</span>
<span class=sd>    from fastapi_accelerator.testutils import *  # noqa E402</span>
<span class=sd>    from fastapi_accelerator.testutils import SettingTest</span>

<span class=sd>    # Нужно создать менеджер БД до импорта APP</span>
<span class=sd>    # чтобы паттерн одиночка создал только тестовое instance</span>
<span class=sd>    # а в приложение уже взялся тестовый instance</span>
<span class=sd>    TestDatabaseManager = MainDatabaseManager(</span>
<span class=sd>        TEST_DATABASE_URL, echo=False, DEV_STATUS=True</span>
<span class=sd>    )</span>

<span class=sd>    from main import app  # noqa E402</span>

<span class=sd>    # Отключить кеширование во время тестов</span>
<span class=sd>    app.state.CACHE_STATUS = False</span>

<span class=sd>    SettingTest(TestDatabaseManager, app, alembic_migrate=True, keepdb=True)</span>
<span class=sd>    ```</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>DatabaseManager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span><span class=p>,</span>
        <span class=n>app</span><span class=p>:</span> <span class=n>FastAPI</span><span class=p>,</span>
        <span class=n>alembic_migrate</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>keepdb</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Self</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        alembic_migrate:</span>
<span class=sd>            Использовать ли для создания таблиц, миграции alembic, или сразу создавать конечный вариант таблиц</span>
<span class=sd>            лучше использовать alembic миграции, чтобы сразу проверять и их  вов ремя тестирования</span>
<span class=sd>            - Если True -&gt; использовать alembic миграции</span>
<span class=sd>            - Если False -&gt; использовать create_all()</span>

<span class=sd>        keepdb:</span>
<span class=sd>            - Если True -&gt; не удалять тестовую БД после тестов</span>
<span class=sd>            - Если False -&gt; удалить тестовую БД после тестов</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=c1># Проверить что в имени БД есть подстрока test</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>DatabaseManager</span><span class=o>.</span><span class=n>database_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span>
            <span class=ow>or</span> <span class=n>DatabaseManager</span><span class=o>.</span><span class=n>adatabase_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span>
        <span class=p>):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Имя БД должно иметь подстроку test&quot;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>DatabaseManager</span> <span class=o>=</span> <span class=n>DatabaseManager</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>app</span> <span class=o>=</span> <span class=n>app</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>alembic_migrate</span> <span class=o>=</span> <span class=n>alembic_migrate</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>keepdb</span> <span class=o>=</span> <span class=n>keepdb</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=fastapi_accelerator.testutils.SettingTest.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>DatabaseManager</span><span class=p>,</span> <span class=n>app</span><span class=p>,</span> <span class=n>alembic_migrate</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>keepdb</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h4> <div class="doc doc-contents "> <details class=alembic_migrate open> <summary>alembic_migrate</summary> <p>Использовать ли для создания таблиц, миграции alembic, или сразу создавать конечный вариант таблиц лучше использовать alembic миграции, чтобы сразу проверять и их вов ремя тестирования - Если True -&gt; использовать alembic миграции - Если False -&gt; использовать create_all()</p> </details> <details class=keepdb open> <summary>keepdb</summary> <ul> <li>Если True -&gt; не удалять тестовую БД после тестов</li> <li>Если False -&gt; удалить тестовую БД после тестов</li> </ul> </details> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_base.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>DatabaseManager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span><span class=p>,</span>
    <span class=n>app</span><span class=p>:</span> <span class=n>FastAPI</span><span class=p>,</span>
    <span class=n>alembic_migrate</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>keepdb</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Self</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    alembic_migrate:</span>
<span class=sd>        Использовать ли для создания таблиц, миграции alembic, или сразу создавать конечный вариант таблиц</span>
<span class=sd>        лучше использовать alembic миграции, чтобы сразу проверять и их  вов ремя тестирования</span>
<span class=sd>        - Если True -&gt; использовать alembic миграции</span>
<span class=sd>        - Если False -&gt; использовать create_all()</span>

<span class=sd>    keepdb:</span>
<span class=sd>        - Если True -&gt; не удалять тестовую БД после тестов</span>
<span class=sd>        - Если False -&gt; удалить тестовую БД после тестов</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Проверить что в имени БД есть подстрока test</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=n>DatabaseManager</span><span class=o>.</span><span class=n>database_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span>
        <span class=ow>or</span> <span class=n>DatabaseManager</span><span class=o>.</span><span class=n>adatabase_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;test&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span>
    <span class=p>):</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Имя БД должно иметь подстроку test&quot;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>DatabaseManager</span> <span class=o>=</span> <span class=n>DatabaseManager</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>app</span> <span class=o>=</span> <span class=n>app</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>alembic_migrate</span> <span class=o>=</span> <span class=n>alembic_migrate</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>keepdb</span> <span class=o>=</span> <span class=n>keepdb</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.SingletonMeta class="doc doc-heading"> <code>SingletonMeta</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>type</code></p> <p>Мета класс для реализации паттерна Одиночка</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>SingletonMeta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Мета класс для реализации паттерна Одиночка&quot;&quot;&quot;</span>

    <span class=n>instance</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>SingletonMeta</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__call__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>instance</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h3 id=fastapi_accelerator.testutils.TrackerNameTuple class="doc doc-heading"> <code>TrackerNameTuple</code> </h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p> <p>Хранит SQL команду</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/trace_sql.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span> <span class=nc>TrackerNameTuple</span><span class=p>(</span><span class=n>NamedTuple</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Хранит SQL команду&quot;&quot;&quot;</span>

    <span class=c1># Текст SQL</span>
    <span class=n>statement</span><span class=p>:</span> <span class=nb>str</span>
    <span class=c1># Параметры в SQL</span>
    <span class=n>params</span><span class=p>:</span> <span class=nb>list</span> <span class=o>|</span> <span class=nb>dict</span>
    <span class=n>executemany</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.apply_fixture_db class="doc doc-heading"> <code class="highlight language-python"><span class=n>apply_fixture_db</span><span class=p>(</span><span class=n>export_func</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Декоратор, который добавляет фикстуры в БД перед тестом и удаляет их после теста.</p> <p>:param export_func: Функция, возвращающая объекты для добавления в БД. :param flush: Удалить данные после выполнения теста, если установлено в True. Не нужно указывать если вы используете фикстуры <code>client</code>, так как он уже выполняет отчистку всех данных в <code>common_setup_table</code></p> <p>Пример:</p> <p>def export_fixture_task() -&gt; NamedTuple: return dict_to_namedtuple( file1=FileDb( uid=uuid.UUID("469d4176-98f3-48a2-8794-0e2472bc2b7e"), filename="file1.txt", size=100, format="text/plain", extension=".txt", ) )</p> <p>@apply_fixture_db(export_fixture_task) def test_base(client: TestClient, fixtures: NamedTuple): response = client.get('url') assert response.status_code == 200 assert response.json() == {"uid": fixtures.file1.uid}</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/apply_fixture.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>apply_fixture_db</span><span class=p>(</span>  <span class=c1># noqa C901</span>
    <span class=n>export_func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[],</span> <span class=n>NamedTuple</span><span class=p>],</span> <span class=n>flush</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Декоратор, который добавляет фикстуры в БД перед тестом и удаляет их после теста.</span>

<span class=sd>    :param export_func: Функция, возвращающая объекты для добавления в БД.</span>
<span class=sd>    :param flush: Удалить данные после выполнения теста, если установлено в True.</span>
<span class=sd>        Не нужно указывать если вы используете фикстуры `client`,</span>
<span class=sd>        так как он уже выполняет отчистку всех данных в `common_setup_table`</span>

<span class=sd>    Пример:</span>

<span class=sd>    def export_fixture_task() -&gt; NamedTuple:</span>
<span class=sd>        return dict_to_namedtuple(</span>
<span class=sd>            file1=FileDb(</span>
<span class=sd>                uid=uuid.UUID(&quot;469d4176-98f3-48a2-8794-0e2472bc2b7e&quot;),</span>
<span class=sd>                filename=&quot;file1.txt&quot;,</span>
<span class=sd>                size=100,</span>
<span class=sd>                format=&quot;text/plain&quot;,</span>
<span class=sd>                extension=&quot;.txt&quot;,</span>
<span class=sd>            )</span>
<span class=sd>        )</span>

<span class=sd>    @apply_fixture_db(export_fixture_task)</span>
<span class=sd>    def test_base(client: TestClient, fixtures: NamedTuple):</span>
<span class=sd>        response = client.get(&#39;url&#39;)</span>
<span class=sd>        assert response.status_code == 200</span>
<span class=sd>        assert response.json() == {&quot;uid&quot;: fixtures.file1.uid}</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=nf>up</span><span class=p>(</span><span class=n>fixtures</span><span class=p>:</span> <span class=n>NamedTuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>NamedTuple</span><span class=p>:</span>
        <span class=c1># Накатить фикстуры</span>
        <span class=k>with</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>session</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
            <span class=n>session</span><span class=p>:</span> <span class=n>Session</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>session</span><span class=o>.</span><span class=n>add_all</span><span class=p>(</span><span class=n>fixtures</span><span class=p>)</span>
                <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
                <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>fixtures</span><span class=p>:</span>
                    <span class=n>session</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
            <span class=k>except</span> <span class=n>IntegrityError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
                <span class=k>raise</span> <span class=n>e</span>

        <span class=k>return</span> <span class=n>fixtures</span>

    <span class=k>def</span> <span class=nf>down</span><span class=p>(</span><span class=n>fixtures</span><span class=p>:</span> <span class=n>NamedTuple</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>flush</span><span class=p>:</span>
            <span class=c1># Удалить фикстуры</span>
            <span class=k>with</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>session</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
                <span class=n>session</span><span class=p>:</span> <span class=n>Session</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>fixtures</span><span class=p>:</span>
                        <span class=n>session</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
                    <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
                <span class=k>except</span> <span class=n>IntegrityError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                    <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
                    <span class=k>raise</span> <span class=n>e</span>

    <span class=k>def</span> <span class=nf>decor</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>def</span> <span class=nf>wrap</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
            <span class=n>fixtures</span> <span class=o>=</span> <span class=n>export_func</span><span class=p>()</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>up</span><span class=p>(</span><span class=n>fixtures</span><span class=p>)</span>
                <span class=c1># Если ожидается аргумент fixtures</span>
                <span class=k>if</span> <span class=s2>&quot;fixtures&quot;</span> <span class=ow>in</span> <span class=n>inspect</span><span class=o>.</span><span class=n>getfullargspec</span><span class=p>(</span><span class=n>func</span><span class=p>)</span><span class=o>.</span><span class=n>args</span><span class=p>:</span>
                    <span class=c1># то подменяем его</span>
                    <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;fixtures&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>fixtures</span>
                <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
            <span class=k>finally</span><span class=p>:</span>
                <span class=n>down</span><span class=p>(</span><span class=n>fixtures</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>wrap</span>

    <span class=k>return</span> <span class=n>decor</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.check_response_json class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_response_json</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>exp_status_code</span><span class=p>,</span> <span class=n>exp_json</span><span class=p>,</span> <span class=n>exclude_list</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Проверка json API ответа</p> <p>Пример:</p> <p>def test_get_item(self, client: TestClient): response = client.get(self.url) check_response_json(response, 200, {...})</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>check_response_json</span><span class=p>(</span>
    <span class=n>response</span><span class=p>:</span> <span class=n>Response</span><span class=p>,</span>
    <span class=n>exp_status_code</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>exp_json</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
    <span class=n>exclude_list</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Проверка json API ответа</span>

<span class=sd>    Пример:</span>

<span class=sd>    def test_get_item(self, client: TestClient):</span>
<span class=sd>        response = client.get(self.url)</span>
<span class=sd>        check_response_json(response, 200, {...})</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=n>exp_status_code</span>
    <span class=n>response_json</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>exclude_list</span><span class=p>:</span>
        <span class=n>rm_key_from_deep_dict</span><span class=p>(</span><span class=n>response_json</span><span class=p>,</span> <span class=n>exclude_list</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>response_json</span> <span class=o>==</span> <span class=n>exp_json</span>
    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.client class="doc doc-heading"> <code class="highlight language-python"><span class=n>client</span><span class=p>(</span><span class=n>common_client</span><span class=p>,</span> <span class=n>common_clean_table</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Вернуть тестовый клиент FastAPI.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/db.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;function&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>client</span><span class=p>(</span>
    <span class=n>common_client</span><span class=p>:</span> <span class=n>TestClient</span><span class=p>,</span> <span class=n>common_clean_table</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>TestClient</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Вернуть тестовый клиент FastAPI.&quot;&quot;&quot;</span>
    <span class=k>yield</span> <span class=n>common_client</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.client_auth_jwt class="doc doc-heading"> <code class="highlight language-python"><span class=n>client_auth_jwt</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Декоратор который аутентифицирует тестового клиента по JWT.</p> <p>Использование в функции:</p> <p>@client_auth_jwt(username="test"}) def test_get_list(client: TestClient): response = client.get(self.url) assert response.status_code == 200 assert response.json() == []</p> <p>Использование в классе:</p> <p>class TestTaskExecution(BasePytest):</p> <pre><code>@client_auth_jwt() # Данные для входа возьмутся из self.TEST_USER
def test_get_list(self, client: TestClient):
    response = client.get(self.url)
    assert response.status_code == 200
    assert response.json() == []
</code></pre> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_auth.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>client_auth_jwt</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Декоратор который аутентифицирует тестового клиента по JWT.</span>

<span class=sd>    Использование в функции:</span>

<span class=sd>    @client_auth_jwt(username=&quot;test&quot;})</span>
<span class=sd>    def test_get_list(client: TestClient):</span>
<span class=sd>        response = client.get(self.url)</span>
<span class=sd>        assert response.status_code == 200</span>
<span class=sd>        assert response.json() == []</span>

<span class=sd>    Использование в классе:</span>

<span class=sd>    class TestTaskExecution(BasePytest):</span>

<span class=sd>        @client_auth_jwt() # Данные для входа возьмутся из self.TEST_USER</span>
<span class=sd>        def test_get_list(self, client: TestClient):</span>
<span class=sd>            response = client.get(self.url)</span>
<span class=sd>            assert response.status_code == 200</span>
<span class=sd>            assert response.json() == []</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>auth_jwt</span><span class=p>:</span> <span class=n>BaseAuthJWT</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>auth_jwt</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>auth_jwt</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;No found state - auth_jwt.&quot;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>decor</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>

        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>def</span> <span class=nf>wrap</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
            <span class=c1># username можно передать в аргументе,</span>
            <span class=c1># иначе он возьмется из self.TEST_USER класса</span>
            <span class=c1># в котором обвялен тестовый метод</span>
            <span class=n>current_username</span> <span class=o>=</span> <span class=n>username</span> <span class=ow>or</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>TEST_USER</span><span class=p>[</span><span class=s2>&quot;username&quot;</span><span class=p>]</span>
            <span class=n>access_token</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>auth_jwt</span><span class=o>.</span><span class=n>_create_access_token</span><span class=p>(</span>
                <span class=n>data</span><span class=o>=</span><span class=p>{</span>
                    <span class=s2>&quot;sub&quot;</span><span class=p>:</span> <span class=n>current_username</span><span class=p>,</span>
                    <span class=o>**</span><span class=n>run_async</span><span class=p>(</span><span class=n>auth_jwt</span><span class=o>.</span><span class=n>add_jwt_body</span><span class=p>(</span><span class=n>current_username</span><span class=p>)),</span>
                <span class=p>},</span>
            <span class=p>)</span>
            <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;client&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&quot;authorization&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>access_token</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>wrap</span>

    <span class=k>return</span> <span class=n>decor</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.common_clean_table class="doc doc-heading"> <code class="highlight language-python"><span class=n>common_clean_table</span><span class=p>(</span><span class=n>common_setup_database</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Отчистка данных в таблицах, выполняется после каждого теста.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/db.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;function&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>common_clean_table</span><span class=p>(</span><span class=n>common_setup_database</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Отчистка данных в таблицах, выполняется после каждого теста.&quot;&quot;&quot;</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>yield</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=c1># Отчистить данные в таблицах</span>
        <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>clear_all</span><span class=p>([</span><span class=s2>&quot;alembic_version&quot;</span><span class=p>])</span>
        <span class=c1># Синхронный вызов асинхронного метода dispose()</span>
        <span class=n>run_async</span><span class=p>(</span><span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>dispose</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.common_client class="doc doc-heading"> <code class="highlight language-python"><span class=n>common_client</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Создает тестовый клиент FastAPI.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/db.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;session&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>common_client</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>TestClient</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Создает тестовый клиент FastAPI.&quot;&quot;&quot;</span>

    <span class=k>with</span> <span class=n>TestClient</span><span class=p>(</span><span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>app</span><span class=p>)</span> <span class=k>as</span> <span class=n>test_client</span><span class=p>:</span>
        <span class=k>yield</span> <span class=n>test_client</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.common_setup_database class="doc doc-heading"> <code class="highlight language-python"><span class=n>common_setup_database</span><span class=p>(</span><span class=n>engine</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Создает и настраивает тестовую базу данных один раз, на протяжение всех тестов.</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/db.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;session&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>common_setup_database</span><span class=p>(</span><span class=n>engine</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Создает и настраивает тестовую базу данных один раз, на протяжение всех тестов.&quot;&quot;&quot;</span>
    <span class=c1># Создать БД</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>database_exists</span><span class=p>(</span><span class=n>engine</span><span class=o>.</span><span class=n>url</span><span class=p>):</span>
        <span class=n>create_database</span><span class=p>(</span><span class=n>engine</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>alembic_migrate</span><span class=p>:</span>
        <span class=c1># Использовать alembic для создания таблиц через миграции</span>
        <span class=kn>from</span> <span class=nn>alembic</span> <span class=kn>import</span> <span class=n>command</span>
        <span class=kn>from</span> <span class=nn>alembic.config</span> <span class=kn>import</span> <span class=n>Config</span>

        <span class=n>alembic_cfg</span> <span class=o>=</span> <span class=n>Config</span><span class=p>(</span><span class=s2>&quot;alembic.ini&quot;</span><span class=p>)</span>
        <span class=n>alembic_cfg</span><span class=o>.</span><span class=n>set_main_option</span><span class=p>(</span>
            <span class=s2>&quot;sqlalchemy.url&quot;</span><span class=p>,</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>database_url</span>
        <span class=p>)</span>
        <span class=n>command</span><span class=o>.</span><span class=n>upgrade</span><span class=p>(</span><span class=n>alembic_cfg</span><span class=p>,</span> <span class=s2>&quot;head&quot;</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># Создать сразу конечный вариант таблиц</span>
        <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>create_all</span><span class=p>()</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>yield</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>keepdb</span><span class=p>:</span>
            <span class=c1># Удалить таблицы после тестов</span>
            <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>drop_all</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.db_session class="doc doc-heading"> <code class="highlight language-python"><span class=n>db_session</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Получить сессию к тестовой БД</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/db.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span>
<span class=normal>97</span>
<span class=normal>98</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;function&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>db_session</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Session</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Получить сессию к тестовой БД&quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>session</span> <span class=ow>in</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>DatabaseManager</span><span class=o>.</span><span class=n>get_session</span><span class=p>():</span>
        <span class=k>yield</span> <span class=n>session</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.fixtures class="doc doc-heading"> <code class="highlight language-python"><span class=n>fixtures</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Пустая фикстура в которую будет вставлены значения из декоратора apply_fixture_db</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/apply_fixture.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;session&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>fixtures</span><span class=p>():</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Пустая фикстура в которую будет вставлены значения из декоратора apply_fixture_db&quot;&quot;&quot;</span>
    <span class=k>yield</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.patch_integration class="doc doc-heading"> <code class="highlight language-python"><span class=n>patch_integration</span><span class=p>(</span><span class=n>mock_rules</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Декоратор для подмены методов интеграции на mock.</p> <details class=примечание open> <summary>Примечание</summary> <p>Вы можете хранить mock_rules в отдельных переменных и переиспользовать их для разных функций/методов тестирования.</p> </details> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_integration.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>patch_integration</span><span class=p>(</span><span class=n>mock_rules</span><span class=p>:</span> <span class=n>MockRules</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Декоратор для подмены методов интеграции на mock.</span>

<span class=sd>    Примечание:</span>
<span class=sd>        Вы можете хранить mock_rules в отдельных переменных и</span>
<span class=sd>        переиспользовать их для разных функций/методов тестирования.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=nf>decor</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>def</span> <span class=nf>wrap</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
            <span class=k>with</span> <span class=n>patch</span><span class=p>(</span>
                <span class=s2>&quot;fastapi_accelerator.integration.http_integration.wraper_endpoint&quot;</span>
            <span class=p>)</span> <span class=k>as</span> <span class=n>wraper_endpoint</span><span class=p>:</span>
                <span class=c1># Подмена методов интеграций на mock</span>
                <span class=n>i</span> <span class=o>=</span> <span class=n>_IntegrationAsyncMock</span><span class=p>(</span><span class=n>wraper_endpoint</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>real_func</span><span class=p>,</span> <span class=n>mock_func</span> <span class=ow>in</span> <span class=n>mock_rules</span><span class=o>.</span><span class=n>_rules</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
                    <span class=n>i</span><span class=o>.</span><span class=n>overwrite_method</span><span class=p>(</span><span class=n>real_func</span><span class=p>,</span> <span class=n>mock_func</span><span class=p>)</span>

                <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>wrap</span>

    <span class=k>return</span> <span class=n>decor</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.rm_key_from_deep_dict class="doc doc-heading"> <code class="highlight language-python"><span class=n>rm_key_from_deep_dict</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>keys</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Удалить ключи из dict или из списка словарей рекурсивно.</p> <p>data: Данные для отчистки keys: Ключи которые нужно удалить из данных</p> <p>Пример:</p> <p>rm_key_from_deep_dict({"date": "...", "user": "..."}, ["data"])</p> <blockquote> <blockquote> <blockquote> <p>{"user": "..."}</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>rm_key_from_deep_dict</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>|</span> <span class=nb>list</span><span class=p>,</span> <span class=n>keys</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Удалить ключи из dict или из списка словарей рекурсивно.</span>

<span class=sd>    data: Данные для отчистки</span>
<span class=sd>    keys: Ключи которые нужно удалить из данных</span>

<span class=sd>    Пример:</span>

<span class=sd>    rm_key_from_deep_dict({&quot;date&quot;: &quot;...&quot;, &quot;user&quot;: &quot;...&quot;}, [&quot;data&quot;])</span>
<span class=sd>    &gt;&gt;&gt; {&quot;user&quot;: &quot;...&quot;}</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
        <span class=c1># Удаляем ключи из словаря</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
            <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>  <span class=c1># Используем pop с None, чтобы избежать KeyError</span>
        <span class=c1># Рекурсивно обрабатываем значения в словаре</span>
        <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
            <span class=n>rm_key_from_deep_dict</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>keys</span><span class=p>)</span>
    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
        <span class=c1># Рекурсивно обрабатываем каждый элемент списка</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
            <span class=n>rm_key_from_deep_dict</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>keys</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>data</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.run_async class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_async</span><span class=p>(</span><span class=n>async_function</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Синхронная обертка для асинхронного вызова</p> <details class=quote> <summary>Source code in <code>fastapi_accelerator/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>run_async</span><span class=p>(</span><span class=n>async_function</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Синхронная обертка для асинхронного вызова&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>run_until_complete</span><span class=p>(</span><span class=n>async_function</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.track_queries class="doc doc-heading"> <code class="highlight language-python"><span class=n>track_queries</span><span class=p>(</span><span class=n>db_manager</span><span class=p>,</span> <span class=n>expected_count</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Перехват SQL команд, для их анализа</p> <p>expected_count: Сколько ожидается выполниться SQL команд</p> <p>Пример использования:</p> <p>def test_get_list(self, client: TestClient, db_manager: MainDatabaseManager): with track_queries(db_manager, expected_count=2) as tracker: response = client.get(self.url)</p> <pre><code>print(tracker.queries)
</code></pre> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/fixture_db/trace_sql.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@contextmanager</span>
<span class=k>def</span> <span class=nf>track_queries</span><span class=p>(</span>
    <span class=n>db_manager</span><span class=p>:</span> <span class=n>MainDatabaseManager</span><span class=p>,</span> <span class=n>expected_count</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>SQLQueryTracker</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Перехват SQL команд, для их анализа</span>

<span class=sd>    expected_count: Сколько ожидается выполниться SQL команд</span>


<span class=sd>    Пример использования:</span>

<span class=sd>    def test_get_list(self, client: TestClient, db_manager: MainDatabaseManager):</span>
<span class=sd>        with track_queries(db_manager, expected_count=2) as tracker:</span>
<span class=sd>            response = client.get(self.url)</span>

<span class=sd>        print(tracker.queries)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>tracker</span> <span class=o>=</span> <span class=n>SQLQueryTracker</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>_before_cursor_execute</span><span class=p>(</span>
        <span class=n>conn</span><span class=p>,</span> <span class=n>cursor</span><span class=p>,</span> <span class=n>statement</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>executemany</span><span class=p>:</span> <span class=nb>bool</span>
    <span class=p>):</span>
        <span class=n>tracker</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>executemany</span><span class=p>)</span>

    <span class=c1># Отлеживаем события как в синхронном так и в асинхронном engine</span>
    <span class=n>event</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span>
        <span class=n>db_manager</span><span class=o>.</span><span class=n>aengine</span><span class=o>.</span><span class=n>sync_engine</span><span class=p>,</span> <span class=s2>&quot;before_cursor_execute&quot;</span><span class=p>,</span> <span class=n>_before_cursor_execute</span>
    <span class=p>)</span>
    <span class=n>event</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span><span class=n>db_manager</span><span class=o>.</span><span class=n>engine</span><span class=p>,</span> <span class=s2>&quot;before_cursor_execute&quot;</span><span class=p>,</span> <span class=n>_before_cursor_execute</span><span class=p>)</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=c1># Трекер который можно анализировать в тестах</span>
        <span class=k>yield</span> <span class=n>tracker</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=c1># Отключить отслеживание</span>
        <span class=n>event</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span>
            <span class=n>db_manager</span><span class=o>.</span><span class=n>aengine</span><span class=o>.</span><span class=n>sync_engine</span><span class=p>,</span>
            <span class=s2>&quot;before_cursor_execute&quot;</span><span class=p>,</span>
            <span class=n>_before_cursor_execute</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>event</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>db_manager</span><span class=o>.</span><span class=n>engine</span><span class=p>,</span> <span class=s2>&quot;before_cursor_execute&quot;</span><span class=p>,</span> <span class=n>_before_cursor_execute</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>expected_count</span><span class=p>:</span>
            <span class=c1># Проверить количество sql команд</span>
            <span class=k>if</span> <span class=n>tracker</span><span class=o>.</span><span class=n>count</span> <span class=o>!=</span> <span class=n>expected_count</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>tracker</span><span class=o>.</span><span class=n>queries</span><span class=si>}</span><span class=se>\n\n</span><span class=si>{</span><span class=n>tracker</span><span class=o>.</span><span class=n>count</span><span class=si>}</span><span class=s2> != </span><span class=si>{</span><span class=n>expected_count</span><span class=si>}</span><span class=s2>&quot;</span>
                <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=fastapi_accelerator.testutils.url_path_for class="doc doc-heading"> <code class="highlight language-python"><span class=n>url_path_for</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Функция чтобы получить полный URL путь по названию функции</p> <p>Пример:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>test_base</span><span class=p>(</span><span class=n>client</span><span class=p>:</span> <span class=n>TestClient</span><span class=p>,</span> <span class=n>url_path_for</span><span class=p>:</span> <span class=n>Callable</span><span class=p>):</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url_path_for</span><span class=p>(</span><span class=s2>&quot;ИмяФункции&quot;</span><span class=p>))</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>fastapi_accelerator/testutils/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s2>&quot;function&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>url_path_for</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Callable</span><span class=p>[[</span><span class=nb>str</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Функция чтобы получить полный URL путь по названию функции</span>

<span class=sd>    Пример:</span>

<span class=sd>    ```python</span>
<span class=sd>    def test_base(client: TestClient, url_path_for: Callable):</span>
<span class=sd>        response = client.get(url_path_for(&quot;ИмяФункции&quot;))</span>
<span class=sd>    ```</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>yield</span> <span class=k>lambda</span> <span class=n>name_url</span><span class=p>:</span> <span class=n>SettingTest</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>url_path_for</span><span class=p>(</span><span class=n>name_url</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script> <script src=../assets/javascripts/bundle.d6f25eb3.min.js></script> </body> </html>